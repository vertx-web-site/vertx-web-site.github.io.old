<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="description" content="Vert.x | Reactive applications on the JVM"/><meta name="robots" content="index,follow"/><link rel="shortcut icon" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="48x48" href="/favicons/favicon-48x48.png"/><link rel="alternate" type="application/rss+xml" href="/feed/rss.xml"/><link rel="alternate" type="application/atom+xml" href="/feed/atom.xml"/><link rel="alternate" type="application/json" href="/feed/feed.json"/><title>JWT Authorization for Vert.x with Keycloak | Blog | Eclipse Vert.x</title><meta name="next-head-count" content="13"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-cb7634a8b6194820.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-f635b472c367d1c7.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6ecf1f3c709ede3f.js" defer=""></script><script src="/_next/static/chunks/805-f8dfab54d8799d0e.js" defer=""></script><script src="/_next/static/chunks/592-9361f670a9fcb696.js" defer=""></script><script src="/_next/static/chunks/154-3bc3bd785bd662c1.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B%5B...slug%5D%5D-7bdb64cf102932b8.js" defer=""></script><script src="/_next/static/peDB05ylg8_PpP0Vbjzi2/_buildManifest.js" defer=""></script><script src="/_next/static/peDB05ylg8_PpP0Vbjzi2/_ssgManifest.js" defer=""></script><script src="/_next/static/peDB05ylg8_PpP0Vbjzi2/_middlewareManifest.js" defer=""></script><style id="__jsx-400ec7965926e858">.dropdown-item.jsx-400ec7965926e858{white-space:nowrap;
line-height:2;
width:100%;
padding:0 1.5rem;
cursor:pointer}
.dropdown-item.jsx-400ec7965926e858:hover{background-color:#e9ecef}
.dropdown-item.active.jsx-400ec7965926e858{font-weight:400;
padding-left:.75rem}
.dropdown-item.has-active-siblings.jsx-400ec7965926e858:not(.active){padding-left:calc(0.75rem + 16px + 0.5em)}
.dropdown-item.jsx-400ec7965926e858 .dropdown-check-icon.jsx-400ec7965926e858{width:16px;
margin-right:.5em;
margin-top:1px}</style><style id="__jsx-6650573c8f14945d">.dropdown.jsx-6650573c8f14945d{position:relative;
display:inline-block}
.dropdown.jsx-6650573c8f14945d .dropdown-title.jsx-6650573c8f14945d{margin-right:0;
cursor:pointer;
-webkit-user-select:none;
-moz-user-select:none;
-ms-user-select:none;
user-select:none}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.jsx-6650573c8f14945d{position:absolute;
background-color:#f8f9fa;
box-shadow:0 2px 5px 0 rgba(0, 0, 0, .1);
border-radius:.8rem;
list-style-type:none;
padding:.6666666667rem 0;
margin:.25rem 0 0 0;
z-index:100;
display:none;
-webkit-user-select:none;
-moz-user-select:none;
-ms-user-select:none;
user-select:none}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.jsx-6650573c8f14945d a{color:#4d4d4d;
-webkit-text-decoration:none;
text-decoration:none;
font-weight:300}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.align-right.jsx-6650573c8f14945d{right:0}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.visible.jsx-6650573c8f14945d{display:block}
.dropdown.jsx-6650573c8f14945d .dropdown-menu.jsx-6650573c8f14945d a.jsx-6650573c8f14945d:hover{color:inherit}
.dropdown.jsx-6650573c8f14945d svg{margin-bottom:2px}</style><style id="__jsx-f705e145f931f504">.navbar{position:absolute;
top:2.75rem;
width:100%}
.navbar a{color:#3c3c3b}
.navbar a.navbar-menu-item, .navbar .dropdown-title{text-transform:uppercase}
.navbar a.navbar-menu-item:hover, .navbar .dropdown-title:hover{-webkit-text-decoration:none;
text-decoration:none;
color:#898987;
-webkit-transition:color .15s ease-in-out;
transition:color .15s ease-in-out}
.navbar .navbar-content{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:row;
-ms-flex-direction:row;
flex-direction:row;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center;
position:relative}
.navbar .navbar-content .navbar-logo{-webkit-flex:1;
-ms-flex:1;
flex:1}
.navbar .navbar-content .navbar-logo img{width:8.3rem}
.navbar .navbar-content .navbar-collapse-button{display:none;
cursor:pointer}
@media (max-width:1000px) {.navbar .navbar-content .navbar-collapse-button{display:inline-block}}
.navbar .navbar-content .navbar-collapse-button span{display:block;
width:33px;
height:4px;
margin-bottom:5px;
position:relative;
background:#3c3c3b;
border-radius:3px;
z-index:1;
transform-origin:4px 0;
-webkit-transition:-webkit-transform .5s cubic-bezier(0.77, 0.2, 0.05, 1), background .5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity .55s ease;
transition:transform .5s cubic-bezier(0.77, 0.2, 0.05, 1), background .5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity .55s ease}
.navbar .navbar-content .navbar-collapse-button span:first-child{transform-origin:0% 0%}
.navbar .navbar-content .navbar-collapse-button span:nth-last-child(2){transform-origin:0% 100%}
.navbar .navbar-content .navbar-right{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:row;
-ms-flex-direction:row;
flex-direction:row;
-webkit-align-items:baseline;
-webkit-box-align:baseline;
-ms-flex-align:baseline;
align-items:baseline;
margin-bottom:10px}
@media (max-width:1000px) {.navbar .navbar-content .navbar-right{max-height:0;
-webkit-transition:max-height 200ms ease-in-out;
transition:max-height 200ms ease-in-out;
box-shadow:0 2px 5px 0 rgba(0, 0, 0, .1);
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column;
position:absolute;
top:2.75rem;
left:.8rem;
right:.8rem;
background-color:#f8f9fa;
overflow-x:auto;
overflow-y:hidden}}
.navbar .navbar-content .navbar-menu .navbar-menu-item{font-weight:400;
margin-right:2.5rem}
.navbar .navbar-content .navbar-menu .navbar-menu-item.with-drop-down{margin-right:1.8rem}
@media (max-width:1250px) {.navbar .navbar-content .navbar-menu .navbar-menu-item{margin-right:1.5rem}}
@media (max-width:1000px) {.navbar .navbar-content .navbar-menu .navbar-menu-item{display:block;
margin-bottom:1rem;
font-size:1.2rem}}
.navbar .navbar-content .navbar-menu .navbar-menu-item .external-link-icon{margin-left:.25em}
@media (max-width:1000px) {.navbar .navbar-content .navbar-menu{-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column;
padding:1rem}}
.navbar .navbar-content .navbar-social{margin-left:1.6rem;
font-size:.875rem}
.navbar .navbar-content .navbar-social svg{height:16px;
margin-bottom:2px}
@media (max-width:1000px) {.navbar .navbar-content .navbar-social svg{height:1rem}}
@media (max-width:1250px) {.navbar .navbar-content .navbar-social{margin-left:1rem}}
@media (max-width:1000px) {.navbar .navbar-content .navbar-social{margin-left:auto;
padding:0 1rem 1rem 0;
font-size:1rem}}
@media (max-width:768px) {.navbar{top:1rem}}
.page .navbar{top:0;
padding-top:1.5rem;
padding-bottom:1rem;
position:fixed;
background-color:#fff;
z-index:2}</style><style id="__jsx-2ac0bd13852cf810">.blog-navbar{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center;
margin-bottom:2rem}
.blog-navbar h2{display:inline;
margin:0;
-webkit-flex:1;
-ms-flex:1;
flex:1}
.blog-navbar ul{padding:0;
list-style-type:none;
margin:0;
display:-webkit-inline-box;
display:-webkit-inline-flex;
display:-ms-inline-flexbox;
display:inline-flex;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center;
text-transform:uppercase;
-webkit-box-pack:end;
-ms-flex-pack:end;
-webkit-justify-content:flex-end;
justify-content:flex-end}
.blog-navbar ul li{font-size:.875rem;
font-weight:400}
.blog-navbar ul li:not(:first-child){margin-left:2rem}
@media (max-width:640px) {.blog-navbar{-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column}
.blog-navbar ul{margin-top:1rem}}
.blog-navbar .feed-icons{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
margin-left:1.85rem}
.blog-navbar .feed-icons svg{height:1.05rem;
margin-bottom:3px}
@media (max-width:640px) {.blog-navbar .feed-icons{margin-top:.5rem}}</style><style id="__jsx-73ea682053e23281">.read-more-link.jsx-73ea682053e23281{display:-webkit-inline-box;
display:-webkit-inline-flex;
display:-ms-inline-flexbox;
display:inline-flex;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center}
.read-more-link.jsx-73ea682053e23281::after{content:"";
width:0;
height:0;
display:inline-block;
border-top:.39rem solid transparent;
border-bottom:.39rem solid transparent;
border-left:.45rem solid #782b90;
margin-left:.5rem;
margin-top:2px;
-webkit-transition:all 100ms ease;
transition:all 100ms ease}
.read-more-link.jsx-73ea682053e23281:hover::after{border-left-color:#571f69;
margin-left:.6666666667rem}</style><style id="__jsx-cc12eb2116299e94">.blog-entry{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column;
border-top:1px solid #dee2e6;
padding-top:2rem}
.blog-entry .blog-entry-meta{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-box-pack:justify;
-webkit-justify-content:space-between;
justify-content:space-between;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center}
.blog-entry h3{font-size:1.5rem;
line-height:1.4;
margin-top:.5rem;
margin-bottom:1rem}
.blog-entry h3 a:hover{-webkit-text-decoration:none;
text-decoration:none}
.blog-entry .blog-entry-date{font-size:.875rem;
text-transform:uppercase;
white-space:nowrap;
margin-right:.6666666667rem}
.blog-entry .blog-entry-category{font-size:.875rem;
text-transform:uppercase;
font-weight:400;
color:#3c3c3b}
.blog-entry .blog-entry-authors ul{list-style-type:none;
padding:0;
display:inline}
.blog-entry .blog-entry-authors ul li{display:-webkit-inline-box;
display:-webkit-inline-flex;
display:-ms-inline-flexbox;
display:inline-flex;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center}
.blog-entry .blog-entry-authors ul li:not(:last-child){margin-right:1rem}
.blog-entry .blog-entry-authors ul li:not(:last-child).avatars-only{margin-right:.25rem}
.blog-entry .blog-entry-authors ul li img{width:24px;
height:24px;
border-radius:12px;
margin-right:.3333333333rem}
.blog-entry .blog-entry-summary{-webkit-flex:1;
-ms-flex:1;
flex:1;
text-align:justify;
hyphens:auto}</style><style id="__jsx-a04fe959d555a951">.blog-post .blog-post-main{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
width:100%;
-webkit-box-pack:justify;
-webkit-justify-content:space-between;
justify-content:space-between}
.blog-post .blog-post-main .blog-post-content{width:70%;
border-top:1px solid #dee2e6}
.blog-post .blog-post-main .blog-post-content>h1{line-height:1.4;
margin-bottom:2rem}
.blog-post .blog-post-main .blog-post-content>h2, .blog-post .blog-post-main .blog-post-content>h3, .blog-post .blog-post-main .blog-post-content>h4{line-height:1.4;
margin-top:3rem}
.blog-post .blog-post-main .blog-post-content ul{padding-left:1.1rem}
.blog-post .blog-post-main .blog-post-content ul ul{padding-left:1.3rem;
margin-top:.5rem;
margin-bottom:1rem}
.blog-post .blog-post-main .blog-post-content li{margin-bottom:.5rem}
.blog-post .blog-post-main .blog-post-content img{display:block;
max-width:100%;
margin-left:auto;
margin-right:auto}
.blog-post .blog-post-main .blog-post-content .youtube-embed{padding-bottom:56.25%;
position:relative;
display:block}
.blog-post .blog-post-main .blog-post-content .youtube-embed iframe{position:absolute;
left:0;
top:0;
bottom:0;
right:0;
width:100%;
height:100%}
.blog-post .blog-post-main .blog-post-content blockquote{margin:0 0 1rem;
border-left:5px solid #dee2e6;
font-style:italic}
.blog-post .blog-post-main .blog-post-content blockquote p{padding:.25rem 1rem}
.blog-post .blog-post-main .blog-post-content .gist .gist-data{max-height:500px}
.blog-post .blog-post-main .blog-post-sidebar{width:calc(30% - 2rem);
border-top:1px solid #dee2e6}
.blog-post .blog-post-main .blog-post-sidebar .blog-post-author{margin-top:1rem;
display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center}
.blog-post .blog-post-main .blog-post-sidebar .blog-post-author:first-child{margin-top:2rem}
.blog-post .blog-post-main .blog-post-sidebar .blog-post-author .blog-post-author-avatar{width:60px;
height:60px;
border-radius:30px;
margin-right:.8rem}
.blog-post .blog-post-main .blog-post-sidebar .blog-post-author .blog-post-author-name{font-size:1.2rem;
line-height:1.2;
margin-bottom:.25rem}
.blog-post .blog-post-main .blog-post-sidebar .blog-post-author .blog-post-author-name a{font-weight:400}
.blog-post .blog-post-main .blog-post-sidebar .blog-post-sidebar-pinned{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
margin-top:2rem}
.blog-post .blog-post-main .blog-post-sidebar .blog-post-sidebar-date{margin-top:1rem}
.blog-post .blog-post-main .blog-post-sidebar .blog-post-sidebar-category{text-transform:uppercase;
font-weight:400}
.blog-post .blog-post-main .blog-post-sidebar .blog-post-sidebar-reading-time{margin-top:2rem}
.blog-post .blog-post-main .blog-post-sidebar .blog-post-sidebar-reading-time .feather{margin-bottom:2px;
margin-right:2px}
.blog-post .blog-post-main .blog-post-sidebar .blog-post-sidebar-share-icons{margin-top:2rem}
.blog-post .blog-post-main .blog-post-sidebar .blog-post-sidebar-share-icons a{color:#3c3c3b}
.blog-post .blog-post-main .blog-post-sidebar .blog-post-sidebar-share-icons a svg{-webkit-transition:-webkit-transform .15s ease-in-out;
transition:transform .15s ease-in-out}
.blog-post .blog-post-main .blog-post-sidebar .blog-post-sidebar-share-icons a:hover svg{-webkit-transform:scale(1.1);
-moz-transform:scale(1.1);
-ms-transform:scale(1.1);
transform:scale(1.1)}
.blog-post .blog-post-main .blog-post-sidebar .blog-post-sidebar-share-icons a:not(:last-child){margin-right:.6666666667rem}
@media (max-width:1000px) {.blog-post .blog-post-main{-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column}
.blog-post .blog-post-main .blog-post-content{width:100%}
.blog-post .blog-post-main .blog-post-sidebar{width:100%;
text-align:center}
.blog-post .blog-post-main .blog-post-sidebar .blog-post-author{-webkit-justify-content:center;
justify-content:center;
margin-bottom:2rem}}
.blog-post .blog-post-next-prev{display:grid;
grid-template-columns:1fr 1fr 1fr;
grid-gap:4rem;
border-top:1px solid #dee2e6;
margin-top:6rem;
padding-top:2rem}
.blog-post .blog-post-next-prev h5{text-align:center}
.blog-post .blog-post-next-prev .blog-post-next-prev-entry:last-child{grid-column-start:3}
@media (max-width:1000px) {.blog-post .blog-post-next-prev{margin-top:3rem;
grid-template-columns:1fr;
grid-gap:2rem}
.blog-post .blog-post-next-prev .blog-post-next-prev-entry:last-child{grid-column-start:1}}
.blog-post .blog-post-related{padding-top:2rem}
.blog-post .blog-post-related h5{text-align:center}
.blog-post .blog-post-related .blog-post-related-posts{display:grid;
grid-template-columns:1fr 1fr 1fr;
grid-gap:4rem}
@media (max-width:1000px) {.blog-post .blog-post-related .blog-post-related-posts{grid-template-columns:1fr}}</style><style id="__jsx-aeedcf66895f49d7">footer{font-size:.875rem;
padding-top:3rem;
padding-bottom:4rem;
background-color:#f8f9fa;
border-top:1px solid #dee2e6;
margin-top:1rem;
color:#6f6970}
footer h5{font-size:1rem;
margin-top:0;
margin-bottom:1rem;
color:#3c3c3b;
text-transform:uppercase}
footer ul{padding:0;
list-style:none;
line-height:2}
footer a{color:#6f6970}
footer .footer-logo img, footer .footer-copyright-eclipse-logo img{-webkit-filter:grayscale(100);
filter:grayscale(100);
opacity:.5;
-webkit-transition:all .15s ease-in-out;
transition:all .15s ease-in-out}
footer .footer-logo img:hover, footer .footer-copyright-eclipse-logo img:hover{-webkit-filter:grayscale(0);
filter:grayscale(0);
opacity:1}
footer .footer-nav-section{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:row;
-ms-flex-direction:row;
flex-direction:row;
margin-bottom:6rem}
footer .footer-nav-section .footer-logo{margin-top:.4rem}
footer .footer-nav-section .footer-logo img{width:8.3rem}
footer .footer-nav-section .footer-nav-list{width:20%}
footer .footer-copyright{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:row;
-ms-flex-direction:row;
flex-direction:row;
-webkit-box-pack:justify;
-webkit-justify-content:space-between;
justify-content:space-between;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center}
footer .footer-copyright a{white-space:nowrap}
footer .footer-copyright .footer-copyright-eclipse-logo{width:17%;
margin-bottom:.5rem}
@media (max-width:1250px) {footer .footer-copyright .footer-copyright-break{display:none}
footer .footer-copyright .footer-copyright-eclipse-logo{width:30%}}
@media (max-width:1000px) {footer .footer-nav-section .footer-nav-list{width:25%}
footer .footer-copyright .footer-copyright-break{display:inline-block}
footer .footer-copyright .footer-copyright-eclipse-logo{width:40%}}
@media (max-width:768px) {footer .footer-nav-section{max-width:100%;
margin-left:auto;
margin-right:auto}}
@media (max-width:640px) {footer .footer-nav-section{max-width:80%;
margin-bottom:3rem;
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column}
footer .footer-nav-section h5{cursor:pointer}
footer .footer-nav-section h5::after{display:inline-block;
content:"";
border-top:.4em solid;
border-right:.4em solid transparent;
border-bottom:0;
border-left:.4em solid transparent;
position:absolute;
top:.75rem;
right:0}
footer .footer-nav-section .footer-nav-list{width:100%;
position:relative}
footer .footer-nav-section .footer-nav-list ul{overflow-y:hidden;
max-height:0;
-webkit-transition:all 200ms ease-in-out;
transition:all 200ms ease-in-out}
footer .footer-nav-section .footer-nav-list ul.visible{margin-bottom:2rem}
footer .footer-nav-section .footer-logo{margin:0 auto 3rem auto;
width:auto}
footer .footer-copyright{max-width:80%;
text-align:center;
margin-left:auto;
margin-right:auto;
-webkit-flex-direction:column-reverse;
-ms-flex-direction:column-reverse;
flex-direction:column-reverse}
footer .footer-copyright .footer-copyright-eclipse-logo{width:7.6rem;
margin-bottom:1rem}}</style><style id="__jsx-b068a573b7111330">.page-content.jsx-b068a573b7111330{margin-top:6em;
margin-bottom:8rem}</style><style id="__jsx-7824b3ad3820c879">html{line-height:1.15;
-webkit-text-size-adjust:100%}
body{margin:0}
main{display:block}
h1{font-size:2em;
margin:.67em 0}
hr{box-sizing:content-box;
height:0;
overflow:visible}
pre{font-family:monospace, monospace;
font-size:1em}
a{background-color:transparent}
abbr[title]{border-bottom:none;
text-decoration:underline;
text-decoration:underline dotted}
b, strong{font-weight:bolder}
code, kbd, samp{font-family:monospace, monospace;
font-size:1em}
small{font-size:80%}
sub, sup{font-size:75%;
line-height:0;
position:relative;
vertical-align:baseline}
sub{bottom:-0.25em}
sup{top:-0.5em}
img{border-style:none}
button, input, optgroup, select, textarea{font-family:inherit;
font-size:100%;
line-height:1.15;
margin:0}
button, input{overflow:visible}
button, select{text-transform:none}
button, [type=button], [type=reset], [type=submit]{-webkit-appearance:button}
button::-moz-focus-inner, [type=button]::-moz-focus-inner, [type=reset]::-moz-focus-inner, [type=submit]::-moz-focus-inner{border-style:none;
padding:0}
button:-moz-focusring, [type=button]:-moz-focusring, [type=reset]:-moz-focusring, [type=submit]:-moz-focusring{outline:1px dotted ButtonText}
fieldset{padding:.35em .75em .625em}
legend{box-sizing:border-box;
color:inherit;
display:table;
max-width:100%;
padding:0;
white-space:normal}
progress{vertical-align:baseline}
textarea{overflow:auto}
[type=checkbox], [type=radio]{box-sizing:border-box;
padding:0}
[type=number]::-webkit-inner-spin-button, [type=number]::-webkit-outer-spin-button{height:auto}
[type=search]{-webkit-appearance:textfield;
outline-offset:-2px}
[type=search]::-webkit-search-decoration{-webkit-appearance:none}
::-webkit-file-upload-button{-webkit-appearance:button;
font:inherit}
details{display:block}
summary{display:list-item}
template{display:none}
[hidden]{display:none}
.hljs, pre{display:block;
overflow-x:auto;
padding:.5em;
background:#3a2840;
color:#fff}
.hljs.language-shell :not(.bash)+.bash, .hljs.language-better-shell :not(.bash)+.bash, pre.language-shell :not(.bash)+.bash, pre.language-better-shell :not(.bash)+.bash{color:#d2a8e0}
pre{border-radius:.8rem;
padding:1rem;
font-size:.875rem;
margin:1.5rem 0}
.hljs-keyword, .hljs-selector-tag, .hljs-tag{color:#d2a8e0}
.hljs-template-tag{color:red}
.hljs-number{color:#6cb9f0}
.hljs-variable, .hljs-template-variable, .hljs-attribute, .hljs-literal{color:#c9e5f9}
.hljs-subst{color:red}
.hljs-title, .hljs-name, .hljs-selector-id, .hljs-selector-class, .hljs-section, .hljs-type{color:#f0a46c}
.hljs-symbol, .hljs-bullet, .hljs-link{color:#d2a8e0}
.hljs-deletion, .hljs-string, .hljs-built_in, .hljs-builtin-name{color:#6cb9f0}
.hljs-addition, .hljs-comment, .hljs-quote, .hljs-meta{color:#adb5bd}
.hljs-emphasis{font-style:italic}
.hljs-strong{font-weight:bold}
#nprogress{pointer-events:none}
#nprogress .bar{background:#29d;
position:fixed;
z-index:1031;
top:0;
left:0;
width:100%;
height:2px}
#nprogress .peg{display:block;
position:absolute;
right:0px;
width:100px;
height:100%;
box-shadow:0 0 10px #29d, 0 0 5px #29d;
opacity:1;
-webkit-transform:rotate(3deg) translate(0px, -4px);
-ms-transform:rotate(3deg) translate(0px, -4px);
-webkit-transform:rotate(3deg) translate(0px, -4px);
-moz-transform:rotate(3deg) translate(0px, -4px);
-ms-transform:rotate(3deg) translate(0px, -4px);
transform:rotate(3deg) translate(0px, -4px)}
#nprogress .spinner{display:block;
position:fixed;
z-index:1031;
top:15px;
right:15px}
#nprogress .spinner-icon{width:18px;
height:18px;
box-sizing:border-box;
border:solid 2px transparent;
border-top-color:#29d;
border-left-color:#29d;
border-radius:50%;
-webkit-animation:nprogress-spinner 400ms linear infinite;
-webkit-animation:nprogress-spinner 400ms linear infinite;
animation:nprogress-spinner 400ms linear infinite}
.nprogress-custom-parent{overflow:hidden;
position:relative}
.nprogress-custom-parent #nprogress .spinner, .nprogress-custom-parent #nprogress .bar{position:absolute}
@keyframes nprogress-spinner {0% {-webkit-transform:rotate(0deg)}100% {-webkit-transform:rotate(360deg)}}
@keyframes nprogress-spinner {0% {transform:rotate(0deg)}100% {transform:rotate(360deg)}}
#nprogress .bar{background:#782b90}
#nprogress .peg{box-shadow:0 0 10px #782b90, 0 0 5px #782b90}
#nprogress .spinner-icon{border-top-color:#782b90;
border-left-color:#782b90}
html{box-sizing:border-box}
*, *::before, *::after{box-sizing:inherit}
:root{font-size:18px}
@media (max-width:1000px) {:root{font-size:17.1px}}
@media (max-width:768px) {:root{font-size:16.2px}}
@media (max-width:640px) {:root{font-size:15.3px}}
body, input{font-family:Roboto, sans-serif;
font-weight:300;
line-height:1.7;
color:#3c3c3b}
input{outline:none}
h1, h2, h3, h4, h5, h6{font-weight:400}
h1{font-size:2.5rem}
h2{font-size:2rem}
h3{font-size:1.75rem}
h4{font-size:1.5rem}
h5{font-size:1.25rem}
h6{font-size:1.1rem}
.container{width:100%;
padding-right:.8rem;
padding-left:.8rem;
margin-right:auto;
margin-left:auto}
@media (min-width:640px) {.container{max-width:620px}}
@media (min-width:768px) {.container{max-width:738px}}
@media (min-width:1000px) {.container{max-width:950px}}
@media (min-width:1250px) {.container{max-width:1180px}}
@media (min-width:1250px) {.container-narrow{max-width:950px}}
.img-fluid{max-width:100%}
a{-webkit-text-decoration:none;
text-decoration:none;
color:#782b90}
a:hover{text-decoration:underline;
color:#571f69}
img{vertical-align:middle}
svg{overflow:hidden;
vertical-align:middle}
code, pre{font-family:"Roboto Mono", SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
p code{display:-webkit-inline-box;
display:-webkit-inline-flex;
display:-ms-inline-flexbox;
display:inline-flex;
max-width:100%;
overflow:auto}
.heading-anchor{opacity:0;
-webkit-align-self:flex-start;
-ms-flex-item-align:flex-start;
align-self:flex-start;
outline:none}
.heading-anchor::after{content:"#";
position:absolute;
margin-left:-1.5rem;
color:#ced4da;
padding-right:.45rem}
.heading-anchor:hover{opacity:1}
h2:hover .heading-anchor, h3:hover .heading-anchor, h4:hover .heading-anchor, h5:hover .heading-anchor, h6:hover .heading-anchor{opacity:1}
h1 .heading-anchor{display:none}
h4 .heading-anchor::after, h5 .heading-anchor::after, h6 .heading-anchor::after{padding-right:.6rem}</style><style data-href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap">@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5vAA.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Me5g.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9vAA.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu72xKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu5mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu4WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7GxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style><style data-href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@300;400&display=swap">@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZKCA.woff) format('woff')}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-59Y.woff) format('woff')}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCkYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCAYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCgYb9lecyVC4A.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCcYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCsYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCoYb9lecyVC4A.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVi2ZhZI2eCN5jzbjEETS9weq8-33mZGCQYb9lecyU.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-19-7DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-19a7DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-1967DQk6YvNkeg.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-19G7DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-1927DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-19y7DQk6YvNkeg.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto Condensed';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotocondensed/v24/ieVl2ZhZI2eCN5jzbjEETS9weq8-19K7DQk6YvM.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style><style data-href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&display=swap">@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vqPQA.woff) format('woff')}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_SeW-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_QOW-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_R-W-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_S-W-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_SuW-AJi8SJQtQ4Y.woff) format('woff');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/robotomono/v13/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_3vq_ROW-AJi8SJQt.woff) format('woff');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body data-build-time="2022-02-19T06:05:20.355Z" data-build-commit-id="9915351aa95bb320364fd219c4230141e7cce819" data-build-run-id="1867964147"><div id="__next" data-reactroot=""><main class="jsx-b068a573b7111330 page"><header><div class="jsx-f705e145f931f504 navbar"><div class="jsx-f705e145f931f504 navbar-content container"><div class="jsx-f705e145f931f504 navbar-logo"><a class="jsx-f705e145f931f504" href="/"><img src="data:image/svg+xml,%3csvg version=&#x27;1.1&#x27; id=&#x27;Layer_1&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; viewBox=&#x27;0 0 1232.6 315.2&#x27; style=&#x27;enable-background:new 0 0 1232.6 315.2&#x27; xml:space=&#x27;preserve&#x27;%3e%3cstyle%3e.st0%7bfill:%23782a91%7d%3c/style%3e%3cpath d=&#x27;M120.9 214.2 190.5 0h52.3l-98.5 273.8H98.2L0 0h52.1l68.8 214.2zm291.2-62.6H299.6v84.2H431v38H252V0h177.7v38.4H299.6V114h112.5v37.6zm83.7-113.2H546c16.5.3 29 4.4 37.3 12.4 8.3 8 12.5 19.4 12.5 34 0 14-4.5 25.1-13.5 33.2-9 8.1-21.6 12.1-37.6 12.1h-27.1v24.2l86.1 119.5h51v-2.4l-77.2-106.7c24.9-5.5 43.3-21.7 52.6-35.9 8.2-12.6 13.3-27.7 13.3-46 0-26.8-8.6-47.4-25.8-61.5C600.5 7.1 576.1 0 544.5 0h-96.3v273.8h47.6&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;m1052.3 157.7-41.5 62.7 29.7 53.4h85.1z&#x27;/%3e%3ccircle class=&#x27;st0&#x27; cx=&#x27;827.9&#x27; cy=&#x27;274.7&#x27; r=&#x27;40.5&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;m1037 0-47.6 74.2L949 0h-84l85.3 135.8-67.1 105.7c5.7 9.5 9.1 20.5 9.2 32.4h50.1L1121.3 0H1037z&#x27;/%3e%3cpath d=&#x27;M763.5 273.8c.1-9.9 2.5-19.2 6.6-27.5V38.4h85.4V0H638.2v38.4h84.6v235.4h40.7zm414-266.9h-15.3v42.2h-8.5V6.9h-15.2V0h39v6.9zM1193 0l14.2 37.7L1221.3 0h11v49.1h-8.5V32.9l.8-21.7-14.5 37.9h-6.1l-14.5-37.8.8 21.6v16.2h-8.5V0h11.2z&#x27;/%3e%3c/svg%3e" alt="Vert.x Logo" class="jsx-f705e145f931f504"/></a></div><div class="jsx-f705e145f931f504 navbar-collapse-button"><span class="jsx-f705e145f931f504"></span><span class="jsx-f705e145f931f504"></span><span class="jsx-f705e145f931f504"></span></div><div class="jsx-f705e145f931f504 navbar-right"><div class="jsx-f705e145f931f504 navbar-menu"><span class="jsx-f705e145f931f504 navbar-menu-item with-drop-down"><div class="jsx-6650573c8f14945d dropdown"><a class="jsx-6650573c8f14945d dropdown-title">Start<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="jsx-6650573c8f14945d dropdown-menu"><a class="jsx-f705e145f931f504" href="/introduction-to-vertx-and-reactive/"><li class="jsx-400ec7965926e858 dropdown-item">Intro to reactive</li></a><a class="jsx-f705e145f931f504" href="/get-started/"><li class="jsx-400ec7965926e858 dropdown-item">Get started</li></a><a href="https://start.vertx.io/" target="_blank" rel="noreferrer" class="jsx-f705e145f931f504"><li class="jsx-400ec7965926e858 dropdown-item">App generator <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="jsx-f705e145f931f504 navbar-menu-item" href="/docs/">Docs</a><span class="jsx-f705e145f931f504 navbar-menu-item with-drop-down"><div class="jsx-6650573c8f14945d dropdown"><a class="jsx-6650573c8f14945d dropdown-title">Resources<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg></a><ul class="jsx-6650573c8f14945d dropdown-menu"><a class="jsx-f705e145f931f504" href="/faq/"><li class="jsx-400ec7965926e858 dropdown-item">FAQ</li></a><a class="jsx-f705e145f931f504" href="/channels/"><li class="jsx-400ec7965926e858 dropdown-item">Channels</li></a><a href="https://how-to.vertx.io/" target="_blank" rel="noreferrer" class="jsx-f705e145f931f504"><li class="jsx-400ec7965926e858 dropdown-item">How-Toâ€™s <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a><a href="https://github.com/vert-x3/vertx-eventbus-bridge-clients" target="_blank" rel="noreferrer" class="jsx-f705e145f931f504"><li class="jsx-400ec7965926e858 dropdown-item">EventBus Bridge Clients <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a><a href="https://github.com/vert-x3/advanced-vertx-guide" target="_blank" rel="noreferrer" class="jsx-f705e145f931f504"><li class="jsx-400ec7965926e858 dropdown-item">Advanced Vert.x Guide <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-link-icon"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></li></a></ul></div></span><a class="jsx-f705e145f931f504 navbar-menu-item" href="/blog/">Blog</a><a class="jsx-f705e145f931f504 navbar-menu-item" href="/community/">Community</a></div><div class="jsx-f705e145f931f504 navbar-social"><a href="https://github.com/vert-x3/vertx-awesome" title="Awesome Vert.x" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="List of awesome Vert.x projects"><title>Awesome Vert.x</title><path d="M24 11.438l-6.154-5.645-.865.944 5.128 4.7H1.895l5.128-4.705-.865-.943-6.154 5.649H0v3.72c0 1.683 1.62 3.053 3.61 3.053h3.795c1.99 0 3.61-1.37 3.61-3.051v-2.446h1.97v2.446c0 1.68 1.62 3.051 3.61 3.051h3.794c1.99 0 3.61-1.37 3.61-3.051v-3.721z"></path></svg></a><a href="https://stackoverflow.com/questions/tagged/vert.x" title="Stack Overflow" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Stack Overflow questions related to Vert.x"><title>stackoverflow</title><path d="M15.725 0l-1.72 1.277 6.39 8.588 1.716-1.277L15.725 0zm-3.94 3.418l-1.369 1.644 8.225 6.85 1.369-1.644-8.225-6.85zm-3.15 4.465l-.905 1.94 9.702 4.517.904-1.94-9.701-4.517zm-1.85 4.86l-.44 2.093 10.473 2.201.44-2.092-10.473-2.203zM1.89 15.47V24h19.19v-8.53h-2.133v6.397H4.021v-6.396H1.89zm4.265 2.133v2.13h10.66v-2.13H6.154Z"></path></svg></a><a href="https://www.youtube.com/channel/UCGN6L3tRhs92Uer3c6VxOSA" title="YouTube" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="YouTube channel of Vert.x"><title>youtube</title><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"></path></svg></a><a href="https://discord.gg/KzEMwP2" title="Discord" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Eclipse Vert.x channel on Discord"><title>discord</title><path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189Z"></path></svg></a><a href="https://groups.google.com/forum/?fromgroups#!forum/vertx" title="Vert.x User Group" target="_blank" rel="noopener noreferrer" class="jsx-f705e145f931f504 navbar-social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="A Google group for Vert.x users"><title>Vert.x User Group</title><path d="M.92 3.332c-.776 0-1.216.67-.692 1.383l2.537 4.403v7.86c0 2.013 1.467 3.69 3.459 3.69H20.31a3.75 3.75 0 003.69-3.69V7.043a3.723 3.723 0 00-3.668-3.71zm5.786 3.71H20.1c.587 0 1.153.357 1.153.923 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.923 1.153-.923zm0 3.69H20.1c.587 0 1.153.356 1.153.922 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.922 1.153-.922zm-.021 3.71h9.705c.587 0 1.153.356 1.153.922 0 .566-.566.923-1.153.923H6.685c-.587 0-1.153-.357-1.153-.923 0-.566.566-.922 1.153-.922Z"></path></svg></a></div></div></div></div></header><div class="jsx-b068a573b7111330 page-content"><div class="jsx-b068a573b7111330 container"><div class="jsx-a04fe959d555a951 blog-post"><div class="jsx-2ac0bd13852cf810 blog-navbar"><h2 class="jsx-2ac0bd13852cf810">Blog</h2><ul class="jsx-2ac0bd13852cf810"><li class="jsx-2ac0bd13852cf810"><a class="jsx-2ac0bd13852cf810" href="/blog/">All posts</a></li><li class="jsx-2ac0bd13852cf810"><a class="jsx-2ac0bd13852cf810" href="/blog/category/releases/">releases</a></li><li class="jsx-2ac0bd13852cf810"><a class="jsx-2ac0bd13852cf810" href="/blog/category/guides/">guides</a></li><li class="jsx-2ac0bd13852cf810"><a class="jsx-2ac0bd13852cf810" href="/blog/category/security/">security</a></li><li class="jsx-2ac0bd13852cf810"><a class="jsx-2ac0bd13852cf810" href="/blog/category/news/">news</a></li></ul><div class="jsx-2ac0bd13852cf810 feed-icons"><a href="/feed/atom.xml" class="jsx-2ac0bd13852cf810"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></div></div><div class="blog-post-main"><div class="blog-post-content"><h1>JWT Authorization for Vert.x with Keycloak</h1><p><strong>TL;DR:</strong></p><p>In this blog post youâ€™ll learn:</p><ul><li>JWT founÂ­daÂ­tions</li><li>How to proÂ­tect routes with a JWT AuÂ­thoÂ­rizaÂ­tion</li><li>How to exÂ­tract claims from a JWT enÂ­coded token</li><li>How to apply RBAC with KeyÂ­cloak Realm roles</li></ul><h2 id="hello-again"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#hello-again"></a>Hello again</h2><p>Hi there! In my last blog post <a href="/blog/easy-sso-for-vert-x-with-keycloak/">Easy SSO for Vert.x with KeyÂ­cloak</a>, we learned how to conÂ­figÂ­ure sinÂ­gle sign-â€‹on for a Vert.x web apÂ­pliÂ­caÂ­tion with KeyÂ­cloak and OpenID conÂ­nect. This time, weâ€™ll see how we can proÂ­tect an apÂ­pliÂ­caÂ­tion with Vert.xâ€™s <a href="/docs/vertx-web/java/#_jwt_authorisation">JWT AuÂ­thoÂ­rizaÂ­tion</a> supÂ­port and KeyÂ­cloak.</p><h2 id="keycloak-setup"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#keycloak-setup"></a>Keycloak Setup</h2><p>To seÂ­cure our Vert.x app, we need to use a KeyÂ­cloak server for obÂ­tainÂ­ing JWT toÂ­kens. AlÂ­though <a href="https://www.keycloak.org/docs/latest/getting_started/">KeyÂ­cloak has a great getÂ­ting started guide</a> I wanted to make it a bit easÂ­ier to put everyÂ­thing toÂ­gether, thereÂ­fore I preÂ­pared a local KeyÂ­cloak docker conÂ­tainer <a href="https://github.com/thomasdarimont/vertx-playground/tree/master/jwt-service-vertx#start-keycloak-with-the-vertx-realm">as deÂ­scribed here</a>, which comes with all the reÂ­quired conÂ­figÂ­uÂ­raÂ­tion in place, that you can start easÂ­ily.</p><p>The preÂ­conÂ­figÂ­ured KeyÂ­cloak realm <code>vertx</code> conÂ­tains a <code>vertx-service</code> OpenID conÂ­nect client for our Vert.x app and a set
of users for testÂ­ing. To ease testÂ­ing, the <code>vertx-service</code> is conÂ­figÂ­ured with <code>Direct Access Grant</code> enÂ­abled in KeyÂ­cloak, which
enÂ­ables supÂ­port for the OAuth2 reÂ­source owner passÂ­word creÂ­denÂ­tials grant (ROPC) flow.</p><p>To start KeyÂ­cloak with the preÂ­conÂ­figÂ­ured realm, just start the docker conÂ­tainer with the folÂ­lowÂ­ing comÂ­mand:</p><pre><code class="hljs language-bash">docker run \
  -it \
  --name vertx-keycloak \
  --rm \
  -e KEYCLOAK_USER=admin \
  -e KEYCLOAK_PASSWORD=admin \
  -e KEYCLOAK_IMPORT=/tmp/vertx-realm.json \
  -v <span class="hljs-variable">$PWD</span>/vertx-realm.json:/tmp/vertx-realm.json \
  -v <span class="hljs-variable">$PWD</span>/data:/opt/jboss/keycloak/standalone/data \
  -p 8080:8080 \
  quay.io/keycloak/keycloak:11.0.2
</code></pre><h2 id="vertx-app"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#vertx-app"></a>Vert.x App</h2><p>The exÂ­amÂ­ple app conÂ­sists of a sinÂ­gle <code>Verticle</code>, that runs on <code>http://localhost:3000</code> and proÂ­vides a few routes with proÂ­tected reÂ­sources. <a href="https://github.com/thomasdarimont/vertx-playground/tree/master/jwt-service-vertx/src/main/java/demo/MainVerticle.java">You can find the comÂ­plete exÂ­amÂ­ple here</a>.</p><p>Our web app conÂ­tains the folÂ­lowÂ­ing proÂ­tected routes with hanÂ­dlers:</p><ul><li><code>/api/greet</code> - The greetÂ­ing reÂ­source, which reÂ­turns a greetÂ­ing mesÂ­sage, only auÂ­thenÂ­tiÂ­cated users can acÂ­cess this reÂ­source.</li><li><code>/api/user</code> - The user reÂ­source, which reÂ­turns some inÂ­forÂ­maÂ­tion about the user, only users with role <code>user</code> can acÂ­cess this reÂ­source.</li><li><code>/api/admin</code> - The user reÂ­source, which reÂ­turns some inÂ­forÂ­maÂ­tion about the admin, only users with role <code>admin</code> can acÂ­cess this reÂ­source.</li></ul><p>This exÂ­amÂ­ple is built with Vert.x verÂ­sion 3.9.3.</p><h3 id="running-the-app-in-the-console"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#running-the-app-in-the-console"></a>Running the app in the console</h3><p>To run the app, we need to build it first:</p><pre><code class="hljs language-bash"><span class="hljs-built_in">cd</span> jwt-service-vertx
mvn clean package
</code></pre><p>This creÂ­ates a jar, which we can run:</p><pre><code class="hljs language-bash">java -jar target/*.jar
</code></pre><p>Note, that we need to start KeyÂ­cloak first, since our app fetches the conÂ­figÂ­uÂ­raÂ­tion from KeyÂ­cloak on startup.</p><h3 id="running-the-app-in-the-ide"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#running-the-app-in-the-ide"></a>Running the app in the IDE</h3><p>We can also run the app diÂ­rectly from your favourite IDE like InÂ­telÂ­liJ Idea or Eclipse.
To run the app from an IDE, we need to creÂ­ate a launch conÂ­figÂ­uÂ­raÂ­tion and use the main class <code>io.vertx.core.Launcher</code>. Then set the the proÂ­gram arÂ­guÂ­ments to
<code>run demo.MainVerticle</code> and use the classÂ­path of the <code>jwt-service-vertx</code> modÂ­ule.
With that in place we should be able to run the app.</p><h2 id="jwt-authorization"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#jwt-authorization"></a>JWT Authorization</h2><h3 id="jwt-foundations"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#jwt-foundations"></a>JWT Foundations</h3><p><a href="https://tools.ietf.org/html/rfc7519">JSON Web Token (JWT)</a> is an open stanÂ­dard to seÂ­curely exÂ­change inÂ­forÂ­maÂ­tion beÂ­tween two parÂ­ties in the form
of <a href="https://base64.guru/standards/base64url">Base64URL</a> enÂ­coded JSON obÂ­jects.
A stanÂ­dard JWT is just a string which comÂ­prises three base64url enÂ­coded parts header, payÂ­load and a sigÂ­naÂ­ture, which are sepÂ­aÂ­rated by a â€<code>.</code>â€ charÂ­acÂ­ter.
There are other variÂ­ants of JWT that can have more parts.</p><p>An exÂ­amÂ­ple JWT can look like this:</p><pre><code class="hljs language-text">eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJjN00xX2hkWjAtWDNyZTl1dmZLSFRDUWRxYXJQYnBMblVJMHltdkF0U1RzIn0.eyJleHAiOjE2MDEzMTg0MjIsImlhdCI6MTYwMTMxODEyMiwianRpIjoiNzYzNWY1YTEtZjFkNy00NTdkLWI4NjktYWQ0OTIzNTJmNGQyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2F1dGgvcmVhbG1zL3ZlcnR4IiwiYXVkIjoiYWNjb3VudCIsInN1YiI6IjI3YjNmYWMwLTlhZWMtNDQyMS04MWNmLWQ0YjAyNDI4ZjkwMSIsInR5cCI6IkJlYXJlciIsImF6cCI6InZlcnR4LXNlcnZpY2UiLCJzZXNzaW9uX3N0YXRlIjoiNjg3MDgyMTMtNDBiNy00NThhLWFlZTEtMzlkNmY5ZGEwN2FkIiwiYWNyIjoiMSIsInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJvZmZsaW5lX2FjY2VzcyIsInVtYV9hdXRob3JpemF0aW9uIiwidXNlciJdfSwicmVzb3VyY2VfYWNjZXNzIjp7ImFjY291bnQiOnsicm9sZXMiOlsibWFuYWdlLWFjY291bnQiLCJtYW5hZ2UtYWNjb3VudC1saW5rcyIsInZpZXctcHJvZmlsZSJdfX0sInNjb3BlIjoiZW1haWwgcHJvZmlsZSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJuYW1lIjoiVGhlbyBUZXN0ZXIiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJ0ZXN0ZXIiLCJnaXZlbl9uYW1lIjoiVGhlbyIsImZhbWlseV9uYW1lIjoiVGVzdGVyIiwiZW1haWwiOiJ0b20rdGVzdGVyQGxvY2FsaG9zdCJ9.NN1ZGE3f3LHE0u7T6Vfq5yPMKoZ6SmrUxoFopAXZm5wVgMOsJHB8BgHQTDm7u0oTVU0ZHlKH2-o11RKK7Mz0mLqMy2EPdkGY9Bqtj5LZ8oTp8FaVqY1g5Fr5veXYpOMbc2fke-e2hG8sAfSjWz1Mq9BUhJ7HdK7TTIte12pub2nbUs4APYystJWx49cYmUwZ-5c9X295V-NX9UksuMSzFItZ4cACVKi68m9lkR4RuNQKFTuLvWsorz9yRx884e4cnoT_JmfSfYBIl31FfnQzUtCjluUzuD9jVXc_vgC7num_0AreOZiUzpglb8UjKXjswTHF-v_nEIaq7YmM5WKpeg
</code></pre><p>The header and payÂ­load secÂ­tions conÂ­tain inÂ­forÂ­maÂ­tion as a JSON obÂ­ject, whereas the sigÂ­naÂ­ture is just a plain string. JSON obÂ­jects conÂ­tain key value pairs which are called <code>claims</code>.</p><p>The claims inÂ­forÂ­maÂ­tion can be verÂ­iÂ­fied and trusted beÂ­cause it is digÂ­iÂ­tally signed with the priÂ­vate key from a pubÂ­lic/priÂ­vate key-â€‹pair.
The sigÂ­naÂ­ture can later be verÂ­iÂ­fied with a corÂ­reÂ­spondÂ­ing pubÂ­lic key. The idenÂ­tiÂ­fier of the pubÂ­lic/priÂ­vate key-â€‹pair used to sign a JWT can be
conÂ­tained in a speÂ­cial claim called <code>kid</code> (key idenÂ­tiÂ­fier) in the header secÂ­tion of the JWT.</p><p>An exÂ­amÂ­ple for a JWT header that refÂ­erÂ­ences a pubÂ­lic/priÂ­vate key-â€‹pair looks like this:</p><pre><code class="hljs language-json">{
  <span class="hljs-attr">&quot;alg&quot;</span>: <span class="hljs-string">&quot;RS256&quot;</span>,
  <span class="hljs-attr">&quot;typ&quot;</span>: <span class="hljs-string">&quot;JWT&quot;</span>,
  <span class="hljs-attr">&quot;kid&quot;</span>: <span class="hljs-string">&quot;c7M1_hdZ0-X3re9uvfKHTCQdqarPbpLnUI0ymvAtSTs&quot;</span>
}
</code></pre><p>It is quite comÂ­mon to use JWTs to conÂ­vey inÂ­forÂ­maÂ­tion about auÂ­thenÂ­tiÂ­caÂ­tion (user idenÂ­tity) and auÂ­thoÂ­rizaÂ­tion (scopes, user roles, perÂ­misÂ­sions and other claims).
OpenID providers such as <a href="https://www.keycloak.org/">KeyÂ­cloak</a> supÂ­port isÂ­suÂ­ing OAuth2 acÂ­cess toÂ­kens after auÂ­thenÂ­tiÂ­caÂ­tion for users to clients in the form of JWTs.
An acÂ­cess token can then be used to acÂ­cess other serÂ­vices or APIs on beÂ­half of the user. The server proÂ­vidÂ­ing those serÂ­vices or APIs is often called <code>resource server</code>.</p><p>An exÂ­amÂ­ple JWT payÂ­load genÂ­erÂ­ated by KeyÂ­cloak looks like this:</p><pre><code class="hljs language-json">{
  <span class="hljs-attr">&quot;exp&quot;</span>: <span class="hljs-number">1601318422</span>,
  <span class="hljs-attr">&quot;iat&quot;</span>: <span class="hljs-number">1601318122</span>,
  <span class="hljs-attr">&quot;jti&quot;</span>: <span class="hljs-string">&quot;7635f5a1-f1d7-457d-b869-ad492352f4d2&quot;</span>,
  <span class="hljs-attr">&quot;iss&quot;</span>: <span class="hljs-string">&quot;http://localhost:8080/auth/realms/vertx&quot;</span>,
  <span class="hljs-attr">&quot;aud&quot;</span>: <span class="hljs-string">&quot;account&quot;</span>,
  <span class="hljs-attr">&quot;sub&quot;</span>: <span class="hljs-string">&quot;27b3fac0-9aec-4421-81cf-d4b02428f901&quot;</span>,
  <span class="hljs-attr">&quot;typ&quot;</span>: <span class="hljs-string">&quot;Bearer&quot;</span>,
  <span class="hljs-attr">&quot;azp&quot;</span>: <span class="hljs-string">&quot;vertx-service&quot;</span>,
  <span class="hljs-attr">&quot;session_state&quot;</span>: <span class="hljs-string">&quot;68708213-40b7-458a-aee1-39d6f9da07ad&quot;</span>,
  <span class="hljs-attr">&quot;acr&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>,
  <span class="hljs-attr">&quot;realm_access&quot;</span>: {
    <span class="hljs-attr">&quot;roles&quot;</span>: [
      <span class="hljs-string">&quot;offline_access&quot;</span>,
      <span class="hljs-string">&quot;uma_authorization&quot;</span>,
      <span class="hljs-string">&quot;user&quot;</span>
    ]
  },
  <span class="hljs-attr">&quot;scope&quot;</span>: <span class="hljs-string">&quot;email profile&quot;</span>,
  <span class="hljs-attr">&quot;email_verified&quot;</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;Theo Tester&quot;</span>,
  <span class="hljs-attr">&quot;preferred_username&quot;</span>: <span class="hljs-string">&quot;tester&quot;</span>,
  <span class="hljs-attr">&quot;given_name&quot;</span>: <span class="hljs-string">&quot;Theo&quot;</span>,
  <span class="hljs-attr">&quot;family_name&quot;</span>: <span class="hljs-string">&quot;Tester&quot;</span>,
  <span class="hljs-attr">&quot;email&quot;</span>: <span class="hljs-string">&quot;tom+tester@localhost&quot;</span>
}
</code></pre><p>If a <code>resource server</code> reÂ­ceives a reÂ­quest with such an acÂ­cess token, it needs to verÂ­ify and inÂ­spect the token beÂ­fore it can trust its conÂ­tent.
To verÂ­ify the token, the <code>resource server</code> needs to obÂ­tain the <code>public key</code> to check the token sigÂ­naÂ­ture.
This <code>public key</code> can eiÂ­ther be conÂ­figÂ­ured staÂ­tÂ­iÂ­cally or fetched dyÂ­namÂ­iÂ­cally from the OpenID Provider by leverÂ­agÂ­ing the <code>kid</code> inÂ­forÂ­maÂ­tion from the JWT header secÂ­tion.
Note that most <code>OpenID providers</code>, such as KeyÂ­cloak, proÂ­vide a dedÂ­iÂ­cated endÂ­point for dyÂ­namic pubÂ­lic key lookups, e.g. <code>http://localhost:8080/auth/realms/vertx/protocol/openid-connect/certs</code>.
A stanÂ­dard for proÂ­vidÂ­ing pubÂ­lic key inÂ­forÂ­maÂ­tion is <a href="https://tools.ietf.org/html/rfc7517">JSON Web Key Set (JWKS)</a>.
The JWKS inÂ­forÂ­maÂ­tion is usuÂ­ally cached by the reÂ­source server to avoid the overÂ­head of fetchÂ­ing JWKS for every reÂ­quest.</p><p>An exÂ­amÂ­ple reÂ­sponse for KeyÂ­cloakâ€™s JWKS endÂ­point looks like this:</p><pre><code class="hljs language-json">{
   <span class="hljs-attr">&quot;keys&quot;</span>:[
      {
         <span class="hljs-attr">&quot;kid&quot;</span>:<span class="hljs-string">&quot;c7M1_hdZ0-X3re9uvfKHTCQdqarPbpLnUI0ymvAtSTs&quot;</span>,
         <span class="hljs-attr">&quot;kty&quot;</span>:<span class="hljs-string">&quot;RSA&quot;</span>,
         <span class="hljs-attr">&quot;alg&quot;</span>:<span class="hljs-string">&quot;RS256&quot;</span>,
         <span class="hljs-attr">&quot;use&quot;</span>:<span class="hljs-string">&quot;sig&quot;</span>,
         <span class="hljs-attr">&quot;n&quot;</span>:<span class="hljs-string">&quot;iFuX2bAXA99Yrv6YEvpV9tjS52krP5UJ7lFL02Zl83PPV6PiLIWKTqF71bfTKnVDxO421xAsBw9f6dlgoyxxY1H_bzJQQryQkry7DA7tI_SnKVsehLgeF-tCcjRF_MF1kM14F1A5Zsu6oYIkMZvgJIRM-ejtz3aUcdnLcTvpPrmfvj7KwRgNsfm6Q-kO0-OAf6m6LaRvaC5VpTIRoVxXNhSIiGKuZ4d05Yk0-HdOR0D0sfOujYzleJmTGBEIAmdWpZqUXiSWbzmpw8mJmacFTP9v8lsTUYZrXc69xm5fHaNJ6PO_E-IKiPKT7OeoM2l3HIK76a4azVL1Ewbv1UtMFw&quot;</span>,
         <span class="hljs-attr">&quot;e&quot;</span>:<span class="hljs-string">&quot;AQAB&quot;</span>,
         <span class="hljs-attr">&quot;x5c&quot;</span>:[
            <span class="hljs-string">&quot;MIICmTCCAYECBgFwplKOujANBgkqhkiG9w0BAQsFADAQMQ4wDAYDVQQDDAV2ZXJ0eDAeFw0yMDAzMDQxNjExMzNaFw0zMDAzMDQxNjEzMTNaMBAxDjAMBgNVBAMMBXZlcnR4MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAiFuX2bAXA99Yrv6YEvpV9tjS52krP5UJ7lFL02Zl83PPV6PiLIWKTqF71bfTKnVDxO421xAsBw9f6dlgoyxxY1H/bzJQQryQkry7DA7tI/SnKVsehLgeF+tCcjRF/MF1kM14F1A5Zsu6oYIkMZvgJIRM+ejtz3aUcdnLcTvpPrmfvj7KwRgNsfm6Q+kO0+OAf6m6LaRvaC5VpTIRoVxXNhSIiGKuZ4d05Yk0+HdOR0D0sfOujYzleJmTGBEIAmdWpZqUXiSWbzmpw8mJmacFTP9v8lsTUYZrXc69xm5fHaNJ6PO/E+IKiPKT7OeoM2l3HIK76a4azVL1Ewbv1UtMFwIDAQABMA0GCSqGSIb3DQEBCwUAA4IBAQBxcXiTtGoo4/eMNwhagYH8QpK1n7fxgzn4mkESU3wD+rnPOAh/xFmx5c3aq8X+8W2z7oopO86ZBSQ8HfbzViBP0uwvf7s7E6Q8FOqrUNv0Kj308A7hF1IOqOhCJE2nABIWJduYz5dWZN434Q9El30L1eOYTtjBUmCdP7/CM+1bvxIT+CYrWmjI9zCMJxhuixmLffppsLCjGtNgFBemjQyCrLxpEGCfy8QGb4pTY/XaHuJ7k6ZaQkVeTbeDzaZbHc9zT5qgf6w4Gp7y+uPZdAsasrwiqm3YBtyBfaK42luk09nHpV6PRKpftnyLVPwlQiJAW6ZMckvDwmnDst70msnb&quot;</span>
         ],
         <span class="hljs-attr">&quot;x5t&quot;</span>:<span class="hljs-string">&quot;MVYTXCx5cUQ8lT1ymIDDRYO7_ZI&quot;</span>,
         <span class="hljs-attr">&quot;x5t#S256&quot;</span>:<span class="hljs-string">&quot;yBDVTlfR0e7cv3HxbbkfvGKVs5W1VQtFs7haE_js3DY&quot;</span>
      }
   ]
}
</code></pre><p>The <code>keys</code> array conÂ­tains the JWKS strucÂ­ture with the pubÂ­lic key inÂ­forÂ­maÂ­tion that beÂ­longs to the pubÂ­lic/priÂ­vate key-â€‹pair which was used
to sign the JWT acÂ­cess token from above. Note the matchÂ­ing <code>kid</code> claim from our earÂ­lier JWT header exÂ­amÂ­ple.</p><p>Now that we have the apÂ­proÂ­priÂ­ate pubÂ­lic key, we can use the inÂ­forÂ­maÂ­tion from the JWT header to valÂ­iÂ­date the sigÂ­naÂ­ture of the JWT acÂ­cess token.
If the sigÂ­naÂ­ture is valid, we can go on and check adÂ­diÂ­tional claims from the payÂ­load secÂ­tion of the JWT, such as exÂ­piÂ­raÂ­tion, alÂ­lowed isÂ­suer and auÂ­diÂ­ence etc. </p><p>Now that we have the necÂ­esÂ­sary buildÂ­ing blocks in place, we can fiÂ­nally look at how to conÂ­figÂ­ure JWT auÂ­thoÂ­rizaÂ­tion in Vert.x.</p><h3 id="jwt-authorization-in-vertx"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#jwt-authorization-in-vertx"></a>JWT Authorization in Vert.x</h3><p>SetÂ­ting up JWT auÂ­thoÂ­rizaÂ­tion in Vert.x is quite easy. First we need to add the <code>vertx-auth-jwt</code> modÂ­ule as a deÂ­penÂ­dency to our project.</p><pre><code class="hljs language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.vertx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vertx-auth-jwt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre><p>In our exÂ­amÂ­ple, the whole JWT auÂ­thoÂ­rizaÂ­tion setup hapÂ­pens in the method <code>setupJwtAuth</code>.</p><p>We use a <code>WebClient</code> to dyÂ­namÂ­iÂ­cally fetch the pubÂ­lic key inÂ­forÂ­maÂ­tion from the <code>/protocol/openid-connect/certs</code> JWKS endÂ­point relÂ­aÂ­tive to our KeyÂ­cloak isÂ­suer URL.
After that, we conÂ­figÂ­ure a <code>JWTAuth</code> inÂ­stance and cusÂ­tomize the JWT valÂ­iÂ­daÂ­tion via <code>JWTOptions</code> and <code>JWTAuthOptions</code>.
Note that we use KeyÂ­cloakâ€™s realm roles for role based auÂ­thoÂ­rizaÂ­tion via the <code>JWTAuthOptions#setPermissionsClaimKey(..)</code> method.</p><pre><code class="hljs language-java"><span class="hljs-function"><span class="hljs-keyword">private</span> Future&lt;Startup&gt; <span class="hljs-title">setupJwtAuth</span><span class="hljs-params">(Startup startup)</span> </span>{

    <span class="hljs-keyword">var</span> jwtConfig = startup.config.getJsonObject(<span class="hljs-string">&quot;jwt&quot;</span>);
    <span class="hljs-keyword">var</span> issuer = jwtConfig.getString(<span class="hljs-string">&quot;issuer&quot;</span>);
    <span class="hljs-keyword">var</span> issuerUri = URI.create(issuer);

    <span class="hljs-comment">// derive JWKS uri from Keycloak issuer URI</span>
    <span class="hljs-keyword">var</span> jwksUri = URI.create(jwtConfig.getString(<span class="hljs-string">&quot;jwksUri&quot;</span>, String.format(<span class="hljs-string">&quot;%s://%s:%d%s&quot;</span>,
            issuerUri.getScheme(), issuerUri.getHost(), issuerUri.getPort(), issuerUri.getPath() + <span class="hljs-string">&quot;/protocol/openid-connect/certs&quot;</span>)));

    <span class="hljs-keyword">var</span> promise = Promise.&lt;JWTAuth&gt;promise();

    <span class="hljs-comment">// fetch JWKS from `/certs` endpoint</span>
    webClient.get(jwksUri.getPort(), jwksUri.getHost(), jwksUri.getPath())
            .as(BodyCodec.jsonObject())
            .send(ar -&gt; {

                <span class="hljs-keyword">if</span> (!ar.succeeded()) {
                    startup.bootstrap.fail(String.format(<span class="hljs-string">&quot;Could not fetch JWKS from URI: %s&quot;</span>, jwksUri));
                    <span class="hljs-keyword">return</span>;
                }

                <span class="hljs-keyword">var</span> response = ar.result();

                <span class="hljs-keyword">var</span> jwksResponse = response.body();
                <span class="hljs-keyword">var</span> keys = jwksResponse.getJsonArray(<span class="hljs-string">&quot;keys&quot;</span>);

                <span class="hljs-comment">// Configure JWT validation options</span>
                <span class="hljs-keyword">var</span> jwtOptions = <span class="hljs-keyword">new</span> JWTOptions();
                jwtOptions.setIssuer(issuer);

                <span class="hljs-comment">// extract JWKS from keys array</span>
                <span class="hljs-keyword">var</span> jwks = ((List&lt;Object&gt;) keys.getList()).stream()
                        .map(o -&gt; <span class="hljs-keyword">new</span> JsonObject((Map&lt;String, Object&gt;) o))
                        .collect(Collectors.toList());

                <span class="hljs-comment">// configure JWTAuth</span>
                <span class="hljs-keyword">var</span> jwtAuthOptions = <span class="hljs-keyword">new</span> JWTAuthOptions();
                jwtAuthOptions.setJwks(jwks);
                jwtAuthOptions.setJWTOptions(jwtOptions);
                jwtAuthOptions.setPermissionsClaimKey(jwtConfig.getString(<span class="hljs-string">&quot;permissionClaimsKey&quot;</span>, <span class="hljs-string">&quot;realm_access/roles&quot;</span>));

                JWTAuth jwtAuth = JWTAuth.create(vertx, jwtAuthOptions);
                promise.complete(jwtAuth);
            });

    <span class="hljs-keyword">return</span> promise.future().compose(auth -&gt; {
        jwtAuth = auth;
        <span class="hljs-keyword">return</span> Future.succeededFuture(startup);
    });
}
</code></pre><h3 id="protecting-routes-with-jwtauthhandler"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#protecting-routes-with-jwtauthhandler"></a>Protecting routes with JWTAuthHandler</h3><p>Now that our <code>JWTAuth</code> is conÂ­figÂ­ured, we can use the <code>JWTAuthHandler</code> in the <code>setupRouter</code> method to apply
JWT auÂ­thoÂ­rizaÂ­tion to all routes matchÂ­ing the path patÂ­tern <code>/api/*</code>. The <code>JWTAuthHandler</code> valÂ­iÂ­dates reÂ­ceived JWTs and perÂ­forms
adÂ­diÂ­tional checks like exÂ­piÂ­raÂ­tion and alÂ­lowed isÂ­suers. With that in place, we conÂ­figÂ­ure our acÂ­tual routes in <code>setupRoutes</code>.</p><pre><code class="hljs language-java"><span class="hljs-function"><span class="hljs-keyword">private</span> Future&lt;Startup&gt; <span class="hljs-title">setupRouter</span><span class="hljs-params">(Startup startup)</span> </span>{

    router = Router.router(vertx);

    router.route(<span class="hljs-string">&quot;/api/*&quot;</span>).handler(JWTAuthHandler.create(jwtAuth));

    <span class="hljs-keyword">return</span> Future.succeededFuture(startup);
}

<span class="hljs-function"><span class="hljs-keyword">private</span> Future&lt;Startup&gt; <span class="hljs-title">setupRoutes</span><span class="hljs-params">(Startup startup)</span> </span>{

    router.get(<span class="hljs-string">&quot;/api/greet&quot;</span>).handler(<span class="hljs-keyword">this</span>::handleGreet);
    router.get(<span class="hljs-string">&quot;/api/user&quot;</span>).handler(<span class="hljs-keyword">this</span>::handleUserData);
    router.get(<span class="hljs-string">&quot;/api/admin&quot;</span>).handler(<span class="hljs-keyword">this</span>::handleAdminData);

    <span class="hljs-keyword">return</span> Future.succeededFuture(startup);
}
</code></pre><h3 id="extracting-user-information-from-jwtuser"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#extracting-user-information-from-jwtuser"></a>Extracting user information from JWTUser</h3><p>To acÂ­cess user inÂ­forÂ­maÂ­tion in our <code>handleGreet</code> method, we cast the reÂ­sult of the <code>io.vertx.ext.web.RoutingContext#user</code> method to <code>JWTUser</code>
which alÂ­lows us to acÂ­cess token claim inÂ­forÂ­maÂ­tion via the <code>io.vertx.ext.auth.jwt.impl.JWTUser#principal</code> JSON obÂ­ject.</p><p>If weâ€™d like to use the JWT acÂ­cess token for other serÂ­vice calls, we could exÂ­tract the token from the <code>Authorization</code> header.</p><pre><code class="hljs language-java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleGreet</span><span class="hljs-params">(RoutingContext ctx)</span> </span>{

    <span class="hljs-keyword">var</span> jwtUser = (JWTUser) ctx.user();
    <span class="hljs-keyword">var</span> username = jwtUser.principal().getString(<span class="hljs-string">&quot;preferred_username&quot;</span>);
    <span class="hljs-keyword">var</span> userId = jwtUser.principal().getString(<span class="hljs-string">&quot;sub&quot;</span>);

    <span class="hljs-keyword">var</span> accessToken = ctx.request().getHeader(HttpHeaders.AUTHORIZATION).substring(<span class="hljs-string">&quot;Bearer &quot;</span>.length());
    <span class="hljs-comment">// Use accessToken for down-stream calls if needed...</span>

    ctx.request().response().end(String.format(<span class="hljs-string">&quot;Hi %s (%s) %s%n&quot;</span>, username, userId, Instant.now()));
}
</code></pre><h3 id="obtaining-an-access-token-from-keycloak-for-user-tester"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#obtaining-an-access-token-from-keycloak-for-user-tester"></a>Obtaining an Access Token from Keycloak for user <code>tester</code></h3><p>To test our apÂ­pliÂ­caÂ­tion we can use the folÂ­lowÂ­ing <code>curl</code> comÂ­mands in a bash like shell to obÂ­tain an JWT acÂ­cess token to call one
of our endÂ­points as the user <code>tester</code> with the role <code>user</code>.</p><p>Note that this exÂ­amÂ­ple uses the cli tool <a href="https://stedolan.github.io/jq/">jq</a> for JSON proÂ­cessÂ­ing.</p><pre><code class="hljs language-bash">KC_USERNAME=tester
KC_PASSWORD=<span class="hljs-built_in">test</span>
KC_CLIENT=vertx-service
KC_CLIENT_SECRET=ecb85cc5-f90d-4a03-8fac-24dcde57f40c
KC_REALM=vertx
KC_URL=http://localhost:8080/auth
KC_RESPONSE=$(curl  -k \
        -d <span class="hljs-string">&quot;username=<span class="hljs-variable">$KC_USERNAME</span>&quot;</span> \
        -d <span class="hljs-string">&quot;password=<span class="hljs-variable">$KC_PASSWORD</span>&quot;</span> \
        -d <span class="hljs-string">&#x27;grant_type=password&#x27;</span> \
        -d <span class="hljs-string">&quot;client_id=<span class="hljs-variable">$KC_CLIENT</span>&quot;</span> \
        -d <span class="hljs-string">&quot;client_secret=<span class="hljs-variable">$KC_CLIENT_SECRET</span>&quot;</span> \
        <span class="hljs-string">&quot;<span class="hljs-variable">$KC_URL</span>/realms/<span class="hljs-variable">$KC_REALM</span>/protocol/openid-connect/token&quot;</span> \
    | jq .)

KC_ACCESS_TOKEN=$(<span class="hljs-built_in">echo</span> <span class="hljs-variable">$KC_RESPONSE</span>| jq -r .access_token)
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$KC_ACCESS_TOKEN</span>
</code></pre><p>Here we use the JWT acÂ­cess token in the <code>Authorization</code> header with the <code>Bearer</code> preÂ­fix to call our <code>greet</code> route:</p><pre><code class="hljs language-bash">curl --silent -H <span class="hljs-string">&quot;Authorization: Bearer <span class="hljs-variable">$KC_ACCESS_TOKEN</span>&quot;</span> http://localhost:3000/api/greet
</code></pre><p>ExÂ­amÂ­ple outÂ­put:</p><pre><code class="hljs language-bash">Hi tester (27b3fac0-9aec-4421-81cf-d4b02428f901) 2020-09-28T21:03:59.254230700Z
</code></pre><h3 id="applying-role-based-access-control-with-jwtuser"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#applying-role-based-access-control-with-jwtuser"></a>Applying Role-based Access-Control with JWTUser</h3><p>To leverÂ­age supÂ­port for role based acÂ­cess conÂ­trol (RBAC) we can use the <code>io.vertx.ext.auth.User#isAuthorised</code> method
to check whether the curÂ­rent user has the reÂ­quired role. If the role is present we reÂ­turn some data about the user, othÂ­erÂ­wise
we send a reÂ­sponse with staÂ­tus code 403 and a <code>forbidden</code> error mesÂ­sage.</p><pre><code class="hljs language-java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleUserData</span><span class="hljs-params">(RoutingContext ctx)</span> </span>{

    <span class="hljs-keyword">var</span> jwtUser = (JWTUser) ctx.user();
    <span class="hljs-keyword">var</span> username = jwtUser.principal().getString(<span class="hljs-string">&quot;preferred_username&quot;</span>);
    <span class="hljs-keyword">var</span> userId = jwtUser.principal().getString(<span class="hljs-string">&quot;sub&quot;</span>);

    jwtUser.isAuthorized(<span class="hljs-string">&quot;user&quot;</span>, res -&gt; {

        <span class="hljs-keyword">if</span> (!res.succeeded() || !res.result()) {
            toJsonResponse(ctx).setStatusCode(<span class="hljs-number">403</span>).end(<span class="hljs-string">&quot;{\&quot;error\&quot;: \&quot;forbidden\&quot;}&quot;</span>);
            <span class="hljs-keyword">return</span>;
        }

        JsonObject data = <span class="hljs-keyword">new</span> JsonObject()
                .put(<span class="hljs-string">&quot;type&quot;</span>, <span class="hljs-string">&quot;user&quot;</span>)
                .put(<span class="hljs-string">&quot;username&quot;</span>, username)
                .put(<span class="hljs-string">&quot;userId&quot;</span>, userId)
                .put(<span class="hljs-string">&quot;timestamp&quot;</span>, Instant.now());

        toJsonResponse(ctx).end(data.toString());
    });
}

<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleAdminData</span><span class="hljs-params">(RoutingContext ctx)</span> </span>{

    <span class="hljs-keyword">var</span> jwtUser = (JWTUser) ctx.user();
    <span class="hljs-keyword">var</span> username = jwtUser.principal().getString(<span class="hljs-string">&quot;preferred_username&quot;</span>);
    <span class="hljs-keyword">var</span> userId = jwtUser.principal().getString(<span class="hljs-string">&quot;sub&quot;</span>);

    jwtUser.isAuthorized(<span class="hljs-string">&quot;admin&quot;</span>, res -&gt; {

        <span class="hljs-keyword">if</span> (!res.succeeded() || !res.result()) {
            toJsonResponse(ctx).setStatusCode(<span class="hljs-number">403</span>).end(<span class="hljs-string">&quot;{\&quot;error\&quot;: \&quot;forbidden\&quot;}&quot;</span>);
            <span class="hljs-keyword">return</span>;
        }

        JsonObject data = <span class="hljs-keyword">new</span> JsonObject()
                .put(<span class="hljs-string">&quot;type&quot;</span>, <span class="hljs-string">&quot;admin&quot;</span>)
                .put(<span class="hljs-string">&quot;username&quot;</span>, username)
                .put(<span class="hljs-string">&quot;userId&quot;</span>, userId)
                .put(<span class="hljs-string">&quot;timestamp&quot;</span>, Instant.now());

        toJsonResponse(ctx).end(data.toString());
    });
}
</code></pre><pre><code class="hljs language-bash">curl --silent -H <span class="hljs-string">&quot;Authorization: Bearer <span class="hljs-variable">$KC_ACCESS_TOKEN</span>&quot;</span> http://localhost:3000/api/user
</code></pre><p>OutÂ­put:</p><pre><code class="hljs language-json">{<span class="hljs-attr">&quot;type&quot;</span>:<span class="hljs-string">&quot;user&quot;</span>,<span class="hljs-attr">&quot;username&quot;</span>:<span class="hljs-string">&quot;tester&quot;</span>,<span class="hljs-attr">&quot;userId&quot;</span>:<span class="hljs-string">&quot;27b3fac0-9aec-4421-81cf-d4b02428f901&quot;</span>,<span class="hljs-attr">&quot;timestamp&quot;</span>:<span class="hljs-string">&quot;2020-09-28T21:07:49.340950300Z&quot;</span>}
</code></pre><pre><code class="hljs language-bash">curl --silent -H <span class="hljs-string">&quot;Authorization: Bearer <span class="hljs-variable">$KC_ACCESS_TOKEN</span>&quot;</span> http://localhost:3000/api/admin
</code></pre><p>OutÂ­put:</p><pre><code class="hljs language-json">{<span class="hljs-attr">&quot;error&quot;</span>: <span class="hljs-string">&quot;forbidden&quot;</span>}
</code></pre><h3 id="obtaining-an-access-token-from-keycloak-for-user-vadmin"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#obtaining-an-access-token-from-keycloak-for-user-vadmin"></a>Obtaining an Access Token from Keycloak for user <code>vadmin</code></h3><p>To check acÂ­cess with an <code>admin</code> role, we obÂ­tain a new token for the user <code>vadmin</code> which has the roles <code>admin</code> and <code>user</code>. </p><pre><code class="hljs language-bash">KC_USERNAME=vadmin
KC_PASSWORD=<span class="hljs-built_in">test</span>
KC_CLIENT=vertx-service
KC_CLIENT_SECRET=ecb85cc5-f90d-4a03-8fac-24dcde57f40c
KC_REALM=vertx
KC_URL=http://localhost:8080/auth
KC_RESPONSE=$(curl  -k \
        -d <span class="hljs-string">&quot;username=<span class="hljs-variable">$KC_USERNAME</span>&quot;</span> \
        -d <span class="hljs-string">&quot;password=<span class="hljs-variable">$KC_PASSWORD</span>&quot;</span> \
        -d <span class="hljs-string">&#x27;grant_type=password&#x27;</span> \
        -d <span class="hljs-string">&quot;client_id=<span class="hljs-variable">$KC_CLIENT</span>&quot;</span> \
        -d <span class="hljs-string">&quot;client_secret=<span class="hljs-variable">$KC_CLIENT_SECRET</span>&quot;</span> \
        <span class="hljs-string">&quot;<span class="hljs-variable">$KC_URL</span>/realms/<span class="hljs-variable">$KC_REALM</span>/protocol/openid-connect/token&quot;</span> \
    | jq .)

KC_ACCESS_TOKEN=$(<span class="hljs-built_in">echo</span> <span class="hljs-variable">$KC_RESPONSE</span>| jq -r .access_token)
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$KC_ACCESS_TOKEN</span>
</code></pre><pre><code class="hljs language-bash">curl --silent -H <span class="hljs-string">&quot;Authorization: Bearer <span class="hljs-variable">$KC_ACCESS_TOKEN</span>&quot;</span> http://localhost:3000/api/user
</code></pre><p>OutÂ­put:</p><pre><code class="hljs language-json">{<span class="hljs-attr">&quot;type&quot;</span>:<span class="hljs-string">&quot;user&quot;</span>,<span class="hljs-attr">&quot;username&quot;</span>:<span class="hljs-string">&quot;vadmin&quot;</span>,<span class="hljs-attr">&quot;userId&quot;</span>:<span class="hljs-string">&quot;75090eac-36ff-4cd8-847d-fc2941bc024e&quot;</span>,<span class="hljs-attr">&quot;timestamp&quot;</span>:<span class="hljs-string">&quot;2020-09-28T21:13:05.099393900Z&quot;</span>}
</code></pre><pre><code class="hljs language-bash">curl --silent -H <span class="hljs-string">&quot;Authorization: Bearer <span class="hljs-variable">$KC_ACCESS_TOKEN</span>&quot;</span> http://localhost:3000/api/admin
</code></pre><p>OutÂ­put:</p><pre><code class="hljs language-json">{<span class="hljs-attr">&quot;type&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-attr">&quot;username&quot;</span>:<span class="hljs-string">&quot;vadmin&quot;</span>,<span class="hljs-attr">&quot;userId&quot;</span>:<span class="hljs-string">&quot;75090eac-36ff-4cd8-847d-fc2941bc024e&quot;</span>,<span class="hljs-attr">&quot;timestamp&quot;</span>:<span class="hljs-string">&quot;2020-09-28T21:13:34.945276500Z&quot;</span>}
</code></pre><h3 id="conclusion"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#conclusion"></a>Conclusion</h3><p>We learned how to conÂ­figÂ­ure a Vert.x apÂ­pliÂ­caÂ­tion with JWT auÂ­thoÂ­rizaÂ­tion powÂ­ered by KeyÂ­cloak. AlÂ­though the conÂ­figÂ­uÂ­raÂ­tion is quite comÂ­plete
alÂ­ready, there are still some parts that can be imÂ­proved, like the dyÂ­namic JWKS fetchÂ­ing on public-â€‹key pair roÂ­taÂ­tion as well as exÂ­tracÂ­tion of nested roles.</p><p>NevÂ­erÂ­theÂ­less this is a good startÂ­ing point for seÂ­curÂ­ing your own Vert.x serÂ­vices with JWT and KeyÂ­cloak.</p><p>You can check out the <a href="https://github.com/thomasdarimont/vertx-playground/tree/master/jwt-service-vertx">comÂ­plete exÂ­amÂ­ple in keycloak-â€‹vertx ExÂ­amÂ­ples Repo</a>.</p><p>Thank you for your time, stay tuned for more upÂ­dates! If you want to learn more about KeyÂ­cloak, feel free to reach out to me. You can find me via <a href="https://twitter.com/thomasdarimont">thomasÂ­daÂ­riÂ­mont on twitÂ­ter</a>.</p><p>Happy HackÂ­ing!</p></div><div class="blog-post-sidebar"><div class="blog-post-author"><img class="blog-post-author-avatar" src="https://github.com/thomasdarimont.png?size=160" alt="Thomas Darimont&#x27;s profile image"/><div class="blog-post-author-name">by <a href="https://github.com/thomasdarimont" target="_blank" rel="noopener noreferrer">Thomas Darimont</a></div></div><div class="blog-post-sidebar-date">Posted on <!-- -->1 October 2020</div>in <a class="blog-post-sidebar-category" href="/blog/category/guides/">guides</a><div class="blog-post-sidebar-reading-time"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <!-- -->11 min read</div><div class="blog-post-sidebar-share-icons"><a href="https://twitter.com/intent/tweet?text=JWT%20Authorization%20for%20Vert.x%20with%20Keycloak&amp;url=https%3A%2F%2Fvertx.io%2Fblog%2Fjwt-authorization-for-vert-x-with-keycloak&amp;via=vertx_project" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><title>twitter</title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fvertx.io%2Fblog%2Fjwt-authorization-for-vert-x-with-keycloak" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><title>linkedin</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a><a href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fvertx.io%2Fblog%2Fjwt-authorization-for-vert-x-with-keycloak" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><title>facebook</title><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path></svg></a></div></div></div><div class="blog-post-next-prev"><div class="blog-post-next-prev-entry"><h5>Next post</h5><div class="jsx-cc12eb2116299e94 blog-entry"><div class="jsx-cc12eb2116299e94 blog-entry-meta"><div class="jsx-cc12eb2116299e94 blog-entry-meta-left"><span class="jsx-cc12eb2116299e94 blog-entry-date">15 October 2020</span>â€‹<a class="jsx-cc12eb2116299e94 blog-entry-category" href="/blog/category/releases/">releases</a></div><div class="jsx-cc12eb2116299e94 blog-entry-meta-right"></div></div><h3 class="jsx-cc12eb2116299e94"><a class="jsx-cc12eb2116299e94" href="/blog/eclipse-vert-x-3-9-4-released/">Eclipse Vert.x 3.9.4 released!</a></h3><span class="jsx-cc12eb2116299e94 blog-entry-authors"><ul class="jsx-cc12eb2116299e94"><li class=""><img src="https://github.com/vietj.png?size=50" alt="Julien Viet&#x27;s profile image"/><a href="https://github.com/vietj" target="_blank" rel="noopener noreferrer">Julien Viet</a></li></ul></span><p class="jsx-cc12eb2116299e94 blog-entry-summary">Eclipse Vert.x version 3.9.4 has just been released. It fixes quite a few bugs that have been reported by the community.</p><span class="jsx-73ea682053e23281 read-more-link"><a href="/blog/eclipse-vert-x-3-9-4-released/">Read more</a></span></div></div><div class="blog-post-next-prev-entry"><h5>Previous post</h5><div class="jsx-cc12eb2116299e94 blog-entry"><div class="jsx-cc12eb2116299e94 blog-entry-meta"><div class="jsx-cc12eb2116299e94 blog-entry-meta-left"><span class="jsx-cc12eb2116299e94 blog-entry-date">25 September 2020</span>â€‹<a class="jsx-cc12eb2116299e94 blog-entry-category" href="/blog/category/releases/">releases</a></div><div class="jsx-cc12eb2116299e94 blog-entry-meta-right"></div></div><h3 class="jsx-cc12eb2116299e94"><a class="jsx-cc12eb2116299e94" href="/blog/eclipse-vert-x-4-beta-3-released/">Eclipse Vert.x 4 beta 3 released!</a></h3><span class="jsx-cc12eb2116299e94 blog-entry-authors"><ul class="jsx-cc12eb2116299e94"><li class=""><img src="https://github.com/vietj.png?size=50" alt="Julien Viet&#x27;s profile image"/><a href="https://github.com/vietj" target="_blank" rel="noopener noreferrer">Julien Viet</a></li></ul></span><p class="jsx-cc12eb2116299e94 blog-entry-summary">The third beta version of Eclipse Vert.x 4.0 highlights many features including (but not limited to) HTTP client request creation, HTTP tunnel improvements, and WebSocket upgrade improvements.</p><span class="jsx-73ea682053e23281 read-more-link"><a href="/blog/eclipse-vert-x-4-beta-3-released/">Read more</a></span></div></div></div><div class="blog-post-related"><h5>Related posts</h5><div class="blog-post-related-posts"><div class="jsx-cc12eb2116299e94 blog-entry"><div class="jsx-cc12eb2116299e94 blog-entry-meta"><div class="jsx-cc12eb2116299e94 blog-entry-meta-left"><span class="jsx-cc12eb2116299e94 blog-entry-date">16 March 2020</span>â€‹<a class="jsx-cc12eb2116299e94 blog-entry-category" href="/blog/category/guides/">guides</a></div><div class="jsx-cc12eb2116299e94 blog-entry-meta-right"></div></div><h3 class="jsx-cc12eb2116299e94"><a class="jsx-cc12eb2116299e94" href="/blog/easy-sso-for-vert-x-with-keycloak/">Easy SSO for Vert.x with Keycloak</a></h3><span class="jsx-cc12eb2116299e94 blog-entry-authors"><ul class="jsx-cc12eb2116299e94"><li class=""><img src="https://github.com/thomasdarimont.png?size=50" alt="Thomas Darimont&#x27;s profile image"/><a href="https://github.com/thomasdarimont" target="_blank" rel="noopener noreferrer">Thomas Darimont</a></li></ul></span><p class="jsx-cc12eb2116299e94 blog-entry-summary">In this blog post, you&#x27;ll learn how to implement Single Sign-on with OpenID Connect and how to use Keycloak together with Eclipse Vert.x.</p><span class="jsx-73ea682053e23281 read-more-link"><a href="/blog/easy-sso-for-vert-x-with-keycloak/">Read more</a></span></div><div class="jsx-cc12eb2116299e94 blog-entry"><div class="jsx-cc12eb2116299e94 blog-entry-meta"><div class="jsx-cc12eb2116299e94 blog-entry-meta-left"><span class="jsx-cc12eb2116299e94 blog-entry-date">23 January 2021</span>â€‹<a class="jsx-cc12eb2116299e94 blog-entry-category" href="/blog/category/guides/">guides</a></div><div class="jsx-cc12eb2116299e94 blog-entry-meta-right"></div></div><h3 class="jsx-cc12eb2116299e94"><a class="jsx-cc12eb2116299e94" href="/blog/eclipse-vert-x-CSRF-concerns/">Things to keep in mind concerning CSRF attacks</a></h3><span class="jsx-cc12eb2116299e94 blog-entry-authors"><ul class="jsx-cc12eb2116299e94"><li class=""><img src="https://github.com/xhlika.png?size=50" alt="Xhelal Likaj&#x27;s profile image"/><a href="https://github.com/xhlika" target="_blank" rel="noopener noreferrer">Xhelal Likaj</a></li></ul></span><p class="jsx-cc12eb2116299e94 blog-entry-summary">Eclipse Vert.x like most frameworks provides an anti-CSRF defense. However, no framework can prevent all attack vectors that exist in the web. Therefore, developers need to be aware of some dangers and common attack vectors concerning CSRF defenses.</p><span class="jsx-73ea682053e23281 read-more-link"><a href="/blog/eclipse-vert-x-CSRF-concerns/">Read more</a></span></div><div class="jsx-cc12eb2116299e94 blog-entry"><div class="jsx-cc12eb2116299e94 blog-entry-meta"><div class="jsx-cc12eb2116299e94 blog-entry-meta-left"><span class="jsx-cc12eb2116299e94 blog-entry-date">3 August 2015</span>â€‹<a class="jsx-cc12eb2116299e94 blog-entry-category" href="/blog/category/guides/">guides</a></div><div class="jsx-cc12eb2116299e94 blog-entry-meta-right"></div></div><h3 class="jsx-cc12eb2116299e94"><a class="jsx-cc12eb2116299e94" href="/blog/unit-and-integration-tests/">Unit and Integration Tests</a></h3><span class="jsx-cc12eb2116299e94 blog-entry-authors"><ul class="jsx-cc12eb2116299e94"><li class=""><img src="https://github.com/cescoffier.png?size=50" alt="Clement Escoffier&#x27;s profile image"/><a href="https://github.com/cescoffier" target="_blank" rel="noopener noreferrer">Clement Escoffier</a></li></ul></span><p class="jsx-cc12eb2116299e94 blog-entry-summary">Letâ€™s refresh our mind about what we developed so far in the introduction to vert.x series. We forgot an important task. We didnâ€™t test the API.</p><span class="jsx-73ea682053e23281 read-more-link"><a href="/blog/unit-and-integration-tests/">Read more</a></span></div></div></div></div></div></div><footer class="jsx-aeedcf66895f49d7"><div class="jsx-aeedcf66895f49d7 container"><div class="jsx-aeedcf66895f49d7 footer-nav-section"><div class="jsx-aeedcf66895f49d7 footer-nav-list footer-logo"><a class="jsx-aeedcf66895f49d7" href="/"><img src="data:image/svg+xml,%3csvg version=&#x27;1.1&#x27; id=&#x27;Layer_1&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; viewBox=&#x27;0 0 1232.6 315.2&#x27; style=&#x27;enable-background:new 0 0 1232.6 315.2&#x27; xml:space=&#x27;preserve&#x27;%3e%3cstyle%3e.st0%7bfill:%23782a91%7d%3c/style%3e%3cpath d=&#x27;M120.9 214.2 190.5 0h52.3l-98.5 273.8H98.2L0 0h52.1l68.8 214.2zm291.2-62.6H299.6v84.2H431v38H252V0h177.7v38.4H299.6V114h112.5v37.6zm83.7-113.2H546c16.5.3 29 4.4 37.3 12.4 8.3 8 12.5 19.4 12.5 34 0 14-4.5 25.1-13.5 33.2-9 8.1-21.6 12.1-37.6 12.1h-27.1v24.2l86.1 119.5h51v-2.4l-77.2-106.7c24.9-5.5 43.3-21.7 52.6-35.9 8.2-12.6 13.3-27.7 13.3-46 0-26.8-8.6-47.4-25.8-61.5C600.5 7.1 576.1 0 544.5 0h-96.3v273.8h47.6&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;m1052.3 157.7-41.5 62.7 29.7 53.4h85.1z&#x27;/%3e%3ccircle class=&#x27;st0&#x27; cx=&#x27;827.9&#x27; cy=&#x27;274.7&#x27; r=&#x27;40.5&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;m1037 0-47.6 74.2L949 0h-84l85.3 135.8-67.1 105.7c5.7 9.5 9.1 20.5 9.2 32.4h50.1L1121.3 0H1037z&#x27;/%3e%3cpath d=&#x27;M763.5 273.8c.1-9.9 2.5-19.2 6.6-27.5V38.4h85.4V0H638.2v38.4h84.6v235.4h40.7zm414-266.9h-15.3v42.2h-8.5V6.9h-15.2V0h39v6.9zM1193 0l14.2 37.7L1221.3 0h11v49.1h-8.5V32.9l.8-21.7-14.5 37.9h-6.1l-14.5-37.8.8 21.6v16.2h-8.5V0h11.2z&#x27;/%3e%3c/svg%3e" alt="Vert.x Logo" class="jsx-aeedcf66895f49d7"/></a></div><div class="jsx-aeedcf66895f49d7 footer-nav-list"><h5 class="jsx-aeedcf66895f49d7">Eclipse Vert.x</h5><ul class="jsx-aeedcf66895f49d7 "><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7 navbar-menu-item" href="/docs/">Docs</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/download/">Download</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/blog/">Blog</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/community/">Community</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://github.com/eclipse-vertx/vert.x" class="jsx-aeedcf66895f49d7">GitHub</a></li></ul></div><div class="jsx-aeedcf66895f49d7 footer-nav-list"><h5 class="jsx-aeedcf66895f49d7">Resources</h5><ul class="jsx-aeedcf66895f49d7 "><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/faq/">FAQ</a></li><li class="jsx-aeedcf66895f49d7"><a class="jsx-aeedcf66895f49d7" href="/channels/">Channels</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://how-to.vertx.io/" class="jsx-aeedcf66895f49d7">How-Toâ€™s</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://start.vertx.io/" class="jsx-aeedcf66895f49d7">App Generator</a></li><li class="jsx-aeedcf66895f49d7"><a href="/.well-known/security.txt" class="jsx-aeedcf66895f49d7">security.txt</a></li></ul></div><div class="jsx-aeedcf66895f49d7 footer-nav-list"><h5 class="jsx-aeedcf66895f49d7">Eclipse</h5><ul class="jsx-aeedcf66895f49d7 "><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/" class="jsx-aeedcf66895f49d7">Eclipse Foundation</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/legal/privacy.php" class="jsx-aeedcf66895f49d7">Privacy Policy</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/legal/termsofuse.php" class="jsx-aeedcf66895f49d7">Terms of Use</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/legal/copyright.php" class="jsx-aeedcf66895f49d7">Copyright Agent</a></li><li class="jsx-aeedcf66895f49d7"><a href="https://www.eclipse.org/legal/" class="jsx-aeedcf66895f49d7">Legal Resources</a></li></ul></div></div><div class="jsx-aeedcf66895f49d7 footer-copyright"><div class="jsx-aeedcf66895f49d7 footer-copyright-remarks">Â© <!-- -->2022<!-- --> Eclipse Vert.xâ„¢<br class="jsx-aeedcf66895f49d7"/>Eclipse Vert.xâ„¢ is open source and dual-licensed under the <a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank" rel="noopener noreferrer" class="jsx-aeedcf66895f49d7">Eclipse Public License 2.0</a> and the <a href="https://www.apache.org/licenses/LICENSE-2.0.html" target="_blank" rel="noopener noreferrer" class="jsx-aeedcf66895f49d7">Apache License 2.0</a>. <br class="jsx-aeedcf66895f49d7 footer-copyright-break"/>Website design by <a href="https://michelkraemer.com" target="_blank" rel="noopener noreferrer" class="jsx-aeedcf66895f49d7">Michel KrÃ¤mer</a>.</div><div class="jsx-aeedcf66895f49d7 footer-copyright-eclipse-logo"><a href="https://www.eclipse.org/" target="_blank" rel="noopener noreferrer" class="jsx-aeedcf66895f49d7"><img src="data:image/svg+xml,%3csvg version=&#x27;1.1&#x27; id=&#x27;Layer_1&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; viewBox=&#x27;0 0 281.3 91.1&#x27; style=&#x27;enable-background:new 0 0 281.3 91.1&#x27; xml:space=&#x27;preserve&#x27;%3e%3cstyle%3e.st0%7bfill:%23f79422%7d.st1%7bfill:%233d3c3b%7d%3c/style%3e%3cg id=&#x27;Layer_1_1_&#x27;%3e%3cpath class=&#x27;st0&#x27; d=&#x27;M265.7 84 257 73h-2.7v17.7h3.3v-12l9.3 12h2.1V73h-3.3v11zm-32.4-8.3c4.2 0 5.8 3.3 5.8 6.3s-1.6 6-5.8 6-5.7-3.1-5.8-6 1.7-6.3 5.8-6.3zm0-3c-6.1 0-9.1 4.7-9.1 9.3 0 4.7 2.9 9.1 9.1 9.1s9-4.6 9.1-9.2-3-9.2-9.1-9.2zm-21.2 18V73h-3.3v17.7h3.3zm-23.6 0h3.3V76h5.6v-3h-14.6v3h5.6l.1 14.7zm-18.9-6.5H163l3.3-7.6 3.3 7.6zm2.8 6.5h3.6L168.2 73h-3.6l-8 17.7h3.6l1.5-3.3h9.3l1.4 3.3zm-38-14.6h3.6c3.9 0 5.5 2.8 5.5 5.5.1 2.8-1.5 5.8-5.5 5.8h-3.6V76.1zm3.7-3.1h-6.9v17.7h6.9c6.2 0 8.9-4.5 8.9-9s-2.8-8.7-8.9-8.7zm-22.4 11L107 73h-2.7v17.7h3.3v-12l9.3 12h2.1V73h-3.3v11zM88.2 73v10.2c0 3-1.6 4.9-4.3 4.9s-4.6-1.7-4.6-4.9V73H76v10.1c0 5.3 3.6 7.9 7.9 7.9 4.4 0 7.7-2.7 7.7-7.9V73h-3.4zm-33 2.7c4.2 0 5.8 3.3 5.8 6.3s-1.6 6-5.8 6-5.7-3.1-5.8-6 1.7-6.3 5.8-6.3zm0-3c-6.1 0-9.1 4.7-9.1 9.3s2.9 9.1 9.1 9.1 9-4.6 9.1-9.2-3-9.2-9.1-9.2zm-29.7 18v-6.5h8.9v-3.1h-8.9v-4.8h9.4V73H22.2v17.6h3.3z&#x27;/%3e%3cpath class=&#x27;st1&#x27; d=&#x27;M269.4 54.4h-22.2v-8.9h21.4v-6.9h-21.4v-9.1h22.2v-7.2h-29.6v39.5h29.6v-7.4zm-40-25.6c-3-6.1-9.4-7.8-15.5-7.8-7.3 0-15.3 3.4-15.3 11.5 0 8.9 7.4 11 15.5 12 5.2.6 9.1 2.1 9.1 5.8 0 4.3-4.4 5.9-9.1 5.9s-9.4-1.9-11.1-6.3l-6.2 3.2c2.9 7.2 9.1 9.7 17.2 9.7 8.8 0 16.6-3.8 16.6-12.6 0-9.4-7.7-11.6-15.9-12.6-4.7-.6-8.8-1.5-8.8-5 0-2.9 2.6-5.2 8.2-5.2 4.3 0 8 2.2 9.4 4.4l5.9-3zM176 22.2c-6.2-.1-12.4 0-18.6 0v39.5h7.4V50.1H176c19.4 0 19.4-27.9 0-27.9zm-11.1 7.1H176c9.5 0 9.5 14 0 14h-11.2l.1-14zm-18 32.5V22.2h-7.4v39.5l7.4.1zm-44-39.6v39.5h27.7v-6.9h-20.3V22.2h-7.4zM90.7 51.7c-2.7 2.5-6.2 4-9.9 4-9.8 0-13.5-6.8-13.6-13.4s4.1-13.7 13.6-13.7c3.5-.1 7 1.3 9.5 3.7l5-4.8c-3.8-3.9-9.1-6-14.5-6-14.3 0-21 10.5-20.9 20.8s6.3 20.3 20.9 20.3c5.6.1 11-2 15-5.9l-5.1-5zm-39 2.7H29.5v-8.9h21.4v-6.9H29.5v-9.1h22.2v-7.2H22.2v39.5h29.6l-.1-7.4z&#x27;/%3e%3cpath class=&#x27;st0&#x27; d=&#x27;M9.8 18.2C18.8 4.1 36.9-.8 52.1 6l-1-.7C35.7-4.6 15.2-.1 5.3 15.3s-5.4 35.9 10 45.8l1.1.6C3.8 50.8.8 32.3 9.8 18.2z&#x27;/%3e%3cpath class=&#x27;st1&#x27; d=&#x27;M272.2 26.1c0-2.5 2.1-4.6 4.6-4.6 2.5 0 4.6 2.1 4.6 4.6 0 2.5-2.1 4.6-4.6 4.6-2.6 0-4.6-2.1-4.6-4.6zm8.6 0c0-2.2-1.8-4.1-4-4.1s-4.1 1.8-4.1 4.1c0 2.2 1.7 4 3.9 4.1h.1c2.3 0 4.1-1.8 4.1-4.1zm-6-2.5h2.3c1.1 0 1.9.5 1.9 1.6 0 .7-.4 1.3-1.1 1.5l1.2 1.7h-1.4l-1-1.5h-.7v1.5h-1.1l-.1-4.8zm2.2 2.3c.5 0 .8-.3.8-.7s-.3-.7-.8-.7h-1v1.3l1 .1z&#x27;/%3e%3c/g%3e%3c/svg%3e" alt="Eclipse foundation Logo" class="jsx-aeedcf66895f49d7"/></a></div></div></div></footer></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"categories":["releases","guides","security","news"],"post":{"meta":{"title":"JWT Authorization for Vert.x with Keycloak","category":"guides","authors":[{"name":"Thomas Darimont","github_id":"thomasdarimont"}],"summary":"In this blog post, you'll learn about JWT foundations, protect routes with JWT Authorization, JWT encoded tokens, and RBAC with Keycloak"},"date":"2020-10-01","slug":"jwt-authorization-for-vert-x-with-keycloak","readingTime":{"text":"11 min read","minutes":10.075,"time":604500,"words":2015},"content":{"compiledSource":"var m=Object.defineProperty,d=Object.defineProperties;var h=Object.getOwnPropertyDescriptors;var r=Object.getOwnPropertySymbols;var p=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;var i=(a,s,n)=\u003es in a?m(a,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[s]=n,e=(a,s)=\u003e{for(var n in s||(s={}))p.call(s,n)\u0026\u0026i(a,n,s[n]);if(r)for(var n of r(s))o.call(s,n)\u0026\u0026i(a,n,s[n]);return a},l=(a,s)=\u003ed(a,h(s));var c=(a,s)=\u003e{var n={};for(var t in a)p.call(a,t)\u0026\u0026s.indexOf(t)\u003c0\u0026\u0026(n[t]=a[t]);if(a!=null\u0026\u0026r)for(var t of r(a))s.indexOf(t)\u003c0\u0026\u0026o.call(a,t)\u0026\u0026(n[t]=a[t]);return n};const makeShortcode=a=\u003efunction(n){return console.warn(\"Component \"+a+\" was not imported, exported, or provided by MDXProvider as global scope\"),mdx(\"div\",e({},n))},Link=makeShortcode(\"Link\"),layoutProps={},MDXLayout=\"wrapper\";function MDXContent(n){var t=n,{components:a}=t,s=c(t,[\"components\"]);return mdx(MDXLayout,l(e(e({},layoutProps),s),{components:a,mdxType:\"MDXLayout\"}),mdx(\"p\",null,mdx(\"strong\",{parentName:\"p\"},\"TL;DR:\")),mdx(\"p\",null,\"In this blog post you\\u2019ll learn:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"JWT foun\\xADda\\xADtions\"),mdx(\"li\",{parentName:\"ul\"},\"How to pro\\xADtect routes with a JWT Au\\xADtho\\xADriza\\xADtion\"),mdx(\"li\",{parentName:\"ul\"},\"How to ex\\xADtract claims from a JWT en\\xADcoded token\"),mdx(\"li\",{parentName:\"ul\"},\"How to apply RBAC with Key\\xADcloak Realm roles\")),mdx(\"h2\",e({},{id:\"hello-again\"}),mdx(\"a\",e({parentName:\"h2\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#hello-again\"})),\"Hello again\"),mdx(\"p\",null,\"Hi there! In my last blog post \",mdx(Link,{href:\"/blog/easy-sso-for-vert-x-with-keycloak/\",passHref:!0,mdxType:\"Link\"},mdx(\"a\",e({parentName:\"p\"},{href:\"\"}),\"Easy SSO for Vert.x with Key\\xADcloak\")),\", we learned how to con\\xADfig\\xADure sin\\xADgle sign-\\u200Bon for a Vert.x web ap\\xADpli\\xADca\\xADtion with Key\\xADcloak and OpenID con\\xADnect. This time, we\\u2019ll see how we can pro\\xADtect an ap\\xADpli\\xADca\\xADtion with Vert.x\\u2019s \",mdx(Link,{href:\"/docs/vertx-web/java/#_jwt_authorisation\",passHref:!0,mdxType:\"Link\"},mdx(\"a\",e({parentName:\"p\"},{href:\"\"}),\"JWT Au\\xADtho\\xADriza\\xADtion\")),\" sup\\xADport and Key\\xADcloak.\"),mdx(\"h2\",e({},{id:\"keycloak-setup\"}),mdx(\"a\",e({parentName:\"h2\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#keycloak-setup\"})),\"Keycloak Setup\"),mdx(\"p\",null,\"To se\\xADcure our Vert.x app, we need to use a Key\\xADcloak server for ob\\xADtain\\xADing JWT to\\xADkens. Al\\xADthough \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.keycloak.org/docs/latest/getting_started/\"}),\"Key\\xADcloak has a great get\\xADting started guide\"),\" I wanted to make it a bit eas\\xADier to put every\\xADthing to\\xADgether, there\\xADfore I pre\\xADpared a local Key\\xADcloak docker con\\xADtainer \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/thomasdarimont/vertx-playground/tree/master/jwt-service-vertx#start-keycloak-with-the-vertx-realm\"}),\"as de\\xADscribed here\"),\", which comes with all the re\\xADquired con\\xADfig\\xADu\\xADra\\xADtion in place, that you can start eas\\xADily.\"),mdx(\"p\",null,\"The pre\\xADcon\\xADfig\\xADured Key\\xADcloak realm \",mdx(\"inlineCode\",{parentName:\"p\"},\"vertx\"),\" con\\xADtains a \",mdx(\"inlineCode\",{parentName:\"p\"},\"vertx-service\"),` OpenID con\\xADnect client for our Vert.x app and a set\nof users for test\\xADing. To ease test\\xADing, the `,mdx(\"inlineCode\",{parentName:\"p\"},\"vertx-service\"),\" is con\\xADfig\\xADured with \",mdx(\"inlineCode\",{parentName:\"p\"},\"Direct Access Grant\"),` en\\xADabled in Key\\xADcloak, which\nen\\xADables sup\\xADport for the OAuth2 re\\xADsource owner pass\\xADword cre\\xADden\\xADtials grant (ROPC) flow.`),mdx(\"p\",null,\"To start Key\\xADcloak with the pre\\xADcon\\xADfig\\xADured realm, just start the docker con\\xADtainer with the fol\\xADlow\\xADing com\\xADmand:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-bash\"}),`docker run \\\\\n  -it \\\\\n  --name vertx-keycloak \\\\\n  --rm \\\\\n  -e KEYCLOAK_USER=admin \\\\\n  -e KEYCLOAK_PASSWORD=admin \\\\\n  -e KEYCLOAK_IMPORT=/tmp/vertx-realm.json \\\\\n  -v `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"$PWD\"),`/vertx-realm.json:/tmp/vertx-realm.json \\\\\n  -v `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"$PWD\"),`/data:/opt/jboss/keycloak/standalone/data \\\\\n  -p 8080:8080 \\\\\n  quay.io/keycloak/keycloak:11.0.2\n`)),mdx(\"h2\",e({},{id:\"vertx-app\"}),mdx(\"a\",e({parentName:\"h2\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#vertx-app\"})),\"Vert.x App\"),mdx(\"p\",null,\"The ex\\xADam\\xADple app con\\xADsists of a sin\\xADgle \",mdx(\"inlineCode\",{parentName:\"p\"},\"Verticle\"),\", that runs on \",mdx(\"inlineCode\",{parentName:\"p\"},\"http://localhost:3000\"),\" and pro\\xADvides a few routes with pro\\xADtected re\\xADsources. \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/thomasdarimont/vertx-playground/tree/master/jwt-service-vertx/src/main/java/demo/MainVerticle.java\"}),\"You can find the com\\xADplete ex\\xADam\\xADple here\"),\".\"),mdx(\"p\",null,\"Our web app con\\xADtains the fol\\xADlow\\xADing pro\\xADtected routes with han\\xADdlers:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"/api/greet\"),\" - The greet\\xADing re\\xADsource, which re\\xADturns a greet\\xADing mes\\xADsage, only au\\xADthen\\xADti\\xADcated users can ac\\xADcess this re\\xADsource.\"),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"/api/user\"),\" - The user re\\xADsource, which re\\xADturns some in\\xADfor\\xADma\\xADtion about the user, only users with role \",mdx(\"inlineCode\",{parentName:\"li\"},\"user\"),\" can ac\\xADcess this re\\xADsource.\"),mdx(\"li\",{parentName:\"ul\"},mdx(\"inlineCode\",{parentName:\"li\"},\"/api/admin\"),\" - The user re\\xADsource, which re\\xADturns some in\\xADfor\\xADma\\xADtion about the admin, only users with role \",mdx(\"inlineCode\",{parentName:\"li\"},\"admin\"),\" can ac\\xADcess this re\\xADsource.\")),mdx(\"p\",null,\"This ex\\xADam\\xADple is built with Vert.x ver\\xADsion 3.9.3.\"),mdx(\"h3\",e({},{id:\"running-the-app-in-the-console\"}),mdx(\"a\",e({parentName:\"h3\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#running-the-app-in-the-console\"})),\"Running the app in the console\"),mdx(\"p\",null,\"To run the app, we need to build it first:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"cd\"),` jwt-service-vertx\nmvn clean package\n`)),mdx(\"p\",null,\"This cre\\xADates a jar, which we can run:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-bash\"}),`java -jar target/*.jar\n`)),mdx(\"p\",null,\"Note, that we need to start Key\\xADcloak first, since our app fetches the con\\xADfig\\xADu\\xADra\\xADtion from Key\\xADcloak on startup.\"),mdx(\"h3\",e({},{id:\"running-the-app-in-the-ide\"}),mdx(\"a\",e({parentName:\"h3\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#running-the-app-in-the-ide\"})),\"Running the app in the IDE\"),mdx(\"p\",null,`We can also run the app di\\xADrectly from your favourite IDE like In\\xADtel\\xADliJ Idea or Eclipse.\nTo run the app from an IDE, we need to cre\\xADate a launch con\\xADfig\\xADu\\xADra\\xADtion and use the main class `,mdx(\"inlineCode\",{parentName:\"p\"},\"io.vertx.core.Launcher\"),`. Then set the the pro\\xADgram ar\\xADgu\\xADments to\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"run demo.MainVerticle\"),\" and use the class\\xADpath of the \",mdx(\"inlineCode\",{parentName:\"p\"},\"jwt-service-vertx\"),` mod\\xADule.\nWith that in place we should be able to run the app.`),mdx(\"h2\",e({},{id:\"jwt-authorization\"}),mdx(\"a\",e({parentName:\"h2\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#jwt-authorization\"})),\"JWT Authorization\"),mdx(\"h3\",e({},{id:\"jwt-foundations\"}),mdx(\"a\",e({parentName:\"h3\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#jwt-foundations\"})),\"JWT Foundations\"),mdx(\"p\",null,mdx(\"a\",e({parentName:\"p\"},{href:\"https://tools.ietf.org/html/rfc7519\"}),\"JSON Web Token (JWT)\"),` is an open stan\\xADdard to se\\xADcurely ex\\xADchange in\\xADfor\\xADma\\xADtion be\\xADtween two par\\xADties in the form\nof `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://base64.guru/standards/base64url\"}),\"Base64URL\"),` en\\xADcoded JSON ob\\xADjects.\nA stan\\xADdard JWT is just a string which com\\xADprises three base64url en\\xADcoded parts header, pay\\xADload and a sig\\xADna\\xADture, which are sep\\xADa\\xADrated by a \\u201D`,mdx(\"inlineCode\",{parentName:\"p\"},\".\"),`\\u201D char\\xADac\\xADter.\nThere are other vari\\xADants of JWT that can have more parts.`),mdx(\"p\",null,\"An ex\\xADam\\xADple JWT can look like this:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-text\"}),`eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJjN00xX2hkWjAtWDNyZTl1dmZLSFRDUWRxYXJQYnBMblVJMHltdkF0U1RzIn0.eyJleHAiOjE2MDEzMTg0MjIsImlhdCI6MTYwMTMxODEyMiwianRpIjoiNzYzNWY1YTEtZjFkNy00NTdkLWI4NjktYWQ0OTIzNTJmNGQyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2F1dGgvcmVhbG1zL3ZlcnR4IiwiYXVkIjoiYWNjb3VudCIsInN1YiI6IjI3YjNmYWMwLTlhZWMtNDQyMS04MWNmLWQ0YjAyNDI4ZjkwMSIsInR5cCI6IkJlYXJlciIsImF6cCI6InZlcnR4LXNlcnZpY2UiLCJzZXNzaW9uX3N0YXRlIjoiNjg3MDgyMTMtNDBiNy00NThhLWFlZTEtMzlkNmY5ZGEwN2FkIiwiYWNyIjoiMSIsInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJvZmZsaW5lX2FjY2VzcyIsInVtYV9hdXRob3JpemF0aW9uIiwidXNlciJdfSwicmVzb3VyY2VfYWNjZXNzIjp7ImFjY291bnQiOnsicm9sZXMiOlsibWFuYWdlLWFjY291bnQiLCJtYW5hZ2UtYWNjb3VudC1saW5rcyIsInZpZXctcHJvZmlsZSJdfX0sInNjb3BlIjoiZW1haWwgcHJvZmlsZSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJuYW1lIjoiVGhlbyBUZXN0ZXIiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJ0ZXN0ZXIiLCJnaXZlbl9uYW1lIjoiVGhlbyIsImZhbWlseV9uYW1lIjoiVGVzdGVyIiwiZW1haWwiOiJ0b20rdGVzdGVyQGxvY2FsaG9zdCJ9.NN1ZGE3f3LHE0u7T6Vfq5yPMKoZ6SmrUxoFopAXZm5wVgMOsJHB8BgHQTDm7u0oTVU0ZHlKH2-o11RKK7Mz0mLqMy2EPdkGY9Bqtj5LZ8oTp8FaVqY1g5Fr5veXYpOMbc2fke-e2hG8sAfSjWz1Mq9BUhJ7HdK7TTIte12pub2nbUs4APYystJWx49cYmUwZ-5c9X295V-NX9UksuMSzFItZ4cACVKi68m9lkR4RuNQKFTuLvWsorz9yRx884e4cnoT_JmfSfYBIl31FfnQzUtCjluUzuD9jVXc_vgC7num_0AreOZiUzpglb8UjKXjswTHF-v_nEIaq7YmM5WKpeg\n`)),mdx(\"p\",null,\"The header and pay\\xADload sec\\xADtions con\\xADtain in\\xADfor\\xADma\\xADtion as a JSON ob\\xADject, whereas the sig\\xADna\\xADture is just a plain string. JSON ob\\xADjects con\\xADtain key value pairs which are called \",mdx(\"inlineCode\",{parentName:\"p\"},\"claims\"),\".\"),mdx(\"p\",null,`The claims in\\xADfor\\xADma\\xADtion can be ver\\xADi\\xADfied and trusted be\\xADcause it is dig\\xADi\\xADtally signed with the pri\\xADvate key from a pub\\xADlic/pri\\xADvate key-\\u200Bpair.\nThe sig\\xADna\\xADture can later be ver\\xADi\\xADfied with a cor\\xADre\\xADspond\\xADing pub\\xADlic key. The iden\\xADti\\xADfier of the pub\\xADlic/pri\\xADvate key-\\u200Bpair used to sign a JWT can be\ncon\\xADtained in a spe\\xADcial claim called `,mdx(\"inlineCode\",{parentName:\"p\"},\"kid\"),\" (key iden\\xADti\\xADfier) in the header sec\\xADtion of the JWT.\"),mdx(\"p\",null,\"An ex\\xADam\\xADple for a JWT header that ref\\xADer\\xADences a pub\\xADlic/pri\\xADvate key-\\u200Bpair looks like this:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-json\"}),`{\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"alg\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"RS256\"'),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"typ\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"JWT\"'),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"kid\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"c7M1_hdZ0-X3re9uvfKHTCQdqarPbpLnUI0ymvAtSTs\"'),`\n}\n`)),mdx(\"p\",null,`It is quite com\\xADmon to use JWTs to con\\xADvey in\\xADfor\\xADma\\xADtion about au\\xADthen\\xADti\\xADca\\xADtion (user iden\\xADtity) and au\\xADtho\\xADriza\\xADtion (scopes, user roles, per\\xADmis\\xADsions and other claims).\nOpenID providers such as `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.keycloak.org/\"}),\"Key\\xADcloak\"),` sup\\xADport is\\xADsu\\xADing OAuth2 ac\\xADcess to\\xADkens after au\\xADthen\\xADti\\xADca\\xADtion for users to clients in the form of JWTs.\nAn ac\\xADcess token can then be used to ac\\xADcess other ser\\xADvices or APIs on be\\xADhalf of the user. The server pro\\xADvid\\xADing those ser\\xADvices or APIs is often called `,mdx(\"inlineCode\",{parentName:\"p\"},\"resource server\"),\".\"),mdx(\"p\",null,\"An ex\\xADam\\xADple JWT pay\\xADload gen\\xADer\\xADated by Key\\xADcloak looks like this:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-json\"}),`{\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"exp\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-number\"}),\"1601318422\"),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"iat\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-number\"}),\"1601318122\"),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"jti\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"7635f5a1-f1d7-457d-b869-ad492352f4d2\"'),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"iss\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"http://localhost:8080/auth/realms/vertx\"'),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"aud\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"account\"'),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"sub\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"27b3fac0-9aec-4421-81cf-d4b02428f901\"'),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"typ\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"Bearer\"'),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"azp\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"vertx-service\"'),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"session_state\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"68708213-40b7-458a-aee1-39d6f9da07ad\"'),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"acr\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"1\"'),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"realm_access\"'),`: {\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"roles\"'),`: [\n      `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"offline_access\"'),`,\n      `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"uma_authorization\"'),`,\n      `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"user\"'),`\n    ]\n  },\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"scope\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"email profile\"'),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"email_verified\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-literal\"}),\"true\"),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"name\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"Theo Tester\"'),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"preferred_username\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"tester\"'),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"given_name\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"Theo\"'),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"family_name\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"Tester\"'),`,\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"email\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"tom+tester@localhost\"'),`\n}\n`)),mdx(\"p\",null,\"If a \",mdx(\"inlineCode\",{parentName:\"p\"},\"resource server\"),` re\\xADceives a re\\xADquest with such an ac\\xADcess token, it needs to ver\\xADify and in\\xADspect the token be\\xADfore it can trust its con\\xADtent.\nTo ver\\xADify the token, the `,mdx(\"inlineCode\",{parentName:\"p\"},\"resource server\"),\" needs to ob\\xADtain the \",mdx(\"inlineCode\",{parentName:\"p\"},\"public key\"),` to check the token sig\\xADna\\xADture.\nThis `,mdx(\"inlineCode\",{parentName:\"p\"},\"public key\"),\" can ei\\xADther be con\\xADfig\\xADured sta\\xADt\\xADi\\xADcally or fetched dy\\xADnam\\xADi\\xADcally from the OpenID Provider by lever\\xADag\\xADing the \",mdx(\"inlineCode\",{parentName:\"p\"},\"kid\"),` in\\xADfor\\xADma\\xADtion from the JWT header sec\\xADtion.\nNote that most `,mdx(\"inlineCode\",{parentName:\"p\"},\"OpenID providers\"),\", such as Key\\xADcloak, pro\\xADvide a ded\\xADi\\xADcated end\\xADpoint for dy\\xADnamic pub\\xADlic key lookups, e.g. \",mdx(\"inlineCode\",{parentName:\"p\"},\"http://localhost:8080/auth/realms/vertx/protocol/openid-connect/certs\"),`.\nA stan\\xADdard for pro\\xADvid\\xADing pub\\xADlic key in\\xADfor\\xADma\\xADtion is `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://tools.ietf.org/html/rfc7517\"}),\"JSON Web Key Set (JWKS)\"),`.\nThe JWKS in\\xADfor\\xADma\\xADtion is usu\\xADally cached by the re\\xADsource server to avoid the over\\xADhead of fetch\\xADing JWKS for every re\\xADquest.`),mdx(\"p\",null,\"An ex\\xADam\\xADple re\\xADsponse for Key\\xADcloak\\u2019s JWKS end\\xADpoint looks like this:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-json\"}),`{\n   `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"keys\"'),`:[\n      {\n         `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"kid\"'),\":\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"c7M1_hdZ0-X3re9uvfKHTCQdqarPbpLnUI0ymvAtSTs\"'),`,\n         `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"kty\"'),\":\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"RSA\"'),`,\n         `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"alg\"'),\":\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"RS256\"'),`,\n         `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"use\"'),\":\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"sig\"'),`,\n         `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"n\"'),\":\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"iFuX2bAXA99Yrv6YEvpV9tjS52krP5UJ7lFL02Zl83PPV6PiLIWKTqF71bfTKnVDxO421xAsBw9f6dlgoyxxY1H_bzJQQryQkry7DA7tI_SnKVsehLgeF-tCcjRF_MF1kM14F1A5Zsu6oYIkMZvgJIRM-ejtz3aUcdnLcTvpPrmfvj7KwRgNsfm6Q-kO0-OAf6m6LaRvaC5VpTIRoVxXNhSIiGKuZ4d05Yk0-HdOR0D0sfOujYzleJmTGBEIAmdWpZqUXiSWbzmpw8mJmacFTP9v8lsTUYZrXc69xm5fHaNJ6PO_E-IKiPKT7OeoM2l3HIK76a4azVL1Ewbv1UtMFw\"'),`,\n         `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"e\"'),\":\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"AQAB\"'),`,\n         `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"x5c\"'),`:[\n            `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"MIICmTCCAYECBgFwplKOujANBgkqhkiG9w0BAQsFADAQMQ4wDAYDVQQDDAV2ZXJ0eDAeFw0yMDAzMDQxNjExMzNaFw0zMDAzMDQxNjEzMTNaMBAxDjAMBgNVBAMMBXZlcnR4MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAiFuX2bAXA99Yrv6YEvpV9tjS52krP5UJ7lFL02Zl83PPV6PiLIWKTqF71bfTKnVDxO421xAsBw9f6dlgoyxxY1H/bzJQQryQkry7DA7tI/SnKVsehLgeF+tCcjRF/MF1kM14F1A5Zsu6oYIkMZvgJIRM+ejtz3aUcdnLcTvpPrmfvj7KwRgNsfm6Q+kO0+OAf6m6LaRvaC5VpTIRoVxXNhSIiGKuZ4d05Yk0+HdOR0D0sfOujYzleJmTGBEIAmdWpZqUXiSWbzmpw8mJmacFTP9v8lsTUYZrXc69xm5fHaNJ6PO/E+IKiPKT7OeoM2l3HIK76a4azVL1Ewbv1UtMFwIDAQABMA0GCSqGSIb3DQEBCwUAA4IBAQBxcXiTtGoo4/eMNwhagYH8QpK1n7fxgzn4mkESU3wD+rnPOAh/xFmx5c3aq8X+8W2z7oopO86ZBSQ8HfbzViBP0uwvf7s7E6Q8FOqrUNv0Kj308A7hF1IOqOhCJE2nABIWJduYz5dWZN434Q9El30L1eOYTtjBUmCdP7/CM+1bvxIT+CYrWmjI9zCMJxhuixmLffppsLCjGtNgFBemjQyCrLxpEGCfy8QGb4pTY/XaHuJ7k6ZaQkVeTbeDzaZbHc9zT5qgf6w4Gp7y+uPZdAsasrwiqm3YBtyBfaK42luk09nHpV6PRKpftnyLVPwlQiJAW6ZMckvDwmnDst70msnb\"'),`\n         ],\n         `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"x5t\"'),\":\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"MVYTXCx5cUQ8lT1ymIDDRYO7_ZI\"'),`,\n         `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"x5t#S256\"'),\":\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"yBDVTlfR0e7cv3HxbbkfvGKVs5W1VQtFs7haE_js3DY\"'),`\n      }\n   ]\n}\n`)),mdx(\"p\",null,\"The \",mdx(\"inlineCode\",{parentName:\"p\"},\"keys\"),` array con\\xADtains the JWKS struc\\xADture with the pub\\xADlic key in\\xADfor\\xADma\\xADtion that be\\xADlongs to the pub\\xADlic/pri\\xADvate key-\\u200Bpair which was used\nto sign the JWT ac\\xADcess token from above. Note the match\\xADing `,mdx(\"inlineCode\",{parentName:\"p\"},\"kid\"),\" claim from our ear\\xADlier JWT header ex\\xADam\\xADple.\"),mdx(\"p\",null,`Now that we have the ap\\xADpro\\xADpri\\xADate pub\\xADlic key, we can use the in\\xADfor\\xADma\\xADtion from the JWT header to val\\xADi\\xADdate the sig\\xADna\\xADture of the JWT ac\\xADcess token.\nIf the sig\\xADna\\xADture is valid, we can go on and check ad\\xADdi\\xADtional claims from the pay\\xADload sec\\xADtion of the JWT, such as ex\\xADpi\\xADra\\xADtion, al\\xADlowed is\\xADsuer and au\\xADdi\\xADence etc. `),mdx(\"p\",null,\"Now that we have the nec\\xADes\\xADsary build\\xADing blocks in place, we can fi\\xADnally look at how to con\\xADfig\\xADure JWT au\\xADtho\\xADriza\\xADtion in Vert.x.\"),mdx(\"h3\",e({},{id:\"jwt-authorization-in-vertx\"}),mdx(\"a\",e({parentName:\"h3\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#jwt-authorization-in-vertx\"})),\"JWT Authorization in Vert.x\"),mdx(\"p\",null,\"Set\\xADting up JWT au\\xADtho\\xADriza\\xADtion in Vert.x is quite easy. First we need to add the \",mdx(\"inlineCode\",{parentName:\"p\"},\"vertx-auth-jwt\"),\" mod\\xADule as a de\\xADpen\\xADdency to our project.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-xml\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"\u003c\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"dependency\"),\"\u003e\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"\u003c\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"groupId\"),\"\u003e\"),\"io.vertx\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"\u003c/\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"groupId\"),\"\u003e\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"\u003c\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"artifactId\"),\"\u003e\"),\"vertx-auth-jwt\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"\u003c/\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"artifactId\"),\"\u003e\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-tag\"}),\"\u003c/\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-name\"}),\"dependency\"),\"\u003e\"),`\n`)),mdx(\"p\",null,\"In our ex\\xADam\\xADple, the whole JWT au\\xADtho\\xADriza\\xADtion setup hap\\xADpens in the method \",mdx(\"inlineCode\",{parentName:\"p\"},\"setupJwtAuth\"),\".\"),mdx(\"p\",null,\"We use a \",mdx(\"inlineCode\",{parentName:\"p\"},\"WebClient\"),\" to dy\\xADnam\\xADi\\xADcally fetch the pub\\xADlic key in\\xADfor\\xADma\\xADtion from the \",mdx(\"inlineCode\",{parentName:\"p\"},\"/protocol/openid-connect/certs\"),` JWKS end\\xADpoint rel\\xADa\\xADtive to our Key\\xADcloak is\\xADsuer URL.\nAfter that, we con\\xADfig\\xADure a `,mdx(\"inlineCode\",{parentName:\"p\"},\"JWTAuth\"),\" in\\xADstance and cus\\xADtomize the JWT val\\xADi\\xADda\\xADtion via \",mdx(\"inlineCode\",{parentName:\"p\"},\"JWTOptions\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"JWTAuthOptions\"),`.\nNote that we use Key\\xADcloak\\u2019s realm roles for role based au\\xADtho\\xADriza\\xADtion via the `,mdx(\"inlineCode\",{parentName:\"p\"},\"JWTAuthOptions#setPermissionsClaimKey(..)\"),\" method.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-java\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-function\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-keyword\"}),\"private\"),\" Future\u003cStartup\u003e \",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-title\"}),\"setupJwtAuth\"),mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-params\"}),\"(Startup startup)\"),\" \"),`{\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),\" jwtConfig = startup.config.getJsonObject(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"jwt\"'),`);\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),\" issuer = jwtConfig.getString(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"issuer\"'),`);\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),` issuerUri = URI.create(issuer);\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// derive JWKS uri from Keycloak issuer URI\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),\" jwksUri = URI.create(jwtConfig.getString(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"jwksUri\"'),\", String.format(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"%s://%s:%d%s\"'),`,\n            issuerUri.getScheme(), issuerUri.getHost(), issuerUri.getPort(), issuerUri.getPath() + `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"/protocol/openid-connect/certs\"'),`)));\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),` promise = Promise.\u003cJWTAuth\u003epromise();\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// fetch JWKS from `/certs` endpoint\"),`\n    webClient.get(jwksUri.getPort(), jwksUri.getHost(), jwksUri.getPath())\n            .as(BodyCodec.jsonObject())\n            .send(ar -\u003e {\n\n                `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"if\"),` (!ar.succeeded()) {\n                    startup.bootstrap.fail(String.format(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"Could not fetch JWKS from URI: %s\"'),`, jwksUri));\n                    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),`;\n                }\n\n                `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),` response = ar.result();\n\n                `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),` jwksResponse = response.body();\n                `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),\" keys = jwksResponse.getJsonArray(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"keys\"'),`);\n\n                `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Configure JWT validation options\"),`\n                `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),\" jwtOptions = \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"new\"),` JWTOptions();\n                jwtOptions.setIssuer(issuer);\n\n                `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// extract JWKS from keys array\"),`\n                `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),` jwks = ((List\u003cObject\u003e) keys.getList()).stream()\n                        .map(o -\u003e `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"new\"),` JsonObject((Map\u003cString, Object\u003e) o))\n                        .collect(Collectors.toList());\n\n                `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// configure JWTAuth\"),`\n                `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),\" jwtAuthOptions = \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"new\"),` JWTAuthOptions();\n                jwtAuthOptions.setJwks(jwks);\n                jwtAuthOptions.setJWTOptions(jwtOptions);\n                jwtAuthOptions.setPermissionsClaimKey(jwtConfig.getString(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"permissionClaimsKey\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"realm_access/roles\"'),`));\n\n                JWTAuth jwtAuth = JWTAuth.create(vertx, jwtAuthOptions);\n                promise.complete(jwtAuth);\n            });\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),` promise.future().compose(auth -\u003e {\n        jwtAuth = auth;\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),` Future.succeededFuture(startup);\n    });\n}\n`)),mdx(\"h3\",e({},{id:\"protecting-routes-with-jwtauthhandler\"}),mdx(\"a\",e({parentName:\"h3\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#protecting-routes-with-jwtauthhandler\"})),\"Protecting routes with JWTAuthHandler\"),mdx(\"p\",null,\"Now that our \",mdx(\"inlineCode\",{parentName:\"p\"},\"JWTAuth\"),\" is con\\xADfig\\xADured, we can use the \",mdx(\"inlineCode\",{parentName:\"p\"},\"JWTAuthHandler\"),\" in the \",mdx(\"inlineCode\",{parentName:\"p\"},\"setupRouter\"),` method to apply\nJWT au\\xADtho\\xADriza\\xADtion to all routes match\\xADing the path pat\\xADtern `,mdx(\"inlineCode\",{parentName:\"p\"},\"/api/*\"),\". The \",mdx(\"inlineCode\",{parentName:\"p\"},\"JWTAuthHandler\"),` val\\xADi\\xADdates re\\xADceived JWTs and per\\xADforms\nad\\xADdi\\xADtional checks like ex\\xADpi\\xADra\\xADtion and al\\xADlowed is\\xADsuers. With that in place, we con\\xADfig\\xADure our ac\\xADtual routes in `,mdx(\"inlineCode\",{parentName:\"p\"},\"setupRoutes\"),\".\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-java\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-function\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-keyword\"}),\"private\"),\" Future\u003cStartup\u003e \",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-title\"}),\"setupRouter\"),mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-params\"}),\"(Startup startup)\"),\" \"),`{\n\n    router = Router.router(vertx);\n\n    router.route(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"/api/*\"'),`).handler(JWTAuthHandler.create(jwtAuth));\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),` Future.succeededFuture(startup);\n}\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-function\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-keyword\"}),\"private\"),\" Future\u003cStartup\u003e \",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-title\"}),\"setupRoutes\"),mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-params\"}),\"(Startup startup)\"),\" \"),`{\n\n    router.get(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"/api/greet\"'),\").handler(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"this\"),`::handleGreet);\n    router.get(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"/api/user\"'),\").handler(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"this\"),`::handleUserData);\n    router.get(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"/api/admin\"'),\").handler(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"this\"),`::handleAdminData);\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),` Future.succeededFuture(startup);\n}\n`)),mdx(\"h3\",e({},{id:\"extracting-user-information-from-jwtuser\"}),mdx(\"a\",e({parentName:\"h3\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#extracting-user-information-from-jwtuser\"})),\"Extracting user information from JWTUser\"),mdx(\"p\",null,\"To ac\\xADcess user in\\xADfor\\xADma\\xADtion in our \",mdx(\"inlineCode\",{parentName:\"p\"},\"handleGreet\"),\" method, we cast the re\\xADsult of the \",mdx(\"inlineCode\",{parentName:\"p\"},\"io.vertx.ext.web.RoutingContext#user\"),\" method to \",mdx(\"inlineCode\",{parentName:\"p\"},\"JWTUser\"),`\nwhich al\\xADlows us to ac\\xADcess token claim in\\xADfor\\xADma\\xADtion via the `,mdx(\"inlineCode\",{parentName:\"p\"},\"io.vertx.ext.auth.jwt.impl.JWTUser#principal\"),\" JSON ob\\xADject.\"),mdx(\"p\",null,\"If we\\u2019d like to use the JWT ac\\xADcess token for other ser\\xADvice calls, we could ex\\xADtract the token from the \",mdx(\"inlineCode\",{parentName:\"p\"},\"Authorization\"),\" header.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-java\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-function\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-keyword\"}),\"private\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-keyword\"}),\"void\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-title\"}),\"handleGreet\"),mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-params\"}),\"(RoutingContext ctx)\"),\" \"),`{\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),` jwtUser = (JWTUser) ctx.user();\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),\" username = jwtUser.principal().getString(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"preferred_username\"'),`);\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),\" userId = jwtUser.principal().getString(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"sub\"'),`);\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),\" accessToken = ctx.request().getHeader(HttpHeaders.AUTHORIZATION).substring(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"Bearer \"'),`.length());\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// Use accessToken for down-stream calls if needed...\"),`\n\n    ctx.request().response().end(String.format(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"Hi %s (%s) %s%n\"'),`, username, userId, Instant.now()));\n}\n`)),mdx(\"h3\",e({},{id:\"obtaining-an-access-token-from-keycloak-for-user-tester\"}),mdx(\"a\",e({parentName:\"h3\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#obtaining-an-access-token-from-keycloak-for-user-tester\"})),\"Obtaining an Access Token from Keycloak for user \",mdx(\"inlineCode\",{parentName:\"h3\"},\"tester\")),mdx(\"p\",null,\"To test our ap\\xADpli\\xADca\\xADtion we can use the fol\\xADlow\\xADing \",mdx(\"inlineCode\",{parentName:\"p\"},\"curl\"),` com\\xADmands in a bash like shell to ob\\xADtain an JWT ac\\xADcess token to call one\nof our end\\xADpoints as the user `,mdx(\"inlineCode\",{parentName:\"p\"},\"tester\"),\" with the role \",mdx(\"inlineCode\",{parentName:\"p\"},\"user\"),\".\"),mdx(\"p\",null,\"Note that this ex\\xADam\\xADple uses the cli tool \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://stedolan.github.io/jq/\"}),\"jq\"),\" for JSON pro\\xADcess\\xADing.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-bash\"}),`KC_USERNAME=tester\nKC_PASSWORD=`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"test\"),`\nKC_CLIENT=vertx-service\nKC_CLIENT_SECRET=ecb85cc5-f90d-4a03-8fac-24dcde57f40c\nKC_REALM=vertx\nKC_URL=http://localhost:8080/auth\nKC_RESPONSE=$(curl  -k \\\\\n        -d `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"username=',mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-variable\"}),\"$KC_USERNAME\"),'\"'),` \\\\\n        -d `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"password=',mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-variable\"}),\"$KC_PASSWORD\"),'\"'),` \\\\\n        -d `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),\"'grant_type=password'\"),` \\\\\n        -d `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"client_id=',mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-variable\"}),\"$KC_CLIENT\"),'\"'),` \\\\\n        -d `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"client_secret=',mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-variable\"}),\"$KC_CLIENT_SECRET\"),'\"'),` \\\\\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"',mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-variable\"}),\"$KC_URL\"),\"/realms/\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-variable\"}),\"$KC_REALM\"),'/protocol/openid-connect/token\"'),` \\\\\n    | jq .)\n\nKC_ACCESS_TOKEN=$(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"echo\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"$KC_RESPONSE\"),`| jq -r .access_token)\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"echo\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"$KC_ACCESS_TOKEN\"),`\n`)),mdx(\"p\",null,\"Here we use the JWT ac\\xADcess token in the \",mdx(\"inlineCode\",{parentName:\"p\"},\"Authorization\"),\" header with the \",mdx(\"inlineCode\",{parentName:\"p\"},\"Bearer\"),\" pre\\xADfix to call our \",mdx(\"inlineCode\",{parentName:\"p\"},\"greet\"),\" route:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-bash\"}),\"curl --silent -H \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"Authorization: Bearer ',mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-variable\"}),\"$KC_ACCESS_TOKEN\"),'\"'),` http://localhost:3000/api/greet\n`)),mdx(\"p\",null,\"Ex\\xADam\\xADple out\\xADput:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-bash\"}),`Hi tester (27b3fac0-9aec-4421-81cf-d4b02428f901) 2020-09-28T21:03:59.254230700Z\n`)),mdx(\"h3\",e({},{id:\"applying-role-based-access-control-with-jwtuser\"}),mdx(\"a\",e({parentName:\"h3\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#applying-role-based-access-control-with-jwtuser\"})),\"Applying Role-based Access-Control with JWTUser\"),mdx(\"p\",null,\"To lever\\xADage sup\\xADport for role based ac\\xADcess con\\xADtrol (RBAC) we can use the \",mdx(\"inlineCode\",{parentName:\"p\"},\"io.vertx.ext.auth.User#isAuthorised\"),` method\nto check whether the cur\\xADrent user has the re\\xADquired role. If the role is present we re\\xADturn some data about the user, oth\\xADer\\xADwise\nwe send a re\\xADsponse with sta\\xADtus code 403 and a `,mdx(\"inlineCode\",{parentName:\"p\"},\"forbidden\"),\" error mes\\xADsage.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-java\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-function\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-keyword\"}),\"private\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-keyword\"}),\"void\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-title\"}),\"handleUserData\"),mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-params\"}),\"(RoutingContext ctx)\"),\" \"),`{\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),` jwtUser = (JWTUser) ctx.user();\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),\" username = jwtUser.principal().getString(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"preferred_username\"'),`);\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),\" userId = jwtUser.principal().getString(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"sub\"'),`);\n\n    jwtUser.isAuthorized(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"user\"'),`, res -\u003e {\n\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"if\"),` (!res.succeeded() || !res.result()) {\n            toJsonResponse(ctx).setStatusCode(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-number\"}),\"403\"),\").end(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"{\\\\\"error\\\\\": \\\\\"forbidden\\\\\"}\"'),`);\n            `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),`;\n        }\n\n        JsonObject data = `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"new\"),` JsonObject()\n                .put(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"type\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"user\"'),`)\n                .put(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"username\"'),`, username)\n                .put(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"userId\"'),`, userId)\n                .put(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"timestamp\"'),`, Instant.now());\n\n        toJsonResponse(ctx).end(data.toString());\n    });\n}\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-function\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-keyword\"}),\"private\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-keyword\"}),\"void\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-title\"}),\"handleAdminData\"),mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-params\"}),\"(RoutingContext ctx)\"),\" \"),`{\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),` jwtUser = (JWTUser) ctx.user();\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),\" username = jwtUser.principal().getString(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"preferred_username\"'),`);\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),\" userId = jwtUser.principal().getString(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"sub\"'),`);\n\n    jwtUser.isAuthorized(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"admin\"'),`, res -\u003e {\n\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"if\"),` (!res.succeeded() || !res.result()) {\n            toJsonResponse(ctx).setStatusCode(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-number\"}),\"403\"),\").end(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"{\\\\\"error\\\\\": \\\\\"forbidden\\\\\"}\"'),`);\n            `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),`;\n        }\n\n        JsonObject data = `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"new\"),` JsonObject()\n                .put(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"type\"'),\", \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"admin\"'),`)\n                .put(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"username\"'),`, username)\n                .put(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"userId\"'),`, userId)\n                .put(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"timestamp\"'),`, Instant.now());\n\n        toJsonResponse(ctx).end(data.toString());\n    });\n}\n`)),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-bash\"}),\"curl --silent -H \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"Authorization: Bearer ',mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-variable\"}),\"$KC_ACCESS_TOKEN\"),'\"'),` http://localhost:3000/api/user\n`)),mdx(\"p\",null,\"Out\\xADput:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-json\"}),\"{\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"type\"'),\":\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"user\"'),\",\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"username\"'),\":\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"tester\"'),\",\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"userId\"'),\":\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"27b3fac0-9aec-4421-81cf-d4b02428f901\"'),\",\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"timestamp\"'),\":\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"2020-09-28T21:07:49.340950300Z\"'),`}\n`)),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-bash\"}),\"curl --silent -H \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"Authorization: Bearer ',mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-variable\"}),\"$KC_ACCESS_TOKEN\"),'\"'),` http://localhost:3000/api/admin\n`)),mdx(\"p\",null,\"Out\\xADput:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-json\"}),\"{\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"error\"'),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"forbidden\"'),`}\n`)),mdx(\"h3\",e({},{id:\"obtaining-an-access-token-from-keycloak-for-user-vadmin\"}),mdx(\"a\",e({parentName:\"h3\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#obtaining-an-access-token-from-keycloak-for-user-vadmin\"})),\"Obtaining an Access Token from Keycloak for user \",mdx(\"inlineCode\",{parentName:\"h3\"},\"vadmin\")),mdx(\"p\",null,\"To check ac\\xADcess with an \",mdx(\"inlineCode\",{parentName:\"p\"},\"admin\"),\" role, we ob\\xADtain a new token for the user \",mdx(\"inlineCode\",{parentName:\"p\"},\"vadmin\"),\" which has the roles \",mdx(\"inlineCode\",{parentName:\"p\"},\"admin\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"user\"),\". \"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-bash\"}),`KC_USERNAME=vadmin\nKC_PASSWORD=`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"test\"),`\nKC_CLIENT=vertx-service\nKC_CLIENT_SECRET=ecb85cc5-f90d-4a03-8fac-24dcde57f40c\nKC_REALM=vertx\nKC_URL=http://localhost:8080/auth\nKC_RESPONSE=$(curl  -k \\\\\n        -d `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"username=',mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-variable\"}),\"$KC_USERNAME\"),'\"'),` \\\\\n        -d `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"password=',mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-variable\"}),\"$KC_PASSWORD\"),'\"'),` \\\\\n        -d `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),\"'grant_type=password'\"),` \\\\\n        -d `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"client_id=',mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-variable\"}),\"$KC_CLIENT\"),'\"'),` \\\\\n        -d `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"client_secret=',mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-variable\"}),\"$KC_CLIENT_SECRET\"),'\"'),` \\\\\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"',mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-variable\"}),\"$KC_URL\"),\"/realms/\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-variable\"}),\"$KC_REALM\"),'/protocol/openid-connect/token\"'),` \\\\\n    | jq .)\n\nKC_ACCESS_TOKEN=$(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"echo\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"$KC_RESPONSE\"),`| jq -r .access_token)\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"echo\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"$KC_ACCESS_TOKEN\"),`\n`)),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-bash\"}),\"curl --silent -H \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"Authorization: Bearer ',mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-variable\"}),\"$KC_ACCESS_TOKEN\"),'\"'),` http://localhost:3000/api/user\n`)),mdx(\"p\",null,\"Out\\xADput:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-json\"}),\"{\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"type\"'),\":\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"user\"'),\",\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"username\"'),\":\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"vadmin\"'),\",\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"userId\"'),\":\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"75090eac-36ff-4cd8-847d-fc2941bc024e\"'),\",\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"timestamp\"'),\":\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"2020-09-28T21:13:05.099393900Z\"'),`}\n`)),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-bash\"}),\"curl --silent -H \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"Authorization: Bearer ',mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-variable\"}),\"$KC_ACCESS_TOKEN\"),'\"'),` http://localhost:3000/api/admin\n`)),mdx(\"p\",null,\"Out\\xADput:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-json\"}),\"{\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"type\"'),\":\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"admin\"'),\",\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"username\"'),\":\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"vadmin\"'),\",\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"userId\"'),\":\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"75090eac-36ff-4cd8-847d-fc2941bc024e\"'),\",\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"timestamp\"'),\":\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"2020-09-28T21:13:34.945276500Z\"'),`}\n`)),mdx(\"h3\",e({},{id:\"conclusion\"}),mdx(\"a\",e({parentName:\"h3\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#conclusion\"})),\"Conclusion\"),mdx(\"p\",null,`We learned how to con\\xADfig\\xADure a Vert.x ap\\xADpli\\xADca\\xADtion with JWT au\\xADtho\\xADriza\\xADtion pow\\xADered by Key\\xADcloak. Al\\xADthough the con\\xADfig\\xADu\\xADra\\xADtion is quite com\\xADplete\nal\\xADready, there are still some parts that can be im\\xADproved, like the dy\\xADnamic JWKS fetch\\xADing on public-\\u200Bkey pair ro\\xADta\\xADtion as well as ex\\xADtrac\\xADtion of nested roles.`),mdx(\"p\",null,\"Nev\\xADer\\xADthe\\xADless this is a good start\\xADing point for se\\xADcur\\xADing your own Vert.x ser\\xADvices with JWT and Key\\xADcloak.\"),mdx(\"p\",null,\"You can check out the \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/thomasdarimont/vertx-playground/tree/master/jwt-service-vertx\"}),\"com\\xADplete ex\\xADam\\xADple in keycloak-\\u200Bvertx Ex\\xADam\\xADples Repo\"),\".\"),mdx(\"p\",null,\"Thank you for your time, stay tuned for more up\\xADdates! If you want to learn more about Key\\xADcloak, feel free to reach out to me. You can find me via \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://twitter.com/thomasdarimont\"}),\"thomas\\xADda\\xADri\\xADmont on twit\\xADter\"),\".\"),mdx(\"p\",null,\"Happy Hack\\xADing!\"))}MDXContent.isMDXComponent=!0;\n","scope":{}}},"prevPost":{"meta":{"title":"Eclipse Vert.x 3.9.4 released!","category":"releases","authors":[{"name":"Julien Viet","github_id":"vietj"}],"summary":"Eclipse Vert.x version 3.9.4 has just been released. It fixes quite a few bugs that have been reported by the community."},"date":"2020-10-15","slug":"eclipse-vert-x-3-9-4-released"},"nextPost":{"meta":{"title":"Eclipse Vert.x 4 beta 3 released!","category":"releases","authors":[{"name":"Julien Viet","github_id":"vietj"}],"summary":"The third beta version of Eclipse Vert.x 4.0 highlights many features including (but not limited to) HTTP client request creation, HTTP tunnel improvements, and WebSocket upgrade improvements."},"date":"2020-09-25","slug":"eclipse-vert-x-4-beta-3-released"},"relatedPosts":[{"meta":{"title":"Easy SSO for Vert.x with Keycloak","category":"guides","authors":[{"name":"Thomas Darimont","github_id":"thomasdarimont"}],"summary":"In this blog post, you'll learn how to implement Single Sign-on with OpenID Connect and how to use Keycloak together with Eclipse Vert.x."},"date":"2020-03-16","slug":"easy-sso-for-vert-x-with-keycloak"},{"meta":{"title":"Things to keep in mind concerning CSRF attacks","category":"guides","authors":[{"name":"Xhelal Likaj","github_id":"xhlika"}],"summary":"Eclipse Vert.x like most frameworks provides an anti-CSRF defense. However, no framework can prevent all attack vectors that exist in the web. Therefore, developers need to be aware of some dangers and common attack vectors concerning CSRF defenses."},"date":"2021-01-23","slug":"eclipse-vert-x-CSRF-concerns"},{"meta":{"title":"Unit and Integration Tests","category":"guides","authors":[{"name":"Clement Escoffier","github_id":"cescoffier"}],"summary":"Letâ€™s refresh our mind about what we developed so far in the introduction to vert.x series. We forgot an important task. We didnâ€™t test the API."},"date":"2015-08-03","slug":"unit-and-integration-tests"}]},"__N_SSG":true},"page":"/blog/[[...slug]]","query":{"slug":["jwt-authorization-for-vert-x-with-keycloak"]},"buildId":"peDB05ylg8_PpP0Vbjzi2","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>
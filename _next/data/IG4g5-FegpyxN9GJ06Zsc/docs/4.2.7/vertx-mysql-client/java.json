{"pageProps":{"slug":"4.2.7/vertx-mysql-client/java","title":"Reactive MySQL Client","fallbackGitHubStars":779,"toc":"<div id=\"toc\" class=\"toc\">\n<div id=\"toctitle\">Table of Contents</div>\n<ul class=\"sectlevel1\">\n<li><a href=\"#_usage\">Usage</a></li>\n<li><a href=\"#_getting_started\">Getting started</a></li>\n<li><a href=\"#_connecting_to_mysql\">Connecting to MySQL</a></li>\n<li><a href=\"#_pool_sharing\">Pool sharing</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_unix_domain_socket\">Unix Domain Socket</a></li>\n</ul>\n</li>\n<li><a href=\"#_configuration\">Configuration</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_data_object\">Data Object</a></li>\n<li><a href=\"#_connection_uri\">connection URI</a></li>\n</ul>\n</li>\n<li><a href=\"#_connect_retries\">Connect retries</a></li>\n<li><a href=\"#_running_queries\">Running queries</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_prepared_queries\">Prepared queries</a></li>\n<li><a href=\"#_batches\">Batches</a></li>\n</ul>\n</li>\n<li><a href=\"#_mysql_last_insert_id\">MySQL LAST_INSERT_ID</a></li>\n<li><a href=\"#_using_connections\">Using connections</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_getting_a_connection\">Getting a connection</a></li>\n<li><a href=\"#_simplified_connection_api\">Simplified connection API</a></li>\n</ul>\n</li>\n<li><a href=\"#_using_transactions\">Using transactions</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_transactions_with_connections\">Transactions with connections</a></li>\n<li><a href=\"#_simplified_transaction_api\">Simplified transaction API</a></li>\n</ul>\n</li>\n<li><a href=\"#_cursors_and_streaming\">Cursors and streaming</a></li>\n<li><a href=\"#_tracing_queries\">Tracing queries</a></li>\n<li><a href=\"#_mysql_type_mapping\">MySQL type mapping</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_implicit_type_conversion\">Implicit type conversion</a></li>\n<li><a href=\"#_handling_boolean\">Handling BOOLEAN</a></li>\n<li><a href=\"#_handling_json\">Handling JSON</a></li>\n<li><a href=\"#_handling_bit\">Handling BIT</a></li>\n<li><a href=\"#_handling_time\">Handling TIME</a></li>\n<li><a href=\"#_handling_numeric\">Handling NUMERIC</a></li>\n<li><a href=\"#_handling_enum\">Handling ENUM</a></li>\n<li><a href=\"#_handling_geometry\">Handling GEOMETRY</a></li>\n</ul>\n</li>\n<li><a href=\"#_collector_queries\">Collector queries</a></li>\n<li><a href=\"#_mysql_stored_procedure\">MySQL Stored Procedure</a></li>\n<li><a href=\"#_mysql_local_infile\">MySQL LOCAL INFILE</a></li>\n<li><a href=\"#_authentication\">Authentication</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_default_authentication_plugin\">Default authentication plugin</a></li>\n<li><a href=\"#_new_authentication_method_introduced_in_mysql_8\">New authentication method introduced in MySQL 8</a></li>\n</ul>\n</li>\n<li><a href=\"#_using_ssltls\">Using SSL/TLS</a></li>\n<li><a href=\"#_mysql_utility_command\">MySQL utility command</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_com_ping\">COM_PING</a></li>\n<li><a href=\"#_com_reset_connection\">COM_RESET_CONNECTION</a></li>\n<li><a href=\"#_com_change_user\">COM_CHANGE_USER</a></li>\n<li><a href=\"#_com_init_db\">COM_INIT_DB</a></li>\n<li><a href=\"#_com_statistics\">COM_STATISTICS</a></li>\n<li><a href=\"#_com_debug\">COM_DEBUG</a></li>\n<li><a href=\"#_com_set_option\">COM_SET_OPTION</a></li>\n</ul>\n</li>\n<li><a href=\"#_mysql_and_mariadb_version_support_matrix\">MySQL and MariaDB version support matrix</a></li>\n<li><a href=\"#_pitfalls_good_practices\">Pitfalls &amp; Good Practices</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_prepared_statement_count_limit\">prepared statement count limit</a></li>\n<li><a href=\"#_demystifying_prepared_batch\">demystifying prepared batch</a></li>\n<li><a href=\"#_tricky_date_time_data_types\">tricky DATE &amp; TIME data types</a></li>\n</ul>\n</li>\n<li><a href=\"#_advanced_pool_configuration\">Advanced pool configuration</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_server_load_balancing\">Server load balancing</a></li>\n<li><a href=\"#_pool_connection_initialization\">Pool connection initialization</a></li>\n</ul>\n</li>\n</ul>\n</div>","contents":"<h1>Reactive MySQL Client</h1>\n\n<div id=\"preamble\">\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>The Reactive MySQL Client is a client for MySQL with a straightforward API focusing on\nscalability and low overhead.</p>\n</div>\n<div class=\"paragraph\">\n<p><strong>Features</strong></p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Event driven</p>\n</li>\n<li>\n<p>Lightweight</p>\n</li>\n<li>\n<p>Built-in connection pooling</p>\n</li>\n<li>\n<p>Prepared queries caching</p>\n</li>\n<li>\n<p>Cursor support</p>\n</li>\n<li>\n<p>Row streaming</p>\n</li>\n<li>\n<p>RxJava API</p>\n</li>\n<li>\n<p>Direct memory to object without unnecessary copies</p>\n</li>\n<li>\n<p>Complete data type support</p>\n</li>\n<li>\n<p>Stored Procedures support</p>\n</li>\n<li>\n<p>TLS/SSL support</p>\n</li>\n<li>\n<p>MySQL utilities commands support</p>\n</li>\n<li>\n<p>Working with MySQL and MariaDB</p>\n</li>\n<li>\n<p>Rich collation and charset support</p>\n</li>\n<li>\n<p>Unix domain socket</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_usage\"><a class=\"anchor\" href=\"#_usage\"></a>Usage</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>To use the Reactive MySQL Client add the following dependency to the <em>dependencies</em> section of your build descriptor:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Maven (in your <code>pom.xml</code>):</p>\n</li>\n</ul>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-xml\" data-lang=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>io.vertx<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>vertx-mysql-client<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>4.2.7<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span></code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Gradle (in your <code>build.gradle</code> file):</p>\n</li>\n</ul>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-groovy\" data-lang=\"groovy\">dependencies {\n compile <span class=\"hljs-string\">&#x27;io.vertx:vertx-mysql-client:4.2.7&#x27;</span>\n}</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_getting_started\"><a class=\"anchor\" href=\"#_getting_started\"></a>Getting started</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Here is the simplest way to connect, query and disconnect</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">MySQLConnectOptions</span> <span class=\"hljs-variable\">connectOptions</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MySQLConnectOptions</span>()\n  .setPort(<span class=\"hljs-number\">3306</span>)\n  .setHost(<span class=\"hljs-string\">&quot;the-host&quot;</span>)\n  .setDatabase(<span class=\"hljs-string\">&quot;the-db&quot;</span>)\n  .setUser(<span class=\"hljs-string\">&quot;user&quot;</span>)\n  .setPassword(<span class=\"hljs-string\">&quot;secret&quot;</span>);\n\n<span class=\"hljs-comment\">// Pool options</span>\n<span class=\"hljs-type\">PoolOptions</span> <span class=\"hljs-variable\">poolOptions</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">PoolOptions</span>()\n  .setMaxSize(<span class=\"hljs-number\">5</span>);\n\n<span class=\"hljs-comment\">// Create the client pool</span>\n<span class=\"hljs-type\">MySQLPool</span> <span class=\"hljs-variable\">client</span> <span class=\"hljs-operator\">=</span> MySQLPool.pool(connectOptions, poolOptions);\n\n<span class=\"hljs-comment\">// A simple query</span>\nclient\n  .query(<span class=\"hljs-string\">&quot;SELECT * FROM users WHERE id=&#x27;julien&#x27;&quot;</span>)\n  .execute(ar -&gt; {\n  <span class=\"hljs-keyword\">if</span> (ar.succeeded()) {\n    RowSet&lt;Row&gt; result = ar.result();\n    System.out.println(<span class=\"hljs-string\">&quot;Got &quot;</span> + result.size() + <span class=\"hljs-string\">&quot; rows &quot;</span>);\n  } <span class=\"hljs-keyword\">else</span> {\n    System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar.cause().getMessage());\n  }\n\n  <span class=\"hljs-comment\">// Now close the pool</span>\n  client.close();\n});</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_connecting_to_mysql\"><a class=\"anchor\" href=\"#_connecting_to_mysql\"></a>Connecting to MySQL</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Most of the time you will use a pool to connect to MySQL:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">MySQLConnectOptions</span> <span class=\"hljs-variable\">connectOptions</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MySQLConnectOptions</span>()\n  .setPort(<span class=\"hljs-number\">3306</span>)\n  .setHost(<span class=\"hljs-string\">&quot;the-host&quot;</span>)\n  .setDatabase(<span class=\"hljs-string\">&quot;the-db&quot;</span>)\n  .setUser(<span class=\"hljs-string\">&quot;user&quot;</span>)\n  .setPassword(<span class=\"hljs-string\">&quot;secret&quot;</span>);\n\n<span class=\"hljs-comment\">// Pool options</span>\n<span class=\"hljs-type\">PoolOptions</span> <span class=\"hljs-variable\">poolOptions</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">PoolOptions</span>()\n  .setMaxSize(<span class=\"hljs-number\">5</span>);\n\n<span class=\"hljs-comment\">// Create the pooled client</span>\n<span class=\"hljs-type\">MySQLPool</span> <span class=\"hljs-variable\">client</span> <span class=\"hljs-operator\">=</span> MySQLPool.pool(connectOptions, poolOptions);</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>The pooled client uses a connection pool and any operation will borrow a connection from the pool\nto execute the operation and release it to the pool.</p>\n</div>\n<div class=\"paragraph\">\n<p>If you are running with Vert.x you can pass it your Vertx instance:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">MySQLConnectOptions</span> <span class=\"hljs-variable\">connectOptions</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MySQLConnectOptions</span>()\n  .setPort(<span class=\"hljs-number\">3306</span>)\n  .setHost(<span class=\"hljs-string\">&quot;the-host&quot;</span>)\n  .setDatabase(<span class=\"hljs-string\">&quot;the-db&quot;</span>)\n  .setUser(<span class=\"hljs-string\">&quot;user&quot;</span>)\n  .setPassword(<span class=\"hljs-string\">&quot;secret&quot;</span>);\n\n<span class=\"hljs-comment\">// Pool options</span>\n<span class=\"hljs-type\">PoolOptions</span> <span class=\"hljs-variable\">poolOptions</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">PoolOptions</span>()\n  .setMaxSize(<span class=\"hljs-number\">5</span>);\n<span class=\"hljs-comment\">// Create the pooled client</span>\n<span class=\"hljs-type\">MySQLPool</span> <span class=\"hljs-variable\">client</span> <span class=\"hljs-operator\">=</span> MySQLPool.pool(vertx, connectOptions, poolOptions);</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>You need to release the pool when you don&#8217;t need it anymore:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">pool.close();</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>When you need to execute several operations on the same connection, you need to use a client\n<code><a href=\"../../apidocs/io/vertx/mysqlclient/MySQLConnection.html\">connection</a></code>.</p>\n</div>\n<div class=\"paragraph\">\n<p>You can easily get one from the pool:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">MySQLConnectOptions</span> <span class=\"hljs-variable\">connectOptions</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MySQLConnectOptions</span>()\n  .setPort(<span class=\"hljs-number\">3306</span>)\n  .setHost(<span class=\"hljs-string\">&quot;the-host&quot;</span>)\n  .setDatabase(<span class=\"hljs-string\">&quot;the-db&quot;</span>)\n  .setUser(<span class=\"hljs-string\">&quot;user&quot;</span>)\n  .setPassword(<span class=\"hljs-string\">&quot;secret&quot;</span>);\n\n<span class=\"hljs-comment\">// Pool options</span>\n<span class=\"hljs-type\">PoolOptions</span> <span class=\"hljs-variable\">poolOptions</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">PoolOptions</span>()\n  .setMaxSize(<span class=\"hljs-number\">5</span>);\n\n<span class=\"hljs-comment\">// Create the pooled client</span>\n<span class=\"hljs-type\">MySQLPool</span> <span class=\"hljs-variable\">client</span> <span class=\"hljs-operator\">=</span> MySQLPool.pool(vertx, connectOptions, poolOptions);\n\n<span class=\"hljs-comment\">// Get a connection from the pool</span>\nclient.getConnection().compose(conn -&gt; {\n  System.out.println(<span class=\"hljs-string\">&quot;Got a connection from the pool&quot;</span>);\n\n  <span class=\"hljs-comment\">// All operations execute on the same connection</span>\n  <span class=\"hljs-keyword\">return</span> conn\n    .query(<span class=\"hljs-string\">&quot;SELECT * FROM users WHERE id=&#x27;julien&#x27;&quot;</span>)\n    .execute()\n    .compose(res -&gt; conn\n      .query(<span class=\"hljs-string\">&quot;SELECT * FROM users WHERE id=&#x27;emad&#x27;&quot;</span>)\n      .execute())\n    .onComplete(ar -&gt; {\n      <span class=\"hljs-comment\">// Release the connection to the pool</span>\n      conn.close();\n    });\n}).onComplete(ar -&gt; {\n  <span class=\"hljs-keyword\">if</span> (ar.succeeded()) {\n\n    System.out.println(<span class=\"hljs-string\">&quot;Done&quot;</span>);\n  } <span class=\"hljs-keyword\">else</span> {\n    System.out.println(<span class=\"hljs-string\">&quot;Something went wrong &quot;</span> + ar.cause().getMessage());\n  }\n});</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Once you are done with the connection you must close it to release it to the pool, so it can be reused.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_pool_sharing\"><a class=\"anchor\" href=\"#_pool_sharing\"></a>Pool sharing</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>You can share an pool between multiple verticles or instances of the same verticle. Such pool should be created outside\na verticle otherwise it will be closed when the verticle that created it is undeployed</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">MySQLPool</span> <span class=\"hljs-variable\">pool</span> <span class=\"hljs-operator\">=</span> MySQLPool.pool(database, <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">PoolOptions</span>().setMaxSize(maxSize));\nvertx.deployVerticle(() -&gt; <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">AbstractVerticle</span>() {\n  <span class=\"hljs-meta\">@Override</span>\n  <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">start</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">throws</span> Exception {\n    <span class=\"hljs-comment\">// Use the pool</span>\n  }\n}, <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DeploymentOptions</span>().setInstances(<span class=\"hljs-number\">4</span>));</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>You can also create a shared pool in each verticle:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">vertx.deployVerticle(() -&gt; <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">AbstractVerticle</span>() {\n  MySQLPool pool;\n  <span class=\"hljs-meta\">@Override</span>\n  <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">start</span><span class=\"hljs-params\">()</span> {\n    <span class=\"hljs-comment\">// Get or create a shared pool</span>\n    <span class=\"hljs-comment\">// this actually creates a lease to the pool</span>\n    <span class=\"hljs-comment\">// when the verticle is undeployed, the lease will be released automaticaly</span>\n    pool = MySQLPool.pool(database, <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">PoolOptions</span>()\n      .setMaxSize(maxSize)\n      .setShared(<span class=\"hljs-literal\">true</span>)\n      .setName(<span class=\"hljs-string\">&quot;my-pool&quot;</span>));\n  }\n}, <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DeploymentOptions</span>().setInstances(<span class=\"hljs-number\">4</span>));</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>The first time a shared pool is created it will create the resources for the pool. Subsequent calls will reuse this pool and create\na lease to this pool. The resources are disposed after all leases have been closed.</p>\n</div>\n<div class=\"paragraph\">\n<p>By default, a pool reuses the current event-loop when it needs to create a TCP connection. The shared pool will\ntherefore randomly use event-loops of verticles using it.</p>\n</div>\n<div class=\"paragraph\">\n<p>You can assign a number of event loop a pool will use independently of the context using it</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">MySQLPool</span> <span class=\"hljs-variable\">pool</span> <span class=\"hljs-operator\">=</span> MySQLPool.pool(database, <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">PoolOptions</span>()\n  .setMaxSize(maxSize)\n  .setShared(<span class=\"hljs-literal\">true</span>)\n  .setName(<span class=\"hljs-string\">&quot;my-pool&quot;</span>)\n  .setEventLoopSize(<span class=\"hljs-number\">4</span>));</code></pre>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_unix_domain_socket\"><a class=\"anchor\" href=\"#_unix_domain_socket\"></a>Unix Domain Socket</h3>\n<div class=\"paragraph\">\n<p>Sometimes for simplicity, security or performance reasons, it is required to connect via a <a href=\"https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_socket\">Unix Domain Socket</a>.</p>\n</div>\n<div class=\"paragraph\">\n<p>Since the JVM does not support domain sockets, first you must add native transport extensions to your project.</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Maven (in your <code>pom.xml</code>):</p>\n</li>\n</ul>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-xml\" data-lang=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>io.netty<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>netty-transport-native-epoll<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${netty.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">classifier</span>&gt;</span>linux-x86_64<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">classifier</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span></code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Gradle (in your <code>build.gradle</code> file):</p>\n</li>\n</ul>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-groovy\" data-lang=\"groovy\">dependencies {\n compile <span class=\"hljs-string\">&#x27;io.netty:netty-transport-native-epoll:${netty.version}:linux-x86_64&#x27;</span>\n}</code></pre>\n</div>\n</div>\n<div class=\"admonitionblock note\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\">Note</div>\n</td>\n<td class=\"content\">\nThe native <code>epoll</code> support for ARM64 can also be added with the classifier <code>linux-aarch64</code>.\n</td>\n</tr>\n</table>\n</div>\n<div class=\"admonitionblock note\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\">Note</div>\n</td>\n<td class=\"content\">\nIf there are Mac users in your team, add <code>netty-transport-native-kqueue</code> with the classifier <code>osx-x86_64</code>.\n</td>\n</tr>\n</table>\n</div>\n<div class=\"paragraph\">\n<p>Then set the path to the domain socket in <code><a href=\"../../apidocs/io/vertx/mysqlclient/MySQLConnectOptions.html#setHost-java.lang.String-\">MySQLConnectOptions#setHost</a></code>:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">MySQLConnectOptions</span> <span class=\"hljs-variable\">connectOptions</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MySQLConnectOptions</span>()\n  .setHost(<span class=\"hljs-string\">&quot;/var/run/mysqld/mysqld.sock&quot;</span>)\n  .setDatabase(<span class=\"hljs-string\">&quot;the-db&quot;</span>);\n\n<span class=\"hljs-comment\">// Pool options</span>\n<span class=\"hljs-type\">PoolOptions</span> <span class=\"hljs-variable\">poolOptions</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">PoolOptions</span>()\n  .setMaxSize(<span class=\"hljs-number\">5</span>);\n\n<span class=\"hljs-comment\">// Create the pooled client</span>\n<span class=\"hljs-type\">MySQLPool</span> <span class=\"hljs-variable\">client</span> <span class=\"hljs-operator\">=</span> MySQLPool.pool(connectOptions, poolOptions);\n\n<span class=\"hljs-comment\">// Create the pooled client with a vertx instance</span>\n<span class=\"hljs-comment\">// Make sure the vertx instance has enabled native transports</span>\n<span class=\"hljs-comment\">// vertxOptions.setPreferNativeTransport(true);</span>\n<span class=\"hljs-type\">MySQLPool</span> <span class=\"hljs-variable\">client2</span> <span class=\"hljs-operator\">=</span> MySQLPool.pool(vertx, connectOptions, poolOptions);</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>More information about native transports can be found in the [Vert.x documentation](<a href=\"https://vertx.io/docs/vertx-core/java/#_native_transports\" class=\"bare\">https://vertx.io/docs/vertx-core/java/#_native_transports</a>).</p>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_configuration\"><a class=\"anchor\" href=\"#_configuration\"></a>Configuration</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>There are several alternatives for you to configure the client.</p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_data_object\"><a class=\"anchor\" href=\"#_data_object\"></a>Data Object</h3>\n<div class=\"paragraph\">\n<p>A simple way to configure the client is to specify a <code>MySQLConnectOptions</code> data object.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">MySQLConnectOptions</span> <span class=\"hljs-variable\">connectOptions</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MySQLConnectOptions</span>()\n  .setPort(<span class=\"hljs-number\">3306</span>)\n  .setHost(<span class=\"hljs-string\">&quot;the-host&quot;</span>)\n  .setDatabase(<span class=\"hljs-string\">&quot;the-db&quot;</span>)\n  .setUser(<span class=\"hljs-string\">&quot;user&quot;</span>)\n  .setPassword(<span class=\"hljs-string\">&quot;secret&quot;</span>);\n\n<span class=\"hljs-comment\">// Pool Options</span>\n<span class=\"hljs-type\">PoolOptions</span> <span class=\"hljs-variable\">poolOptions</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">PoolOptions</span>().setMaxSize(<span class=\"hljs-number\">5</span>);\n\n<span class=\"hljs-comment\">// Create the pool from the data object</span>\n<span class=\"hljs-type\">MySQLPool</span> <span class=\"hljs-variable\">pool</span> <span class=\"hljs-operator\">=</span> MySQLPool.pool(vertx, connectOptions, poolOptions);\n\npool.getConnection(ar -&gt; {\n  <span class=\"hljs-comment\">// Handling your connection</span>\n});</code></pre>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"_collations_and_character_sets\"><a class=\"anchor\" href=\"#_collations_and_character_sets\"></a>collations and character sets</h4>\n<div class=\"paragraph\">\n<p>The Reactive MySQL client supports configuring collations or character sets and map them to a correlative <code>java.nio.charset.Charset</code>.\nFor example, you can specify charset for a connection like</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">MySQLConnectOptions</span> <span class=\"hljs-variable\">connectOptions</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MySQLConnectOptions</span>();\n\n<span class=\"hljs-comment\">// set connection character set to utf8 instead of the default charset utf8mb4</span>\nconnectOptions.setCharset(<span class=\"hljs-string\">&quot;utf8&quot;</span>);</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>The Reactive MySQL Client will take <code>utf8mb4</code> as the default charset. String values like password and error messages are always decoded in <code>UTF-8</code> charset.</p>\n</div>\n<div class=\"paragraph\">\n<p><code>characterEncoding</code> option is used to determine which Java charset will be used to encode String values such as query string and parameter values, the charset is <code>UTF-8</code> by default and if it&#8217;s set to <code>null</code> then the client will use the default Java charset instead.</p>\n</div>\n<div class=\"paragraph\">\n<p>You can also specify collation for a connection like</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">MySQLConnectOptions</span> <span class=\"hljs-variable\">connectOptions</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MySQLConnectOptions</span>();\n\n<span class=\"hljs-comment\">// set connection collation to utf8_general_ci instead of the default collation utf8mb4_general_ci</span>\n<span class=\"hljs-comment\">// setting a collation will override the charset option</span>\nconnectOptions.setCharset(<span class=\"hljs-string\">&quot;gbk&quot;</span>);\nconnectOptions.setCollation(<span class=\"hljs-string\">&quot;utf8_general_ci&quot;</span>);</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Note setting a collation on the data object will override the <strong>charset</strong> and <strong>characterEncoding</strong> option.</p>\n</div>\n<div class=\"paragraph\">\n<p>You can execute SQL <code>SHOW COLLATION;</code> or <code>SHOW CHARACTER SET;</code> to get the supported collations and charsets by the server.</p>\n</div>\n<div class=\"paragraph\">\n<p>More information about MySQL charsets and collations can be found in the <a href=\"https://dev.mysql.com/doc/refman/8.0/en/charset.html\">MySQL Reference Manual</a>.</p>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"_connection_attributes\"><a class=\"anchor\" href=\"#_connection_attributes\"></a>connection attributes</h4>\n<div class=\"paragraph\">\n<p>You can also configure the connection attributes with the <code>setProperties</code> or <code>addProperty</code> methods. Note <code>setProperties</code> will override the default client properties.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">MySQLConnectOptions</span> <span class=\"hljs-variable\">connectOptions</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MySQLConnectOptions</span>();\n\n<span class=\"hljs-comment\">// Add a connection attribute</span>\nconnectOptions.addProperty(<span class=\"hljs-string\">&quot;_java_version&quot;</span>, <span class=\"hljs-string\">&quot;1.8.0_212&quot;</span>);\n\n<span class=\"hljs-comment\">// Override the attributes</span>\nMap&lt;String, String&gt; attributes = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">HashMap</span>&lt;&gt;();\nattributes.put(<span class=\"hljs-string\">&quot;_client_name&quot;</span>, <span class=\"hljs-string\">&quot;myapp&quot;</span>);\nattributes.put(<span class=\"hljs-string\">&quot;_client_version&quot;</span>, <span class=\"hljs-string\">&quot;1.0.0&quot;</span>);\nconnectOptions.setProperties(attributes);</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>More information about client connection attributes can be found in the <a href=\"https://dev.mysql.com/doc/refman/8.0/en/performance-schema-connection-attribute-tables.html\">MySQL Reference Manual</a>.</p>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"_useaffectedrows\"><a class=\"anchor\" href=\"#_useaffectedrows\"></a>useAffectedRows</h4>\n<div class=\"paragraph\">\n<p>You can configure the <code>useAffectedRows</code> option to decide whether to set <code>CLIENT_FOUND_ROWS</code> flag when connecting to the server. If the <code>CLIENT_FOUND_ROWS</code> flag is specified then the affected rows count is the numeric value of rows found rather than affected.</p>\n</div>\n<div class=\"paragraph\">\n<p>More information about this can be found in the <a href=\"https://dev.mysql.com/doc/refman/8.0/en/mysql-affected-rows.html\">MySQL Reference Manual</a></p>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_connection_uri\"><a class=\"anchor\" href=\"#_connection_uri\"></a>connection URI</h3>\n<div class=\"paragraph\">\n<p>Apart from configuring with a <code>MySQLConnectOptions</code> data object, We also provide you an alternative way to connect when you want to configure with a connection URI:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">connectionUri</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;mysql://dbuser:secretpassword@database.server.com:3211/mydb&quot;</span>;\n\n<span class=\"hljs-comment\">// Create the pool from the connection URI</span>\n<span class=\"hljs-type\">MySQLPool</span> <span class=\"hljs-variable\">pool</span> <span class=\"hljs-operator\">=</span> MySQLPool.pool(connectionUri);\n\n<span class=\"hljs-comment\">// Create the connection from the connection URI</span>\nMySQLConnection.connect(vertx, connectionUri, res -&gt; {\n  <span class=\"hljs-comment\">// Handling your connection</span>\n});</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>More information about connection string formats can be found in the <a href=\"https://dev.mysql.com/doc/refman/8.0/en/connecting-using-uri-or-key-value-pairs.html#connecting-using-uri\">MySQL Reference Manual</a>.</p>\n</div>\n<div class=\"paragraph\">\n<p>Currently, the client supports the following parameter keywords in connection uri (keys are case-insensitive):</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>host</p>\n</li>\n<li>\n<p>port</p>\n</li>\n<li>\n<p>user</p>\n</li>\n<li>\n<p>password</p>\n</li>\n<li>\n<p>schema</p>\n</li>\n<li>\n<p>socket</p>\n</li>\n<li>\n<p>useAffectedRows</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_connect_retries\"><a class=\"anchor\" href=\"#_connect_retries\"></a>Connect retries</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>You can configure the client to retry when a connection fails to be established.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">options\n  .setReconnectAttempts(<span class=\"hljs-number\">2</span>)\n  .setReconnectInterval(<span class=\"hljs-number\">1000</span>);</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_running_queries\"><a class=\"anchor\" href=\"#_running_queries\"></a>Running queries</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>When you don&#8217;t need a transaction or run single queries, you can run queries directly on the pool; the pool\nwill use one of its connection to run the query and return the result to you.</p>\n</div>\n<div class=\"paragraph\">\n<p>Here is how to run simple queries:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">client\n  .query(<span class=\"hljs-string\">&quot;SELECT * FROM users WHERE id=&#x27;julien&#x27;&quot;</span>)\n  .execute(ar -&gt; {\n  <span class=\"hljs-keyword\">if</span> (ar.succeeded()) {\n    RowSet&lt;Row&gt; result = ar.result();\n    System.out.println(<span class=\"hljs-string\">&quot;Got &quot;</span> + result.size() + <span class=\"hljs-string\">&quot; rows &quot;</span>);\n  } <span class=\"hljs-keyword\">else</span> {\n    System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar.cause().getMessage());\n  }\n});</code></pre>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_prepared_queries\"><a class=\"anchor\" href=\"#_prepared_queries\"></a>Prepared queries</h3>\n<div class=\"paragraph\">\n<p>You can do the same with prepared queries.</p>\n</div>\n<div class=\"paragraph\">\n<p>The SQL string can refer to parameters by position, using the database syntax `?`</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">client\n  .preparedQuery(<span class=\"hljs-string\">&quot;SELECT * FROM users WHERE id=?&quot;</span>)\n  .execute(Tuple.of(<span class=\"hljs-string\">&quot;julien&quot;</span>), ar -&gt; {\n  <span class=\"hljs-keyword\">if</span> (ar.succeeded()) {\n    RowSet&lt;Row&gt; rows = ar.result();\n    System.out.println(<span class=\"hljs-string\">&quot;Got &quot;</span> + rows.size() + <span class=\"hljs-string\">&quot; rows &quot;</span>);\n  } <span class=\"hljs-keyword\">else</span> {\n    System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar.cause().getMessage());\n  }\n});</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Query methods provides an asynchronous <code><a href=\"../../apidocs/io/vertx/sqlclient/RowSet.html\">RowSet</a></code> instance that works for <em>SELECT</em> queries</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">client\n  .preparedQuery(<span class=\"hljs-string\">&quot;SELECT first_name, last_name FROM users&quot;</span>)\n  .execute(ar -&gt; {\n  <span class=\"hljs-keyword\">if</span> (ar.succeeded()) {\n    RowSet&lt;Row&gt; rows = ar.result();\n    <span class=\"hljs-keyword\">for</span> (Row row : rows) {\n      System.out.println(<span class=\"hljs-string\">&quot;User &quot;</span> + row.getString(<span class=\"hljs-number\">0</span>) + <span class=\"hljs-string\">&quot; &quot;</span> + row.getString(<span class=\"hljs-number\">1</span>));\n    }\n  } <span class=\"hljs-keyword\">else</span> {\n    System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar.cause().getMessage());\n  }\n});</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>or <em>UPDATE</em>/<em>INSERT</em> queries:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">client\n  .preparedQuery(<span class=\"hljs-string\">&quot;INSERT INTO users (first_name, last_name) VALUES (?, ?)&quot;</span>)\n  .execute(Tuple.of(<span class=\"hljs-string\">&quot;Julien&quot;</span>, <span class=\"hljs-string\">&quot;Viet&quot;</span>), ar -&gt; {\n  <span class=\"hljs-keyword\">if</span> (ar.succeeded()) {\n    RowSet&lt;Row&gt; rows = ar.result();\n    System.out.println(rows.rowCount());\n  } <span class=\"hljs-keyword\">else</span> {\n    System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar.cause().getMessage());\n  }\n});</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>The <code><a href=\"../../apidocs/io/vertx/sqlclient/Row.html\">Row</a></code> gives you access to your data by index</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">System.out.println(<span class=\"hljs-string\">&quot;User &quot;</span> + row.getString(<span class=\"hljs-number\">0</span>) + <span class=\"hljs-string\">&quot; &quot;</span> + row.getString(<span class=\"hljs-number\">1</span>));</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>or by name</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">System.out.println(<span class=\"hljs-string\">&quot;User &quot;</span> + row.getString(<span class=\"hljs-string\">&quot;first_name&quot;</span>) + <span class=\"hljs-string\">&quot; &quot;</span> + row.getString(<span class=\"hljs-string\">&quot;last_name&quot;</span>));</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>The client will not do any magic here and the column name is identified with the name in the table regardless of how your SQL text is.</p>\n</div>\n<div class=\"paragraph\">\n<p>You can access a wide variety of of types</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">firstName</span> <span class=\"hljs-operator\">=</span> row.getString(<span class=\"hljs-string\">&quot;first_name&quot;</span>);\n<span class=\"hljs-type\">Boolean</span> <span class=\"hljs-variable\">male</span> <span class=\"hljs-operator\">=</span> row.getBoolean(<span class=\"hljs-string\">&quot;male&quot;</span>);\n<span class=\"hljs-type\">Integer</span> <span class=\"hljs-variable\">age</span> <span class=\"hljs-operator\">=</span> row.getInteger(<span class=\"hljs-string\">&quot;age&quot;</span>);</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>You can use cached prepared statements to execute one-shot prepared queries:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">connectOptions.setCachePreparedStatements(<span class=\"hljs-literal\">true</span>);\nclient\n  .preparedQuery(<span class=\"hljs-string\">&quot;SELECT * FROM users WHERE id = ?&quot;</span>)\n  .execute(Tuple.of(<span class=\"hljs-string\">&quot;julien&quot;</span>), ar -&gt; {\n    <span class=\"hljs-keyword\">if</span> (ar.succeeded()) {\n      RowSet&lt;Row&gt; rows = ar.result();\n      System.out.println(<span class=\"hljs-string\">&quot;Got &quot;</span> + rows.size() + <span class=\"hljs-string\">&quot; rows &quot;</span>);\n    } <span class=\"hljs-keyword\">else</span> {\n      System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar.cause().getMessage());\n    }\n  });</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>You can create a <code>PreparedStatement</code> and manage the lifecycle by yourself.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">sqlConnection\n  .prepare(<span class=\"hljs-string\">&quot;SELECT * FROM users WHERE id = ?&quot;</span>, ar -&gt; {\n    <span class=\"hljs-keyword\">if</span> (ar.succeeded()) {\n      <span class=\"hljs-type\">PreparedStatement</span> <span class=\"hljs-variable\">preparedStatement</span> <span class=\"hljs-operator\">=</span> ar.result();\n      preparedStatement.query()\n        .execute(Tuple.of(<span class=\"hljs-string\">&quot;julien&quot;</span>), ar2 -&gt; {\n          <span class=\"hljs-keyword\">if</span> (ar2.succeeded()) {\n            RowSet&lt;Row&gt; rows = ar2.result();\n            System.out.println(<span class=\"hljs-string\">&quot;Got &quot;</span> + rows.size() + <span class=\"hljs-string\">&quot; rows &quot;</span>);\n            preparedStatement.close();\n          } <span class=\"hljs-keyword\">else</span> {\n            System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar2.cause().getMessage());\n          }\n        });\n    } <span class=\"hljs-keyword\">else</span> {\n      System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar.cause().getMessage());\n    }\n  });</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_batches\"><a class=\"anchor\" href=\"#_batches\"></a>Batches</h3>\n<div class=\"paragraph\">\n<p>You can execute prepared batch</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">List&lt;Tuple&gt; batch = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ArrayList</span>&lt;&gt;();\nbatch.add(Tuple.of(<span class=\"hljs-string\">&quot;julien&quot;</span>, <span class=\"hljs-string\">&quot;Julien Viet&quot;</span>));\nbatch.add(Tuple.of(<span class=\"hljs-string\">&quot;emad&quot;</span>, <span class=\"hljs-string\">&quot;Emad Alblueshi&quot;</span>));\n\n<span class=\"hljs-comment\">// Execute the prepared batch</span>\nclient\n  .preparedQuery(<span class=\"hljs-string\">&quot;INSERT INTO USERS (id, name) VALUES (?, ?)&quot;</span>)\n  .executeBatch(batch, res -&gt; {\n  <span class=\"hljs-keyword\">if</span> (res.succeeded()) {\n\n    <span class=\"hljs-comment\">// Process rows</span>\n    RowSet&lt;Row&gt; rows = res.result();\n  } <span class=\"hljs-keyword\">else</span> {\n    System.out.println(<span class=\"hljs-string\">&quot;Batch failed &quot;</span> + res.cause());\n  }\n});</code></pre>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_mysql_last_insert_id\"><a class=\"anchor\" href=\"#_mysql_last_insert_id\"></a>MySQL LAST_INSERT_ID</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>You can get the auto incremented value if you insert a record into the table.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">client\n  .query(<span class=\"hljs-string\">&quot;INSERT INTO test(val) VALUES (&#x27;v1&#x27;)&quot;</span>)\n  .execute(ar -&gt; {\n    <span class=\"hljs-keyword\">if</span> (ar.succeeded()) {\n      RowSet&lt;Row&gt; rows = ar.result();\n      <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">lastInsertId</span> <span class=\"hljs-operator\">=</span> rows.property(MySQLClient.LAST_INSERTED_ID);\n      System.out.println(<span class=\"hljs-string\">&quot;Last inserted id is: &quot;</span> + lastInsertId);\n    } <span class=\"hljs-keyword\">else</span> {\n      System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar.cause().getMessage());\n    }\n  });</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>More information can be found in <a href=\"https://dev.mysql.com/doc/refman/8.0/en/getting-unique-id.html\">How to Get the Unique ID for the Last Inserted Row</a>.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_using_connections\"><a class=\"anchor\" href=\"#_using_connections\"></a>Using connections</h2>\n<div class=\"sectionbody\">\n<div class=\"sect2\">\n<h3 id=\"_getting_a_connection\"><a class=\"anchor\" href=\"#_getting_a_connection\"></a>Getting a connection</h3>\n<div class=\"paragraph\">\n<p>When you need to execute sequential queries (without a transaction), you can create a new connection\nor borrow one from the pool. Remember that between acquiring the connection from the pool and returning it to the pool, you should take care of the connection because it might be closed by the server for some reason such as an idle time out.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">pool\n  .getConnection()\n  .compose(connection -&gt;\n    connection\n      .preparedQuery(<span class=\"hljs-string\">&quot;INSERT INTO Users (first_name,last_name) VALUES (?, ?)&quot;</span>)\n      .executeBatch(Arrays.asList(\n        Tuple.of(<span class=\"hljs-string\">&quot;Julien&quot;</span>, <span class=\"hljs-string\">&quot;Viet&quot;</span>),\n        Tuple.of(<span class=\"hljs-string\">&quot;Emad&quot;</span>, <span class=\"hljs-string\">&quot;Alblueshi&quot;</span>)\n      ))\n      .compose(res -&gt; connection\n        <span class=\"hljs-comment\">// Do something with rows</span>\n        .query(<span class=\"hljs-string\">&quot;SELECT COUNT(*) FROM Users&quot;</span>)\n        .execute()\n        .map(rows -&gt; rows.iterator().next().getInteger(<span class=\"hljs-number\">0</span>)))\n      <span class=\"hljs-comment\">// Return the connection to the pool</span>\n      .eventually(v -&gt; connection.close())\n  ).onSuccess(count -&gt; {\n  System.out.println(<span class=\"hljs-string\">&quot;Insert users, now the number of users is &quot;</span> + count);\n});</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Prepared queries can be created:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">connection\n  .prepare(<span class=\"hljs-string\">&quot;SELECT * FROM users WHERE first_name LIKE ?&quot;</span>)\n  .compose(pq -&gt;\n    pq.query()\n      .execute(Tuple.of(<span class=\"hljs-string\">&quot;Julien&quot;</span>))\n      .eventually(v -&gt; pq.close())\n  ).onSuccess(rows -&gt; {\n  <span class=\"hljs-comment\">// All rows</span>\n});</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_simplified_connection_api\"><a class=\"anchor\" href=\"#_simplified_connection_api\"></a>Simplified connection API</h3>\n<div class=\"paragraph\">\n<p>When you use a pool, you can call <code><a href=\"../../apidocs/io/vertx/sqlclient/Pool.html#withConnection-java.util.function.Function-io.vertx.core.Handler-\">withConnection</a></code> to pass it a function executed\nwithin a connection.</p>\n</div>\n<div class=\"paragraph\">\n<p>It borrows a connection from the pool and calls the function with this connection.</p>\n</div>\n<div class=\"paragraph\">\n<p>The function must return a future of an arbitrary result.</p>\n</div>\n<div class=\"paragraph\">\n<p>After the future completes, the connection is returned to the pool and the overall result is provided.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">pool.withConnection(connection -&gt;\n  connection\n    .preparedQuery(<span class=\"hljs-string\">&quot;INSERT INTO Users (first_name,last_name) VALUES (?, ?)&quot;</span>)\n    .executeBatch(Arrays.asList(\n      Tuple.of(<span class=\"hljs-string\">&quot;Julien&quot;</span>, <span class=\"hljs-string\">&quot;Viet&quot;</span>),\n      Tuple.of(<span class=\"hljs-string\">&quot;Emad&quot;</span>, <span class=\"hljs-string\">&quot;Alblueshi&quot;</span>)\n    ))\n    .compose(res -&gt; connection\n      <span class=\"hljs-comment\">// Do something with rows</span>\n      .query(<span class=\"hljs-string\">&quot;SELECT COUNT(*) FROM Users&quot;</span>)\n      .execute()\n      .map(rows -&gt; rows.iterator().next().getInteger(<span class=\"hljs-number\">0</span>)))\n).onSuccess(count -&gt; {\n  System.out.println(<span class=\"hljs-string\">&quot;Insert users, now the number of users is &quot;</span> + count);\n});</code></pre>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_using_transactions\"><a class=\"anchor\" href=\"#_using_transactions\"></a>Using transactions</h2>\n<div class=\"sectionbody\">\n<div class=\"sect2\">\n<h3 id=\"_transactions_with_connections\"><a class=\"anchor\" href=\"#_transactions_with_connections\"></a>Transactions with connections</h3>\n<div class=\"paragraph\">\n<p>You can execute transaction using SQL <code>BEGIN</code>/<code>COMMIT</code>/<code>ROLLBACK</code>, if you do so you must use\na <code><a href=\"../../apidocs/io/vertx/sqlclient/SqlConnection.html\">SqlConnection</a></code> and manage it yourself.</p>\n</div>\n<div class=\"paragraph\">\n<p>Or you can use the transaction API of <code><a href=\"../../apidocs/io/vertx/sqlclient/SqlConnection.html\">SqlConnection</a></code>:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">pool.getConnection()\n  <span class=\"hljs-comment\">// Transaction must use a connection</span>\n  .onSuccess(conn -&gt; {\n    <span class=\"hljs-comment\">// Begin the transaction</span>\n    conn.begin()\n      .compose(tx -&gt; conn\n        <span class=\"hljs-comment\">// Various statements</span>\n        .query(<span class=\"hljs-string\">&quot;INSERT INTO Users (first_name,last_name) VALUES (&#x27;Julien&#x27;,&#x27;Viet&#x27;)&quot;</span>)\n        .execute()\n        .compose(res2 -&gt; conn\n          .query(<span class=\"hljs-string\">&quot;INSERT INTO Users (first_name,last_name) VALUES (&#x27;Emad&#x27;,&#x27;Alblueshi&#x27;)&quot;</span>)\n          .execute())\n        <span class=\"hljs-comment\">// Commit the transaction</span>\n        .compose(res3 -&gt; tx.commit()))\n      <span class=\"hljs-comment\">// Return the connection to the pool</span>\n      .eventually(v -&gt; conn.close())\n      .onSuccess(v -&gt; System.out.println(<span class=\"hljs-string\">&quot;Transaction succeeded&quot;</span>))\n      .onFailure(err -&gt; System.out.println(<span class=\"hljs-string\">&quot;Transaction failed: &quot;</span> + err.getMessage()));\n  });</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>When the database server reports the current transaction is failed (e.g the infamous <em>current transaction is aborted, commands ignored until\nend of transaction block</em>), the transaction is rollbacked and the <code><a href=\"../../apidocs/io/vertx/sqlclient/Transaction.html#completion--\">completion</a></code> future\nis failed with a <code><a href=\"../../apidocs/io/vertx/sqlclient/TransactionRollbackException.html\">TransactionRollbackException</a></code>:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">tx.completion()\n  .onFailure(err -&gt; {\n    System.out.println(<span class=\"hljs-string\">&quot;Transaction failed =&gt; rolled back&quot;</span>);\n  });</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_simplified_transaction_api\"><a class=\"anchor\" href=\"#_simplified_transaction_api\"></a>Simplified transaction API</h3>\n<div class=\"paragraph\">\n<p>When you use a pool, you can call <code><a href=\"../../apidocs/io/vertx/sqlclient/Pool.html#withTransaction-java.util.function.Function-io.vertx.core.Handler-\">withTransaction</a></code> to pass it a function executed\nwithin a transaction.</p>\n</div>\n<div class=\"paragraph\">\n<p>It borrows a connection from the pool, begins the transaction and calls the function with a client executing all\noperations in the scope of this transaction.</p>\n</div>\n<div class=\"paragraph\">\n<p>The function must return a future of an arbitrary result:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>when the future succeeds the client will commit the transaction</p>\n</li>\n<li>\n<p>when the future fails the client will rollback the transaction</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>After the transaction completes, the connection is returned to the pool and the overall result is provided.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">pool.withTransaction(client -&gt; client\n  .query(<span class=\"hljs-string\">&quot;INSERT INTO Users (first_name,last_name) VALUES (&#x27;Julien&#x27;,&#x27;Viet&#x27;)&quot;</span>)\n  .execute()\n  .flatMap(res -&gt; client\n    .query(<span class=\"hljs-string\">&quot;INSERT INTO Users (first_name,last_name) VALUES (&#x27;Emad&#x27;,&#x27;Alblueshi&#x27;)&quot;</span>)\n    .execute()\n    <span class=\"hljs-comment\">// Map to a message result</span>\n    .map(<span class=\"hljs-string\">&quot;Users inserted&quot;</span>)))\n  .onSuccess(v -&gt; System.out.println(<span class=\"hljs-string\">&quot;Transaction succeeded&quot;</span>))\n  .onFailure(err -&gt; System.out.println(<span class=\"hljs-string\">&quot;Transaction failed: &quot;</span> + err.getMessage()));</code></pre>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_cursors_and_streaming\"><a class=\"anchor\" href=\"#_cursors_and_streaming\"></a>Cursors and streaming</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>By default prepared query execution fetches all rows, you can use a\n<code><a href=\"../../apidocs/io/vertx/sqlclient/Cursor.html\">Cursor</a></code> to control the amount of rows you want to read:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">connection.prepare(<span class=\"hljs-string\">&quot;SELECT * FROM users WHERE age &gt; ?&quot;</span>, ar1 -&gt; {\n  <span class=\"hljs-keyword\">if</span> (ar1.succeeded()) {\n    <span class=\"hljs-type\">PreparedStatement</span> <span class=\"hljs-variable\">pq</span> <span class=\"hljs-operator\">=</span> ar1.result();\n\n    <span class=\"hljs-comment\">// Create a cursor</span>\n    <span class=\"hljs-type\">Cursor</span> <span class=\"hljs-variable\">cursor</span> <span class=\"hljs-operator\">=</span> pq.cursor(Tuple.of(<span class=\"hljs-number\">18</span>));\n\n    <span class=\"hljs-comment\">// Read 50 rows</span>\n    cursor.read(<span class=\"hljs-number\">50</span>, ar2 -&gt; {\n      <span class=\"hljs-keyword\">if</span> (ar2.succeeded()) {\n        RowSet&lt;Row&gt; rows = ar2.result();\n\n        <span class=\"hljs-comment\">// Check for more ?</span>\n        <span class=\"hljs-keyword\">if</span> (cursor.hasMore()) {\n          <span class=\"hljs-comment\">// Repeat the process...</span>\n        } <span class=\"hljs-keyword\">else</span> {\n          <span class=\"hljs-comment\">// No more rows - close the cursor</span>\n          cursor.close();\n        }\n      }\n    });\n  }\n});</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Cursors shall be closed when they are released prematurely:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">cursor.read(<span class=\"hljs-number\">50</span>, ar2 -&gt; {\n  <span class=\"hljs-keyword\">if</span> (ar2.succeeded()) {\n    <span class=\"hljs-comment\">// Close the cursor</span>\n    cursor.close();\n  }\n});</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>A stream API is also available for cursors, which can be more convenient, specially with the Rxified version.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">connection.prepare(<span class=\"hljs-string\">&quot;SELECT * FROM users WHERE age &gt; ?&quot;</span>, ar1 -&gt; {\n  <span class=\"hljs-keyword\">if</span> (ar1.succeeded()) {\n    <span class=\"hljs-type\">PreparedStatement</span> <span class=\"hljs-variable\">pq</span> <span class=\"hljs-operator\">=</span> ar1.result();\n\n    <span class=\"hljs-comment\">// Fetch 50 rows at a time</span>\n    RowStream&lt;Row&gt; stream = pq.createStream(<span class=\"hljs-number\">50</span>, Tuple.of(<span class=\"hljs-number\">18</span>));\n\n    <span class=\"hljs-comment\">// Use the stream</span>\n    stream.exceptionHandler(err -&gt; {\n      System.out.println(<span class=\"hljs-string\">&quot;Error: &quot;</span> + err.getMessage());\n    });\n    stream.endHandler(v -&gt; {\n      System.out.println(<span class=\"hljs-string\">&quot;End of stream&quot;</span>);\n    });\n    stream.handler(row -&gt; {\n      System.out.println(<span class=\"hljs-string\">&quot;User: &quot;</span> + row.getString(<span class=\"hljs-string\">&quot;last_name&quot;</span>));\n    });\n  }\n});</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>The stream read the rows by batch of <code>50</code> and stream them, when the rows have been passed to the handler,\na new batch of <code>50</code> is read and so on.</p>\n</div>\n<div class=\"paragraph\">\n<p>The stream can be resumed or paused, the loaded rows will remain in memory until they are delivered and the cursor\nwill stop iterating.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_tracing_queries\"><a class=\"anchor\" href=\"#_tracing_queries\"></a>Tracing queries</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>The SQL client can trace query execution when Vert.x has tracing enabled.</p>\n</div>\n<div class=\"paragraph\">\n<p>The client reports the following <em>client</em> spans:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>Query</code> operation name</p>\n</li>\n<li>\n<p>tags</p>\n</li>\n<li>\n<p><code>db.user</code>: the database username</p>\n</li>\n<li>\n<p><code>db.instance</code>: the database instance</p>\n</li>\n<li>\n<p><code>db.statement</code>: the SQL query</p>\n</li>\n<li>\n<p><code>db.type</code>: <em>sql</em></p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>The default tracing policy is <code><a href=\"../../apidocs/io/vertx/core/tracing/TracingPolicy.html#PROPAGATE\">PROPAGATE</a></code>, the client\nwill only create a span when involved in an active trace.</p>\n</div>\n<div class=\"paragraph\">\n<p>You can change the client policy with <code><a href=\"../../apidocs/io/vertx/sqlclient/SqlConnectOptions.html#setTracingPolicy-io.vertx.core.tracing.TracingPolicy-\">setTracingPolicy</a></code>,\ne.g you can set <code><a href=\"../../apidocs/io/vertx/core/tracing/TracingPolicy.html#ALWAYS\">ALWAYS</a></code> to always report\na span:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">options.setTracingPolicy(TracingPolicy.ALWAYS);</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_mysql_type_mapping\"><a class=\"anchor\" href=\"#_mysql_type_mapping\"></a>MySQL type mapping</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Currently the client supports the following MySQL types</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>BOOL,BOOLEAN (<code>java.lang.Byte</code>)</p>\n</li>\n<li>\n<p>TINYINT (<code>java.lang.Byte</code>)</p>\n</li>\n<li>\n<p>TINYINT UNSIGNED(<code>java.lang.Short</code>)</p>\n</li>\n<li>\n<p>SMALLINT (<code>java.lang.Short</code>)</p>\n</li>\n<li>\n<p>SMALLINT UNSIGNED(<code>java.lang.Integer</code>)</p>\n</li>\n<li>\n<p>MEDIUMINT (<code>java.lang.Integer</code>)</p>\n</li>\n<li>\n<p>MEDIUMINT UNSIGNED(<code>java.lang.Integer</code>)</p>\n</li>\n<li>\n<p>INT,INTEGER (<code>java.lang.Integer</code>)</p>\n</li>\n<li>\n<p>INTEGER UNSIGNED(<code>java.lang.Long</code>)</p>\n</li>\n<li>\n<p>BIGINT (<code>java.lang.Long</code>)</p>\n</li>\n<li>\n<p>BIGINT UNSIGNED(<code>io.vertx.sqlclient.data.Numeric</code>)</p>\n</li>\n<li>\n<p>FLOAT (<code>java.lang.Float</code>)</p>\n</li>\n<li>\n<p>FLOAT UNSIGNED(<code>java.lang.Float</code>)</p>\n</li>\n<li>\n<p>DOUBLE (<code>java.lang.Double</code>)</p>\n</li>\n<li>\n<p>DOUBLE UNSIGNED(<code>java.lang.Double</code>)</p>\n</li>\n<li>\n<p>BIT (<code>java.lang.Long</code>)</p>\n</li>\n<li>\n<p>NUMERIC (<code>io.vertx.sqlclient.data.Numeric</code>)</p>\n</li>\n<li>\n<p>NUMERIC UNSIGNED(<code>io.vertx.sqlclient.data.Numeric</code>)</p>\n</li>\n<li>\n<p>DATE (<code>java.time.LocalDate</code>)</p>\n</li>\n<li>\n<p>DATETIME (<code>java.time.LocalDateTime</code>)</p>\n</li>\n<li>\n<p>TIME (<code>java.time.Duration</code>)</p>\n</li>\n<li>\n<p>TIMESTAMP (<code>java.time.LocalDateTime</code>)</p>\n</li>\n<li>\n<p>YEAR (<code>java.lang.Short</code>)</p>\n</li>\n<li>\n<p>CHAR (<code>java.lang.String</code>)</p>\n</li>\n<li>\n<p>VARCHAR (<code>java.lang.String</code>)</p>\n</li>\n<li>\n<p>BINARY (<code>io.vertx.core.buffer.Buffer</code>)</p>\n</li>\n<li>\n<p>VARBINARY (<code>io.vertx.core.buffer.Buffer</code>)</p>\n</li>\n<li>\n<p>TINYBLOB (<code>io.vertx.core.buffer.Buffer</code>)</p>\n</li>\n<li>\n<p>TINYTEXT (<code>java.lang.String</code>)</p>\n</li>\n<li>\n<p>BLOB (<code>io.vertx.core.buffer.Buffer</code>)</p>\n</li>\n<li>\n<p>TEXT (<code>java.lang.String</code>)</p>\n</li>\n<li>\n<p>MEDIUMBLOB (<code>io.vertx.core.buffer.Buffer</code>)</p>\n</li>\n<li>\n<p>MEDIUMTEXT (<code>java.lang.String</code>)</p>\n</li>\n<li>\n<p>LONGBLOB (<code>io.vertx.core.buffer.Buffer</code>)</p>\n</li>\n<li>\n<p>LONGTEXT (<code>java.lang.String</code>)</p>\n</li>\n<li>\n<p>ENUM (<code>java.lang.String</code>)</p>\n</li>\n<li>\n<p>SET (<code>java.lang.String</code>)</p>\n</li>\n<li>\n<p>JSON (<code>io.vertx.core.json.JsonObject</code>, <code>io.vertx.core.json.JsonArray</code>, <code>Number</code>, <code>Boolean</code>, <code>String</code>, <code>io.vertx.sqlclient.Tuple#JSON_NULL</code>)</p>\n</li>\n<li>\n<p>GEOMETRY(<code>io.vertx.mysqlclient.data.spatial.*</code>)</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>Tuple decoding uses the above types when storing values</p>\n</div>\n<div class=\"paragraph\">\n<p>Note: In Java there is no specific representations for unsigned numeric values, so this client will convert an unsigned value to the correlated Java type.</p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_implicit_type_conversion\"><a class=\"anchor\" href=\"#_implicit_type_conversion\"></a>Implicit type conversion</h3>\n<div class=\"paragraph\">\n<p>The Reactive MySQL Client supports implicit type conversions when executing a prepared statement.\nSuppose you have a <code>TIME</code> column in your table, the two examples below will both work here.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">client\n  .preparedQuery(<span class=\"hljs-string\">&quot;SELECT * FROM students WHERE updated_time = ?&quot;</span>)\n  .execute(Tuple.of(LocalTime.of(<span class=\"hljs-number\">19</span>, <span class=\"hljs-number\">10</span>, <span class=\"hljs-number\">25</span>)), ar -&gt; {\n  <span class=\"hljs-comment\">// handle the results</span>\n});\n<span class=\"hljs-comment\">// this will also work with implicit type conversion</span>\nclient\n  .preparedQuery(<span class=\"hljs-string\">&quot;SELECT * FROM students WHERE updated_time = ?&quot;</span>)\n  .execute(Tuple.of(<span class=\"hljs-string\">&quot;19:10:25&quot;</span>), ar -&gt; {\n  <span class=\"hljs-comment\">// handle the results</span>\n});</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>The MySQL data type for encoding will be inferred from the parameter values and here is the type mapping</p>\n</div>\n<table class=\"tableblock frame-all grid-all stretch\">\n<colgroup>\n<col style=\"width: 50%;\">\n<col style=\"width: 50%;\">\n</colgroup>\n<thead>\n<tr>\n<th class=\"tableblock halign-left valign-top\">Parameter value type</th>\n<th class=\"tableblock halign-left valign-top\">encoding MySQL type</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">null</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">MYSQL_TYPE_NULL</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">java.lang.Byte</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">MYSQL_TYPE_TINY</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">java.lang.Boolean</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">MYSQL_TYPE_TINY</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">java.lang.Short</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">MYSQL_TYPE_SHORT</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">java.lang.Integer</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">MYSQL_TYPE_LONG</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">java.lang.Long</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">MYSQL_TYPE_LONGLONG</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">java.lang.Double</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">MYSQL_TYPE_DOUBLE</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">java.lang.Float</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">MYSQL_TYPE_FLOAT</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">java.time.LocalDate</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">MYSQL_TYPE_DATE</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">java.time.Duration</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">MYSQL_TYPE_TIME</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">java.time.LocalTime</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">MYSQL_TYPE_TIME</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">io.vertx.core.buffer.Buffer</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">MYSQL_TYPE_BLOB</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">java.time.LocalDateTime</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">MYSQL_TYPE_DATETIME</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">io.vertx.mysqlclient.data.spatial.*</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">MYSQL_TYPE_BLOB</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">default</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">MYSQL_TYPE_STRING</p></td>\n</tr>\n</tbody>\n</table>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_handling_boolean\"><a class=\"anchor\" href=\"#_handling_boolean\"></a>Handling BOOLEAN</h3>\n<div class=\"paragraph\">\n<p>In MySQL <code>BOOLEAN</code> and <code>BOOL</code> data types are synonyms for <code>TINYINT(1)</code>. A value of zero is considered false, non-zero values are considered true.\nA <code>BOOLEAN</code> data type value is stored in <code>Row</code> or <code>Tuple</code> as <code>java.lang.Byte</code> type, you can call <code>Row#getValue</code> to retrieve it as a <code>java.lang.Byte</code> value,\nor you can call <code>Row#getBoolean</code> to retrieve it as <code>java.lang.Boolean</code> value.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">client\n  .query(<span class=\"hljs-string\">&quot;SELECT graduated FROM students WHERE id = 0&quot;</span>)\n  .execute(ar -&gt; {\n  <span class=\"hljs-keyword\">if</span> (ar.succeeded()) {\n    RowSet&lt;Row&gt; rowSet = ar.result();\n    <span class=\"hljs-keyword\">for</span> (Row row : rowSet) {\n      <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">pos</span> <span class=\"hljs-operator\">=</span> row.getColumnIndex(<span class=\"hljs-string\">&quot;graduated&quot;</span>);\n      <span class=\"hljs-type\">Byte</span> <span class=\"hljs-variable\">value</span> <span class=\"hljs-operator\">=</span> row.get(Byte.class, pos);\n      <span class=\"hljs-type\">Boolean</span> <span class=\"hljs-variable\">graduated</span> <span class=\"hljs-operator\">=</span> row.getBoolean(<span class=\"hljs-string\">&quot;graduated&quot;</span>);\n    }\n  } <span class=\"hljs-keyword\">else</span> {\n    System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar.cause().getMessage());\n  }\n});</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>When you want to execute a prepared statement with a param of a <code>BOOLEAN</code> value, you can simply add the <code>java.lang.Boolean</code> value to the params list.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">client\n  .preparedQuery(<span class=\"hljs-string\">&quot;UPDATE students SET graduated = ? WHERE id = 0&quot;</span>)\n  .execute(Tuple.of(<span class=\"hljs-literal\">true</span>), ar -&gt; {\n  <span class=\"hljs-keyword\">if</span> (ar.succeeded()) {\n    System.out.println(<span class=\"hljs-string\">&quot;Updated with the boolean value&quot;</span>);\n  } <span class=\"hljs-keyword\">else</span> {\n    System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar.cause().getMessage());\n  }\n});</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_handling_json\"><a class=\"anchor\" href=\"#_handling_json\"></a>Handling JSON</h3>\n<div class=\"paragraph\">\n<p>MySQL <code>JSON</code> data type is represented by the following Java types:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>String</code></p>\n</li>\n<li>\n<p><code>Number</code></p>\n</li>\n<li>\n<p><code>Boolean</code></p>\n</li>\n<li>\n<p><code>io.vertx.core.json.JsonObject</code></p>\n</li>\n<li>\n<p><code>io.vertx.core.json.JsonArray</code></p>\n</li>\n<li>\n<p><code>io.vertx.sqlclient.Tuple#JSON_NULL</code> for representing the JSON null literal</p>\n</li>\n</ul>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">Tuple</span> <span class=\"hljs-variable\">tuple</span> <span class=\"hljs-operator\">=</span> Tuple.of(\n  Tuple.JSON_NULL,\n  <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">JsonObject</span>().put(<span class=\"hljs-string\">&quot;foo&quot;</span>, <span class=\"hljs-string\">&quot;bar&quot;</span>),\n  <span class=\"hljs-number\">3</span>);\n\n<span class=\"hljs-comment\">// Retrieving json</span>\n<span class=\"hljs-type\">Object</span> <span class=\"hljs-variable\">value</span> <span class=\"hljs-operator\">=</span> tuple.getValue(<span class=\"hljs-number\">0</span>); <span class=\"hljs-comment\">// Expect JSON_NULL</span>\n\n<span class=\"hljs-comment\">//</span>\nvalue = tuple.get(JsonObject.class, <span class=\"hljs-number\">1</span>); <span class=\"hljs-comment\">// Expect JSON object</span>\n\n<span class=\"hljs-comment\">//</span>\nvalue = tuple.get(Integer.class, <span class=\"hljs-number\">2</span>); <span class=\"hljs-comment\">// Expect 3</span>\nvalue = tuple.getInteger(<span class=\"hljs-number\">2</span>); <span class=\"hljs-comment\">// Expect 3</span></code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_handling_bit\"><a class=\"anchor\" href=\"#_handling_bit\"></a>Handling BIT</h3>\n<div class=\"paragraph\">\n<p>The <code>BIT</code> data type is mapped to <code>java.lang.Long</code> type, but Java has no notion of unsigned numeric values, so if you want to insert or update a record with the max value of <code>BIT(64)</code>, you can do some tricks setting the parameter to <code>-1L</code>.</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_handling_time\"><a class=\"anchor\" href=\"#_handling_time\"></a>Handling TIME</h3>\n<div class=\"paragraph\">\n<p>MySQL <code>TIME</code> data type can be used to represent either time of a day or a time interval which ranges from <code>-838:59:59</code> to <code>838:59:59</code>. In Reactive MySQL client the <code>TIME</code> data type is mapped to <code>java.time.Duration</code> natively, but you can also retrieve it as a <code>java.time.LocalTime</code> via <code>Row#getLocalTime</code> accessor.</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_handling_numeric\"><a class=\"anchor\" href=\"#_handling_numeric\"></a>Handling NUMERIC</h3>\n<div class=\"paragraph\">\n<p>The <code><a href=\"../../apidocs/io/vertx/sqlclient/data/Numeric.html\">Numeric</a></code> Java type is used to represent the MySQL <code>NUMERIC</code> type.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">Numeric</span> <span class=\"hljs-variable\">numeric</span> <span class=\"hljs-operator\">=</span> row.get(Numeric.class, <span class=\"hljs-number\">0</span>);\n<span class=\"hljs-keyword\">if</span> (numeric.isNaN()) {\n  <span class=\"hljs-comment\">// Handle NaN</span>\n} <span class=\"hljs-keyword\">else</span> {\n  <span class=\"hljs-type\">BigDecimal</span> <span class=\"hljs-variable\">value</span> <span class=\"hljs-operator\">=</span> numeric.bigDecimalValue();\n}</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_handling_enum\"><a class=\"anchor\" href=\"#_handling_enum\"></a>Handling ENUM</h3>\n<div class=\"paragraph\">\n<p>MySQL supports ENUM data type and the client retrieves these types as String data type.</p>\n</div>\n<div class=\"paragraph\">\n<p>You can encode Java enums as String like this:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">client\n  .preparedQuery(<span class=\"hljs-string\">&quot;INSERT INTO colors VALUES (?)&quot;</span>)\n  .execute(Tuple.of(Color.red),  res -&gt; {\n    <span class=\"hljs-comment\">// ...</span>\n  });</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>You can retrieve the ENUM column as Java enums like this:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">client\n  .preparedQuery(<span class=\"hljs-string\">&quot;SELECT color FROM colors&quot;</span>)\n  .execute()\n  .onComplete(res -&gt; {\n  <span class=\"hljs-keyword\">if</span> (res.succeeded()) {\n    RowSet&lt;Row&gt; rows = res.result();\n    <span class=\"hljs-keyword\">for</span> (Row row : rows) {\n      System.out.println(row.get(Color.class, <span class=\"hljs-string\">&quot;color&quot;</span>));\n    }\n  }\n});</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_handling_geometry\"><a class=\"anchor\" href=\"#_handling_geometry\"></a>Handling GEOMETRY</h3>\n<div class=\"paragraph\">\n<p>MYSQL <code>GEOMETRY</code> data type is also supported, Here are some examples showing that you can handle the geometry data in Well-Known Text (WKT) format or Well-Known Binary (WKB) format, the data are decoded as MySQL TEXT OR BLOB data type. There are many great third-party libraries for handling data in this format.</p>\n</div>\n<div class=\"paragraph\">\n<p>You can fetch spatial data in WKT format:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">client\n  .query(<span class=\"hljs-string\">&quot;SELECT ST_AsText(g) FROM geom;&quot;</span>)\n  .execute(ar -&gt; {\n  <span class=\"hljs-keyword\">if</span> (ar.succeeded()) {\n    <span class=\"hljs-comment\">// Fetch the spatial data in WKT format</span>\n    RowSet&lt;Row&gt; result = ar.result();\n    <span class=\"hljs-keyword\">for</span> (Row row : result) {\n      <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">wktString</span> <span class=\"hljs-operator\">=</span> row.getString(<span class=\"hljs-number\">0</span>);\n    }\n  } <span class=\"hljs-keyword\">else</span> {\n    System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar.cause().getMessage());\n  }\n});</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Or you can fetch spatial data in WKB format:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">client\n  .query(<span class=\"hljs-string\">&quot;SELECT ST_AsBinary(g) FROM geom;&quot;</span>)\n  .execute(ar -&gt; {\n  <span class=\"hljs-keyword\">if</span> (ar.succeeded()) {\n    <span class=\"hljs-comment\">// Fetch the spatial data in WKB format</span>\n    RowSet&lt;Row&gt; result = ar.result();\n    <span class=\"hljs-keyword\">for</span> (Row row : result) {\n      <span class=\"hljs-type\">Buffer</span> <span class=\"hljs-variable\">wkbValue</span> <span class=\"hljs-operator\">=</span> row.getBuffer(<span class=\"hljs-number\">0</span>);\n    }\n  } <span class=\"hljs-keyword\">else</span> {\n    System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar.cause().getMessage());\n  }\n});</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>We also provide you a simple way to handle the geometry data type in Reactive MySQL Client.</p>\n</div>\n<div class=\"paragraph\">\n<p>You can retrieve the geometry data as Vert.x Data Object:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">client\n  .query(<span class=\"hljs-string\">&quot;SELECT g FROM geom;&quot;</span>)\n  .execute(ar -&gt; {\n  <span class=\"hljs-keyword\">if</span> (ar.succeeded()) {\n    <span class=\"hljs-comment\">// Fetch the spatial data as a Vert.x Data Object</span>\n    RowSet&lt;Row&gt; result = ar.result();\n    <span class=\"hljs-keyword\">for</span> (Row row : result) {\n      <span class=\"hljs-type\">Point</span> <span class=\"hljs-variable\">point</span> <span class=\"hljs-operator\">=</span> row.get(Point.class, <span class=\"hljs-number\">0</span>);\n      System.out.println(<span class=\"hljs-string\">&quot;Point x: &quot;</span> + point.getX());\n      System.out.println(<span class=\"hljs-string\">&quot;Point y: &quot;</span> + point.getY());\n    }\n  } <span class=\"hljs-keyword\">else</span> {\n    System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar.cause().getMessage());\n  }\n});</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>You can also take it as a prepared statement parameter in a WKB representation.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">Point</span> <span class=\"hljs-variable\">point</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Point</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1.5</span>, <span class=\"hljs-number\">1.5</span>);\n<span class=\"hljs-comment\">// Send as a WKB representation</span>\nclient\n  .preparedQuery(<span class=\"hljs-string\">&quot;INSERT INTO geom VALUES (ST_GeomFromWKB(?))&quot;</span>)\n  .execute(Tuple.of(point), ar -&gt; {\n  <span class=\"hljs-keyword\">if</span> (ar.succeeded()) {\n    System.out.println(<span class=\"hljs-string\">&quot;Success&quot;</span>);\n  } <span class=\"hljs-keyword\">else</span> {\n    System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar.cause().getMessage());\n  }\n});</code></pre>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_collector_queries\"><a class=\"anchor\" href=\"#_collector_queries\"></a>Collector queries</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>You can use Java collectors with the query API:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">Collector&lt;Row, ?, Map&lt;Long, String&gt;&gt; collector = Collectors.toMap(\n  row -&gt; row.getLong(<span class=\"hljs-string\">&quot;id&quot;</span>),\n  row -&gt; row.getString(<span class=\"hljs-string\">&quot;last_name&quot;</span>));\n\n<span class=\"hljs-comment\">// Run the query with the collector</span>\nclient.query(<span class=\"hljs-string\">&quot;SELECT * FROM users&quot;</span>).collecting(collector).execute(ar -&gt; {\n    <span class=\"hljs-keyword\">if</span> (ar.succeeded()) {\n      SqlResult&lt;Map&lt;Long, String&gt;&gt; result = ar.result();\n\n      <span class=\"hljs-comment\">// Get the map created by the collector</span>\n      Map&lt;Long, String&gt; map = result.value();\n      System.out.println(<span class=\"hljs-string\">&quot;Got &quot;</span> + map);\n    } <span class=\"hljs-keyword\">else</span> {\n      System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar.cause().getMessage());\n    }\n  });</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>The collector processing must not keep a reference on the <code><a href=\"../../apidocs/io/vertx/sqlclient/Row.html\">Row</a></code> as\nthere is a single row used for processing the entire set.</p>\n</div>\n<div class=\"paragraph\">\n<p>The Java <code>Collectors</code> provides many interesting predefined collectors, for example you can\ncreate easily create a string directly from the row set:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">Collector&lt;Row, ?, String&gt; collector = Collectors.mapping(\n  row -&gt; row.getString(<span class=\"hljs-string\">&quot;last_name&quot;</span>),\n  Collectors.joining(<span class=\"hljs-string\">&quot;,&quot;</span>, <span class=\"hljs-string\">&quot;(&quot;</span>, <span class=\"hljs-string\">&quot;)&quot;</span>)\n);\n\n<span class=\"hljs-comment\">// Run the query with the collector</span>\nclient.query(<span class=\"hljs-string\">&quot;SELECT * FROM users&quot;</span>).collecting(collector).execute(ar -&gt; {\n    <span class=\"hljs-keyword\">if</span> (ar.succeeded()) {\n      SqlResult&lt;String&gt; result = ar.result();\n\n      <span class=\"hljs-comment\">// Get the string created by the collector</span>\n      <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">list</span> <span class=\"hljs-operator\">=</span> result.value();\n      System.out.println(<span class=\"hljs-string\">&quot;Got &quot;</span> + list);\n    } <span class=\"hljs-keyword\">else</span> {\n      System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar.cause().getMessage());\n    }\n  });</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_mysql_stored_procedure\"><a class=\"anchor\" href=\"#_mysql_stored_procedure\"></a>MySQL Stored Procedure</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>You can run stored procedures in queries. The result will be retrieved from the server following the <a href=\"https://dev.mysql.com/doc/dev/mysql-server/latest/page_protocol_command_phase_sp.html\">MySQL protocol</a> without any magic here.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">client.query(<span class=\"hljs-string\">&quot;CREATE PROCEDURE multi() BEGIN\\n&quot;</span> +\n  <span class=\"hljs-string\">&quot;  SELECT 1;\\n&quot;</span> +\n  <span class=\"hljs-string\">&quot;  SELECT 1;\\n&quot;</span> +\n  <span class=\"hljs-string\">&quot;  INSERT INTO ins VALUES (1);\\n&quot;</span> +\n  <span class=\"hljs-string\">&quot;  INSERT INTO ins VALUES (2);\\n&quot;</span> +\n  <span class=\"hljs-string\">&quot;END;&quot;</span>).execute(ar1 -&gt; {\n  <span class=\"hljs-keyword\">if</span> (ar1.succeeded()) {\n    <span class=\"hljs-comment\">// create stored procedure success</span>\n    client\n      .query(<span class=\"hljs-string\">&quot;CALL multi();&quot;</span>)\n      .execute(ar2 -&gt; {\n      <span class=\"hljs-keyword\">if</span> (ar2.succeeded()) {\n        <span class=\"hljs-comment\">// handle the result</span>\n        RowSet&lt;Row&gt; result1 = ar2.result();\n        <span class=\"hljs-type\">Row</span> <span class=\"hljs-variable\">row1</span> <span class=\"hljs-operator\">=</span> result1.iterator().next();\n        System.out.println(<span class=\"hljs-string\">&quot;First result: &quot;</span> + row1.getInteger(<span class=\"hljs-number\">0</span>));\n\n        RowSet&lt;Row&gt; result2 = result1.next();\n        <span class=\"hljs-type\">Row</span> <span class=\"hljs-variable\">row2</span> <span class=\"hljs-operator\">=</span> result2.iterator().next();\n        System.out.println(<span class=\"hljs-string\">&quot;Second result: &quot;</span> + row2.getInteger(<span class=\"hljs-number\">0</span>));\n\n        RowSet&lt;Row&gt; result3 = result2.next();\n        System.out.println(<span class=\"hljs-string\">&quot;Affected rows: &quot;</span> + result3.rowCount());\n      } <span class=\"hljs-keyword\">else</span> {\n        System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar2.cause().getMessage());\n      }\n    });\n  } <span class=\"hljs-keyword\">else</span> {\n    System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar1.cause().getMessage());\n  }\n});</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Note: Prepared statements binding OUT parameters is not supported for now.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_mysql_local_infile\"><a class=\"anchor\" href=\"#_mysql_local_infile\"></a>MySQL LOCAL INFILE</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>This client supports for handling the LOCAL INFILE Request, if you want to load data from a local file into the server, you can use query\n<code>LOAD DATA LOCAL INFILE '&lt;filename&gt;' INTO TABLE &lt;table&gt;;</code>. More information can be found in the <a href=\"https://dev.mysql.com/doc/refman/8.0/en/load-data.html\">MySQL Reference Manual</a>.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_authentication\"><a class=\"anchor\" href=\"#_authentication\"></a>Authentication</h2>\n<div class=\"sectionbody\">\n<div class=\"sect2\">\n<h3 id=\"_default_authentication_plugin\"><a class=\"anchor\" href=\"#_default_authentication_plugin\"></a>Default authentication plugin</h3>\n<div class=\"paragraph\">\n<p>This client supports for specifying the default authentication plugin to use at the connection start.\nCurrently the following plugins are supported:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>mysql_native_password</p>\n</li>\n<li>\n<p>caching_sha2_password</p>\n</li>\n<li>\n<p>mysql_clear_password</p>\n</li>\n</ul>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">MySQLConnectOptions</span> <span class=\"hljs-variable\">options</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MySQLConnectOptions</span>()\n  .setPort(<span class=\"hljs-number\">3306</span>)\n  .setHost(<span class=\"hljs-string\">&quot;the-host&quot;</span>)\n  .setDatabase(<span class=\"hljs-string\">&quot;the-db&quot;</span>)\n  .setUser(<span class=\"hljs-string\">&quot;user&quot;</span>)\n  .setPassword(<span class=\"hljs-string\">&quot;secret&quot;</span>)\n  .setAuthenticationPlugin(MySQLAuthenticationPlugin.MYSQL_NATIVE_PASSWORD); <span class=\"hljs-comment\">// set the default authentication plugin</span></code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_new_authentication_method_introduced_in_mysql_8\"><a class=\"anchor\" href=\"#_new_authentication_method_introduced_in_mysql_8\"></a>New authentication method introduced in MySQL 8</h3>\n<div class=\"paragraph\">\n<p>MySQL 8.0 introduces a new authentication method named <code>caching_sha2_password</code> and it&#8217;s the default one to authenticate.\nIn order to connect to the server using this new authentication method, you need either use a secure connection(i.e. enable TLS/SSL) or exchange the encrypted password using an RSA key pair to avoid leaks of password. The RSA key pair is automatically exchanged during the communication, but the server RSA public key may be hacked during the process since it&#8217;s transferred on a insecure connection.\nSo if you&#8217;re on a insecure connection and want to avoid the risk of exposing the server RSA public key, you can set the server RSA public key like this:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">MySQLConnectOptions</span> <span class=\"hljs-variable\">options1</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MySQLConnectOptions</span>()\n  .setPort(<span class=\"hljs-number\">3306</span>)\n  .setHost(<span class=\"hljs-string\">&quot;the-host&quot;</span>)\n  .setDatabase(<span class=\"hljs-string\">&quot;the-db&quot;</span>)\n  .setUser(<span class=\"hljs-string\">&quot;user&quot;</span>)\n  .setPassword(<span class=\"hljs-string\">&quot;secret&quot;</span>)\n  .setServerRsaPublicKeyPath(<span class=\"hljs-string\">&quot;tls/files/public_key.pem&quot;</span>); <span class=\"hljs-comment\">// configure with path of the public key</span>\n\n<span class=\"hljs-type\">MySQLConnectOptions</span> <span class=\"hljs-variable\">options2</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MySQLConnectOptions</span>()\n  .setPort(<span class=\"hljs-number\">3306</span>)\n  .setHost(<span class=\"hljs-string\">&quot;the-host&quot;</span>)\n  .setDatabase(<span class=\"hljs-string\">&quot;the-db&quot;</span>)\n  .setUser(<span class=\"hljs-string\">&quot;user&quot;</span>)\n  .setPassword(<span class=\"hljs-string\">&quot;secret&quot;</span>)\n  .setServerRsaPublicKeyValue(Buffer.buffer(<span class=\"hljs-string\">&quot;-----BEGIN PUBLIC KEY-----\\n&quot;</span> +\n    <span class=\"hljs-string\">&quot;MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA3yvG5s0qrV7jxVlp0sMj\\n&quot;</span> +\n    <span class=\"hljs-string\">&quot;xP0a6BuLKCMjb0o88hDsJ3xz7PpHNKazuEAfPxiRFVAV3edqfSiXoQw+lJf4haEG\\n&quot;</span> +\n    <span class=\"hljs-string\">&quot;HQe12Nfhs+UhcAeTKXRlZP/JNmI+BGoBduQ1rCId9bKYbXn4pvyS/a1ft7SwFkhx\\n&quot;</span> +\n    <span class=\"hljs-string\">&quot;aogCur7iIB0WUWvwkQ0fEj/Mlhw93lLVyx7hcGFq4FOAKFYr3A0xrHP1IdgnD8QZ\\n&quot;</span> +\n    <span class=\"hljs-string\">&quot;0fUbgGLWWLOossKrbUP5HWko1ghLPIbfmU6o890oj1ZWQewj1Rs9Er92/UDj/JXx\\n&quot;</span> +\n    <span class=\"hljs-string\">&quot;7ha1P+ZOgPBlV037KDQMS6cUh9vTablEHsMLhDZanymXzzjBkL+wH/b9cdL16LkQ\\n&quot;</span> +\n    <span class=\"hljs-string\">&quot;5QIDAQAB\\n&quot;</span> +\n    <span class=\"hljs-string\">&quot;-----END PUBLIC KEY-----\\n&quot;</span>)); <span class=\"hljs-comment\">// configure with buffer of the public key</span></code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>More information about the <code>caching_sha2_password</code> authentication method can be found in the <a href=\"https://dev.mysql.com/doc/refman/8.0/en/caching-sha2-pluggable-authentication.html\">MySQL Reference Manual</a>.</p>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_using_ssltls\"><a class=\"anchor\" href=\"#_using_ssltls\"></a>Using SSL/TLS</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>To configure the client to use SSL connection, you can configure the <code><a href=\"../../apidocs/io/vertx/mysqlclient/MySQLConnectOptions.html\">MySQLConnectOptions</a></code>\nlike a Vert.x <code>NetClient</code>.\nAll <a href=\"https://dev.mysql.com/doc/refman/8.0/en/connection-options.html#option_general_ssl-mode\">SSL modes</a> are supported and you are able to configure <code>sslmode</code>. The client is in <code>DISABLED</code> SSL mode by default.\n<code>ssl</code> parameter is kept as a mere shortcut for setting <code>sslmode</code>. <code>setSsl(true)</code> is equivalent to <code>setSslMode(VERIFY_CA)</code> and <code>setSsl(false)</code> is equivalent to <code>setSslMode(DISABLED)</code>.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">MySQLConnectOptions</span> <span class=\"hljs-variable\">options</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MySQLConnectOptions</span>()\n  .setPort(<span class=\"hljs-number\">3306</span>)\n  .setHost(<span class=\"hljs-string\">&quot;the-host&quot;</span>)\n  .setDatabase(<span class=\"hljs-string\">&quot;the-db&quot;</span>)\n  .setUser(<span class=\"hljs-string\">&quot;user&quot;</span>)\n  .setPassword(<span class=\"hljs-string\">&quot;secret&quot;</span>)\n  .setSslMode(SslMode.VERIFY_CA)\n  .setPemTrustOptions(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">PemTrustOptions</span>().addCertPath(<span class=\"hljs-string\">&quot;/path/to/cert.pem&quot;</span>));\n\nMySQLConnection.connect(vertx, options, res -&gt; {\n  <span class=\"hljs-keyword\">if</span> (res.succeeded()) {\n    <span class=\"hljs-comment\">// Connected with SSL</span>\n  } <span class=\"hljs-keyword\">else</span> {\n    System.out.println(<span class=\"hljs-string\">&quot;Could not connect &quot;</span> + res.cause());\n  }\n});</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>More information can be found in the <a href=\"http://vertx.io/docs/vertx-core/java/#ssl\">Vert.x documentation</a>.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_mysql_utility_command\"><a class=\"anchor\" href=\"#_mysql_utility_command\"></a>MySQL utility command</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Sometimes you want to use MySQL utility commands and we provide support for this.\nMore information can be found in the <a href=\"https://dev.mysql.com/doc/dev/mysql-server/latest/page_protocol_command_phase_utility.html\">MySQL utility commands</a>.</p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_com_ping\"><a class=\"anchor\" href=\"#_com_ping\"></a>COM_PING</h3>\n<div class=\"paragraph\">\n<p>You can use <code>COM_PING</code> command to check if the server is alive. The handler will be notified if the server responds to the PING, otherwise the handler will never be called.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">connection.ping(ar -&gt; {\n  System.out.println(<span class=\"hljs-string\">&quot;The server has responded to the PING&quot;</span>);\n});</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_com_reset_connection\"><a class=\"anchor\" href=\"#_com_reset_connection\"></a>COM_RESET_CONNECTION</h3>\n<div class=\"paragraph\">\n<p>You can reset the session state with <code>COM_RESET_CONNECTION</code> command, this will reset the connection state like:\n- user variables\n- temporary tables\n- prepared statements</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">connection.resetConnection(ar -&gt; {\n  <span class=\"hljs-keyword\">if</span> (ar.succeeded()) {\n    System.out.println(<span class=\"hljs-string\">&quot;Connection has been reset now&quot;</span>);\n  } <span class=\"hljs-keyword\">else</span> {\n    System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar.cause().getMessage());\n  }\n});</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_com_change_user\"><a class=\"anchor\" href=\"#_com_change_user\"></a>COM_CHANGE_USER</h3>\n<div class=\"paragraph\">\n<p>You can change the user of the current connection, this will perform a re-authentication and reset the connection state like <code>COM_RESET_CONNECTION</code>.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">MySQLAuthOptions</span> <span class=\"hljs-variable\">authenticationOptions</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MySQLAuthOptions</span>()\n  .setUser(<span class=\"hljs-string\">&quot;newuser&quot;</span>)\n  .setPassword(<span class=\"hljs-string\">&quot;newpassword&quot;</span>)\n  .setDatabase(<span class=\"hljs-string\">&quot;newdatabase&quot;</span>);\nconnection.changeUser(authenticationOptions, ar -&gt; {\n  <span class=\"hljs-keyword\">if</span> (ar.succeeded()) {\n    System.out.println(<span class=\"hljs-string\">&quot;User of current connection has been changed.&quot;</span>);\n  } <span class=\"hljs-keyword\">else</span> {\n    System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar.cause().getMessage());\n  }\n});</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_com_init_db\"><a class=\"anchor\" href=\"#_com_init_db\"></a>COM_INIT_DB</h3>\n<div class=\"paragraph\">\n<p>You can use <code>COM_INIT_DB</code> command to change the default schema of the connection.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">connection.specifySchema(<span class=\"hljs-string\">&quot;newschema&quot;</span>, ar -&gt; {\n  <span class=\"hljs-keyword\">if</span> (ar.succeeded()) {\n    System.out.println(<span class=\"hljs-string\">&quot;Default schema changed to newschema&quot;</span>);\n  } <span class=\"hljs-keyword\">else</span> {\n    System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar.cause().getMessage());\n  }\n});</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_com_statistics\"><a class=\"anchor\" href=\"#_com_statistics\"></a>COM_STATISTICS</h3>\n<div class=\"paragraph\">\n<p>You can use <code>COM_STATISTICS</code> command to get a human readable string of some internal status variables in MySQL server.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">connection.getInternalStatistics(ar -&gt; {\n  <span class=\"hljs-keyword\">if</span> (ar.succeeded()) {\n    System.out.println(<span class=\"hljs-string\">&quot;Statistics: &quot;</span> + ar.result());\n  } <span class=\"hljs-keyword\">else</span> {\n    System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar.cause().getMessage());\n  }\n});</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_com_debug\"><a class=\"anchor\" href=\"#_com_debug\"></a>COM_DEBUG</h3>\n<div class=\"paragraph\">\n<p>You can use <code>COM_DEBUG</code> command to dump debug info to the MySQL server&#8217;s STDOUT.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">connection.debug(ar -&gt; {\n  <span class=\"hljs-keyword\">if</span> (ar.succeeded()) {\n    System.out.println(<span class=\"hljs-string\">&quot;Debug info dumped to server&#x27;s STDOUT&quot;</span>);\n  } <span class=\"hljs-keyword\">else</span> {\n    System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar.cause().getMessage());\n  }\n});</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_com_set_option\"><a class=\"anchor\" href=\"#_com_set_option\"></a>COM_SET_OPTION</h3>\n<div class=\"paragraph\">\n<p>You can use <code>COM_SET_OPTION</code> command to set options for the current connection. Currently only <code>CLIENT_MULTI_STATEMENTS</code> can be set.</p>\n</div>\n<div class=\"paragraph\">\n<p>For example, you can disable <code>CLIENT_MULTI_STATEMENTS</code> with this command.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">connection.setOption(MySQLSetOption.MYSQL_OPTION_MULTI_STATEMENTS_OFF, ar -&gt; {\n  <span class=\"hljs-keyword\">if</span> (ar.succeeded()) {\n    System.out.println(<span class=\"hljs-string\">&quot;CLIENT_MULTI_STATEMENTS is off now&quot;</span>);\n  } <span class=\"hljs-keyword\">else</span> {\n    System.out.println(<span class=\"hljs-string\">&quot;Failure: &quot;</span> + ar.cause().getMessage());\n  }\n});</code></pre>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_mysql_and_mariadb_version_support_matrix\"><a class=\"anchor\" href=\"#_mysql_and_mariadb_version_support_matrix\"></a>MySQL and MariaDB version support matrix</h2>\n<div class=\"sectionbody\">\n<table class=\"tableblock frame-all grid-all stretch\">\n<colgroup>\n<col style=\"width: 25%;\">\n<col style=\"width: 25%;\">\n<col style=\"width: 25%;\">\n<col style=\"width: 25%;\">\n</colgroup>\n<thead>\n<tr>\n<th class=\"tableblock halign-center valign-top\" colspan=\"2\">MySQL</th>\n<th class=\"tableblock halign-center valign-top\" colspan=\"2\">MariaDB</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td class=\"tableblock halign-center valign-top\"><p class=\"tableblock\">Version</p></td>\n<td class=\"tableblock halign-center valign-top\"><p class=\"tableblock\">Supported</p></td>\n<td class=\"tableblock halign-center valign-top\"><p class=\"tableblock\">Version</p></td>\n<td class=\"tableblock halign-center valign-top\"><p class=\"tableblock\">Supported</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-center valign-top\"><p class=\"tableblock\"><code>5.5</code></p></td>\n<td class=\"tableblock halign-center valign-top\"><p class=\"tableblock\">&#10004;</p></td>\n<td class=\"tableblock halign-center valign-top\"><p class=\"tableblock\"><code>10.1</code></p></td>\n<td class=\"tableblock halign-center valign-top\"><p class=\"tableblock\">&#10004;</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-center valign-top\"><p class=\"tableblock\"><code>5.6</code></p></td>\n<td class=\"tableblock halign-center valign-top\"><p class=\"tableblock\">&#10004;</p></td>\n<td class=\"tableblock halign-center valign-top\"><p class=\"tableblock\"><code>10.2</code></p></td>\n<td class=\"tableblock halign-center valign-top\"><p class=\"tableblock\">&#10004;</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-center valign-top\"><p class=\"tableblock\"><code>5.7</code></p></td>\n<td class=\"tableblock halign-center valign-top\"><p class=\"tableblock\">&#10004;</p></td>\n<td class=\"tableblock halign-center valign-top\"><p class=\"tableblock\"><code>10.3</code></p></td>\n<td class=\"tableblock halign-center valign-top\"><p class=\"tableblock\">&#10004;</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-center valign-top\"><p class=\"tableblock\"><code>8.0</code></p></td>\n<td class=\"tableblock halign-center valign-top\"><p class=\"tableblock\">&#10004;</p></td>\n<td class=\"tableblock halign-center valign-top\"><p class=\"tableblock\"><code>10.4</code></p></td>\n<td class=\"tableblock halign-center valign-top\"><p class=\"tableblock\">&#10004;</p></td>\n</tr>\n</tbody>\n</table>\n<div class=\"paragraph\">\n<p>Known issues:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Reset connection utility command does not work in MySQL 5.5, 5.6 and MariaDB 10.1</p>\n</li>\n<li>\n<p>Change user utility command is not supported with MariaDB 10.2 and 10.3</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_pitfalls_good_practices\"><a class=\"anchor\" href=\"#_pitfalls_good_practices\"></a>Pitfalls &amp; Good Practices</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Here are some good practices for you to avoid common pitfalls when using the Reactive MySQL Client.</p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_prepared_statement_count_limit\"><a class=\"anchor\" href=\"#_prepared_statement_count_limit\"></a>prepared statement count limit</h3>\n<div class=\"paragraph\">\n<p>Sometimes you might meet the notorious error <code>Can&#8217;t create more than max_prepared_stmt_count statements (current value: 16382)</code>, this is because the server has reached the limit of total number of prepared statement.</p>\n</div>\n<div class=\"paragraph\">\n<p>You can adjust the server system variable <code>max_prepared_stmt_count</code> but it has an upper bound value so you can&#8217;t get rid of the error in this way.</p>\n</div>\n<div class=\"paragraph\">\n<p>The best way to alleviate this is enabling prepared statement caching, so the prepared statements with the same SQL string could be reused and the client does not have to create a brand new prepared statement for every request.\nThe prepared statement will be automatically closed after the statement is executed.\nIn this way the chances of reaching the limit could be greatly reduced though it could not be totally eliminated.</p>\n</div>\n<div class=\"paragraph\">\n<p>You can also manage the lifecycle of prepared statements manually by creating a <code>PreparedStatement</code> object via <code>SqlConnection#prepare</code> interface so that you can choose when to deallocate the statement handle, or even use the <a href=\"https://dev.mysql.com/doc/refman/8.0/en/sql-prepared-statements.html\">SQL syntax prepared statement</a>.</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_demystifying_prepared_batch\"><a class=\"anchor\" href=\"#_demystifying_prepared_batch\"></a>demystifying prepared batch</h3>\n<div class=\"paragraph\">\n<p>There is time when you want to batch insert data into the database, you can use <code>PreparedQuery#executeBatch</code> which provides a simple API to handle this.\nKeep in mind that MySQL does not natively support batching protocol so the API is only a sugar by executing the prepared statement one after another, which means more network round trips are required comparing to inserting multiple rows by executing one prepared statement with a list of values.</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_tricky_date_time_data_types\"><a class=\"anchor\" href=\"#_tricky_date_time_data_types\"></a>tricky DATE &amp; TIME data types</h3>\n<div class=\"paragraph\">\n<p>Handling MYSQL DATE and TIME data types especially with time zones is tricky therefore the Reactive MySQL Client does no magic transformation for those values.</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>MySQL DATETIME data type does not contain time zone info, so what you get is identical to what you set no matter what time zone is in the current session.</p>\n</li>\n<li>\n<p>MySQL TIMESTAMP data type contains time zone info, so when you set or get the value it&#8217;s always transformed by the server with the timezone set in the current session.</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_advanced_pool_configuration\"><a class=\"anchor\" href=\"#_advanced_pool_configuration\"></a>Advanced pool configuration</h2>\n<div class=\"sectionbody\">\n<div class=\"sect2\">\n<h3 id=\"_server_load_balancing\"><a class=\"anchor\" href=\"#_server_load_balancing\"></a>Server load balancing</h3>\n<div class=\"paragraph\">\n<p>You can configure the pool with a list of servers instead of a single server.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">MySQLPool</span> <span class=\"hljs-variable\">pool</span> <span class=\"hljs-operator\">=</span> MySQLPool.pool(Arrays.asList(server1, server2, server3), options);</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>The pool uses a round-robin load balancing when a connection is created to select different servers.</p>\n</div>\n<div class=\"admonitionblock note\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\">Note</div>\n</td>\n<td class=\"content\">\nthis provides load balancing when the connection is created and not when the connection is borrowed from the pool.\n</td>\n</tr>\n</table>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_pool_connection_initialization\"><a class=\"anchor\" href=\"#_pool_connection_initialization\"></a>Pool connection initialization</h3>\n<div class=\"paragraph\">\n<p>You can use the <code><a href=\"../../apidocs/io/vertx/sqlclient/Pool.html#connectHandler-io.vertx.core.Handler-\">connectHandler</a></code> to interact with a connection after it\nhas been created and before it is inserted in the pool.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">pool.connectHandler(conn -&gt; {\n  conn.query(sql).execute().onSuccess(res -&gt; {\n    <span class=\"hljs-comment\">// Release the connection to the pool, ready to be used by the application</span>\n    conn.close();\n  });\n});</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Once you are done with the connection, you should simply close it to signal the pool to use it.</p>\n</div>\n</div>\n</div>\n</div>","version":"4.2.7"},"__N_SSG":true}
{"pageProps":{"categories":["releases","guides","security","news"],"post":{"meta":{"title":"Eclipse Vert.x based Framework URL Shortener Backend","category":"guides","authors":[{"name":"Lazar Bulić","github_id":"pendula95"}],"summary":"We combine Vert.x with the serverless framework to write a microservice that runs on AWS Lambda."},"date":"2017-12-21","slug":"eclipse-vert-x-based-framework-url-shortener-backend","readingTime":{"text":"5 min read","minutes":4.65,"time":279000,"words":930},"content":{"compiledSource":"var l=Object.defineProperty,m=Object.defineProperties;var c=Object.getOwnPropertyDescriptors;var s=Object.getOwnPropertySymbols;var o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;var d=(e,t,a)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,r=(e,t)=>{for(var a in t||(t={}))o.call(t,a)&&d(e,a,t[a]);if(s)for(var a of s(t))i.call(t,a)&&d(e,a,t[a]);return e},p=(e,t)=>m(e,c(t));var h=(e,t)=>{var a={};for(var n in e)o.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&s)for(var n of s(e))t.indexOf(n)<0&&i.call(e,n)&&(a[n]=e[n]);return a};const makeShortcode=e=>function(a){return console.warn(\"Component \"+e+\" was not imported, exported, or provided by MDXProvider as global scope\"),mdx(\"div\",r({},a))},Link=makeShortcode(\"Link\"),Gist=makeShortcode(\"Gist\"),Alert=makeShortcode(\"Alert\"),layoutProps={},MDXLayout=\"wrapper\";function MDXContent(a){var n=a,{components:e}=n,t=h(n,[\"components\"]);return mdx(MDXLayout,p(r(r({},layoutProps),t),{components:e,mdxType:\"MDXLayout\"}),mdx(\"p\",null,\"Re\\xADcently, I stum\\xADbled upon \",mdx(Link,{href:\"/\",passHref:!0,mdxType:\"Link\"},mdx(\"a\",r({parentName:\"p\"},{href:\"\"}),mdx(\"strong\",{parentName:\"a\"},\"Vertx\"))),\". \",mdx(\"strong\",{parentName:\"p\"},\"Event-\\u200Bdriven, asyn\\xADchro\\xADnized, light\\xADweight, re\\xADac\\xADtive, highly per\\xADfor\\xADmant, poly\\xADglot\"),\" ap\\xADpli\\xADca\\xADtion frame\\xADwork. Ideal for writ\\xADing \",mdx(\"strong\",{parentName:\"p\"},\"micro-\\u200Bservices\"),\". I played around with it for a while and re\\xADally en\\xADjoyed the con\\xADcept of \",mdx(\"strong\",{parentName:\"p\"},\"server\\xADless\"),\" ap\\xADpli\\xADca\\xADtions.\"),mdx(\"p\",null,\"I de\\xADvel\\xADoped a few apps and cases and started to won\\xADder how to run and de\\xADploy them so that I get a 100% re\\xADli\\xADable ser\\xADvice. I sud\\xADdenly re\\xADmem\\xADbered the tech sem\\xADi\\xADnar that I at\\xADtended re\\xADcently, specif\\xADi\\xADcally ses\\xADsion about server\\xADless apps with \",mdx(\"a\",r({parentName:\"p\"},{href:\"https://aws.amazon.com/\"}),mdx(\"strong\",{parentName:\"a\"},\"AWS\")),\" (Ama\\xADzon Web Ser\\xADvices) \",mdx(\"strong\",{parentName:\"p\"},\"Lambda\"),\". Lambda is a server\\xADless com\\xADpute ser\\xADvice that runs your code in re\\xADsponse to events and au\\xADto\\xADmat\\xADi\\xADcally man\\xADages the un\\xADder\\xADly\\xADing com\\xADpute re\\xADsources for you. Fairly sim\\xADi\\xADlar con\\xADcepts \",mdx(\"strong\",{parentName:\"p\"},\"Vertx\"),\" and \",mdx(\"strong\",{parentName:\"p\"},\"AWS Lambda\"),\", so maybe they com\\xADple\\xADment each other? As it turns out they do, \",mdx(\"strong\",{parentName:\"p\"},\"Vertx\"),\" can get most of your \",mdx(\"strong\",{parentName:\"p\"},\"Lamb\\xADdas\"),\"\\u2026\"),mdx(\"p\",null,\"Using the \",mdx(\"a\",r({parentName:\"p\"},{href:\"https://serverless.com/\"}),mdx(\"strong\",{parentName:\"a\"},\"Server\\xADless Frame\\xADwork\")),\" to cre\\xADate, man\\xADage and de\\xADploy your new \",mdx(\"strong\",{parentName:\"p\"},\"Lamb\\xADdas\"),\" I was able to get this \",mdx(\"strong\",{parentName:\"p\"},\"micro-\\u200Bservice\"),\" up and run\\xADning in no time.\"),mdx(\"p\",null,mdx(\"em\",{parentName:\"p\"},\"Enough with the talk, lets see the im\\xADple\\xADmen\\xADta\\xADtion.\")),mdx(\"h2\",r({},{id:\"code\"}),mdx(\"a\",r({parentName:\"h2\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#code\"})),\"Code\"),mdx(\"p\",null,mdx(\"em\",{parentName:\"p\"},\"Han\\xADdler Class, entry point of AWS Re\\xADquest.\")),mdx(\"p\",null,\"The first issue that I had was the \",mdx(\"strong\",{parentName:\"p\"},\"sync\"),\" Event Han\\xADdler that is pro\\xADvided by AWS. So I had to by pass it with Fu\\xADture. In the Han\\xADdler class I first ini\\xADti\\xADate Vertx in\\xADstance in a sta\\xADtic block and de\\xADploy few Ver\\xADti\\xADcles that will do the work. This class only re\\xADceives the event, ex\\xADtracts needed data from the re\\xADquest and passes the data to Vertx Event\\xADBus. After the Con\\xADsumers han\\xADdle the re\\xADquest, Han\\xADdler class will gen\\xADer\\xADate a proper re\\xADsponse and fin\\xADish the AWS re\\xADquest.\"),mdx(Gist,{url:\"https://gist.github.com/pendula95/583eb45bd0a7990136fba029bdcd555b\",mdxType:\"Gist\"}),mdx(\"p\",null,mdx(\"em\",{parentName:\"p\"},\"Line 4-18:\"),\" This is where Vertx in\\xADstance is cre\\xADated, Ver\\xADti\\xADcles are de\\xADployed and \",mdx(\"strong\",{parentName:\"p\"},\"Async JDBC\"),\" client is cre\\xADated. I fig\\xADured out that it is bet\\xADter to cre\\xADated JDBC client here as in some cases I was time\\xADout when that logic was in the Ver\\xADti\\xADcle start method.\"),mdx(\"p\",null,mdx(\"em\",{parentName:\"p\"},\"Line 27-36:\"),\" These are helper lines, pars\\xADing and for\\xADmat\\xADting the data so I can pass it to the Ver\\xADti\\xADcles.\"),mdx(\"p\",null,mdx(\"em\",{parentName:\"p\"},\"Line 38-45:\"),\" I have de\\xADcided to map the con\\xADsumers to the ad\\xADdress that is made of re\\xADquest method and url path, ex\\xADam\\xADple POST/api. This means each API re\\xADquest is mapped to its own con\\xADsumer in Ver\\xADti\\xADcle class.\"),mdx(\"p\",null,mdx(\"em\",{parentName:\"p\"},\"Line 47-77:\"),\" This is noth\\xADing but a block of code that han\\xADdles the re\\xADsponse that was passed from Ver\\xADti\\xADcles to the Fu\\xADture and gen\\xADer\\xADates the final re\\xADsponse that will be re\\xADturn to API Gate\\xADway.\"),mdx(\"p\",null,mdx(\"em\",{parentName:\"p\"},\"UrlSer\\xADvice, Vertx Ver\\xADti\\xADcle.\")),mdx(\"p\",null,\"Ver\\xADti\\xADcle class is pretty for\\xADward. Con\\xADsumers that will process the mes\\xADsage, meth\\xADods for work\\xADing with JDBC and helper meth\\xADods for hash\\xADing/de\\xADhash\\xADing id. The logic be\\xADhind url short\\xADen\\xADing is fairly sim\\xADple here. Each long url is stored in data\\xADbase with a unique id and few ad\\xADdi\\xADtional columns. Row id is hashed and re\\xADturned as short url. When re\\xADtriev\\xADing long url hash is de\\xADcoded to row id and long url is re\\xADtrieved. Later user is redi\\xADrected to long url. With this im\\xADple\\xADmen\\xADta\\xADtion, on 6 char short url (char\\xADac\\xADters after the do\\xADmain) you get 62^6 com\\xADbi\\xADna\\xADtions which is 56 800 235 584 rows for stor\\xADing your urls. TinyURL is cur\\xADrently at 6 long char urls (char\\xADac\\xADters after do\\xADmain). You can of course im\\xADple\\xADment meth\\xADods for reusing and re\\xADcy\\xADcling ids.\"),mdx(Gist,{url:\"https://gist.github.com/pendula95/aeb4479162e6e33504add2af9fa68bc5\",mdxType:\"Gist\"}),mdx(\"p\",null,\"As said, this is all fairly straight for\\xADward, if you are al\\xADready fa\\xADmil\\xADiar with \",mdx(\"strong\",{parentName:\"p\"},\"Vertx\"),\". If you are think\\xADing why have I re\\xADpeated the code for es\\xADtab\\xADlish a \",mdx(\"strong\",{parentName:\"p\"},\"JDBC\"),\" con\\xADnec\\xADtion, here is the ex\\xADpla\\xADna\\xADtion \",mdx(\"em\",{parentName:\"p\"},\"(line: 10-16)\"),\". I was get\\xADting Time\\xADouts when cre\\xADat\\xADing JDBC con\\xADnec\\xADtion in Ver\\xADti\\xADcles. To avoid this I also added this code to my Han\\xADdler class. This way con\\xADnec\\xADtion is cre\\xADated there and be\\xADcause of the \",mdx(\"strong\",{parentName:\"p\"},\"Vertx\"),\" im\\xADple\\xADmen\\xADta\\xADtion any later at\\xADtempt to cre\\xADate it again will re\\xADsult in just get\\xADting the in\\xADstances from the first in\\xADvo\\xADca\\xADtion. This es\\xADcaped the need to pass the in\\xADstances di\\xADrectly from the Han\\xADdler class when cre\\xADat\\xADing Ver\\xADti\\xADcle in\\xADstances.\"),mdx(\"p\",null,mdx(\"em\",{parentName:\"p\"},\"Server\\xADless con\\xADfig\\xADu\\xADra\\xADtion.\")),mdx(\"p\",null,\"Lastly I would like to share the server\\xADless.yml, con\\xADfir\\xADma\\xADtion file that al\\xADlows seam\\xADlessly de\\xADploy and man\\xADage\\xADment of AWS Lambda. With just a few com\\xADmands and lines of con\\xADfig\\xADu\\xADra\\xADtion you are able to con\\xADfig\\xADure all nec\\xADes\\xADsary steps for de\\xADploy\\xADing your AWS Lambda. Frame\\xADwork takes care of mak\\xADing con\\xADfig\\xADu\\xADra\\xADtion of Api-\\u200BGateway and other AWS has\\xADsle that would oth\\xADer\\xADwise needed to be done by hand. In this case Lambda is in\\xADvoked by HTTP events.\"),mdx(Gist,{url:\"https://gist.github.com/pendula95/33adc47265072ed930c7df98c9ace7be\",mdxType:\"Gist\"}),mdx(\"h2\",r({},{id:\"performance-and-tests\"}),mdx(\"a\",r({parentName:\"h2\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#performance-and-tests\"})),\"Performance and Tests\"),mdx(\"p\",null,mdx(\"strong\",{parentName:\"p\"},\"Vertx\"),\" async ca\\xADpa\\xADbil\\xADi\\xADties eased the stress and mem\\xADory needs of tra\\xADdi\\xADtional \",mdx(\"strong\",{parentName:\"p\"},\"AWS Lamb\\xADdas\"),\" with sync meth\\xADods. After per\\xADform\\xADing load tests Lamb\\xADdas that were writ\\xADten using Vertx frame\\xADwork pre\\xADformed \",mdx(\"strong\",{parentName:\"p\"},\"10% faster and con\\xADsumed 40% less mem\\xADory\"),\". As I have read some\\xADwhere in Vertx doc\\xADu\\xADmen\\xADta\\xADtion, Sync meth\\xADods will def\\xADi\\xADnitely fin\\xADish the first re\\xADquest faster but in total Async will be faster in the end. This sav\\xADings in mem\\xADory and time will def\\xADi\\xADnitely re\\xADduce the cost of run\\xADning your Lamb\\xADdas and the lit\\xADtle over\\xADhead with ad\\xADdi\\xADtional code is for sure worth it.\"),mdx(\"h2\",r({},{id:\"conclusion\"}),mdx(\"a\",r({parentName:\"h2\"},{\"aria-hidden\":!0,tabIndex:-1,className:\"heading-anchor\",href:\"#conclusion\"})),\"Conclusion\"),mdx(\"p\",null,\"To fol\\xADlow the pace of de\\xADmand\\xADing needs for fast and re\\xADsilient ser\\xADvices we need to move from tra\\xADdi\\xADtional Mono\\xADliths. Em\\xADbrac\\xADing the \",mdx(\"strong\",{parentName:\"p\"},\"micro ser\\xADvice\"),\" ar\\xADchi\\xADtec\\xADture alone will not cut it, not any\\xADmore. With the rise and rapid ad\\xADvance\\xADment of \",mdx(\"strong\",{parentName:\"p\"},\"Cloud\"),\" so\\xADlu\\xADtions it has never been so easy to make a truly \",mdx(\"strong\",{parentName:\"p\"},\"Server\\xADless\"),\" sys\\xADtems build upon net\\xADwork of \",mdx(\"strong\",{parentName:\"p\"},\"micro ser\\xADvices\"),`.\nAs you have seen `,mdx(\"strong\",{parentName:\"p\"},\"Vertx\"),\" with its async API makes the full ad\\xADvan\\xADtage of \",mdx(\"strong\",{parentName:\"p\"},\"AWS Lamb\\xADdas\"),\", em\\xADbrac\\xADing them while also im\\xADprov\\xADing the per\\xADfor\\xADmance and low\\xADer\\xADing the costs. With the help from \",mdx(\"strong\",{parentName:\"p\"},\"Server\\xADless Frame\\xADwork\"),\" writ\\xADing, de\\xADploy\\xADing and man\\xADag\\xADing your \",mdx(\"strong\",{parentName:\"p\"},\"Lamb\\xADdas\"),\" has never been so easy.\"),mdx(\"p\",null,\"If you are in\\xADter\\xADested in the whole project, you can find it on \",mdx(\"a\",r({parentName:\"p\"},{href:\"https://github.com/pendula95/vertx-aws-url-shortener-service/tree/master\"}),mdx(\"strong\",{parentName:\"a\"},\"GitHub\")),\".\"),mdx(Alert,{info:!0,mdxType:\"Alert\"},mdx(\"p\",null,\"This is a re-\\u200Bpublication of the fol\\xADlow\\xADing \",mdx(\"a\",r({parentName:\"p\"},{href:\"http://lazarbulic.com/blog/2017/11/10/aws-lambda-vertx-framework-url-shortener-backend/\"}),\"blog post\"))))}MDXContent.isMDXComponent=!0;\n","scope":{}}},"prevPost":{"meta":{"title":"Eclipse Vert.x 3.5.1 released!","category":"releases","authors":[{"name":"Julien Viet","github_id":"vietj"}],"summary":"We have just released Vert.x 3.5.1!"},"date":"2018-02-13","slug":"eclipse-vert-x-3-5-1-released"},"nextPost":{"meta":{"title":"TCP Client using Eclipse Vert.x, Kotlin and Gradle build","category":"guides","authors":[{"name":"Usman Saleem","github_id":"usmansaleem"}],"summary":"In this blog post, I demonstrate how to write a very simple TCP client that keeps a connection open to a custom-written server in cloud."},"date":"2017-12-20","slug":"tcp-client-using-eclipse-vert-x-kotlin-and-gradle-build"},"relatedPosts":[{"meta":{"title":"Real-time bidding with Websockets and Vert.x","category":"guides","authors":[{"name":"Marcin Warczyglowa","github_id":"mwarc"}],"summary":"The expectations of users for interactivity with web applications have changed over the past few years.\n    Users during bidding in auction no longer want to press the refresh button."},"date":"2016-01-15","slug":"real-time-bidding-with-websockets-and-vert-x"},{"meta":{"title":"Some Rest with Vert.x","category":"guides","authors":[{"name":"Clement Escoffier","github_id":"cescoffier"}],"summary":"This post is part of the Introduction to Vert.x series. Let’s go a bit further this time and develop a CRUD-ish application"},"date":"2015-07-27","slug":"some-rest-with-vert-x"},{"meta":{"title":"Building services and APIs with AMQP 1.0","category":"guides","authors":[{"name":"Jakub Scholz","github_id":"scholzj"}],"summary":"Microservices and APIs are everywhere. Everyone talks about them, presentation slides are full of them ... some people are actually even building them."},"date":"2017-01-25","slug":"building-services-and-apis-with-amqp-1-0"}]},"__N_SSG":true}
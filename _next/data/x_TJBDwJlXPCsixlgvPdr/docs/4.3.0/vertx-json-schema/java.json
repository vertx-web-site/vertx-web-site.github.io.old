{"pageProps":{"slug":"4.3.0/vertx-json-schema/java","title":"Vert.x Json Schema","fallbackGitHubStars":36,"toc":"<div id=\"toc\" class=\"toc\">\n<div id=\"toctitle\">Table of Contents</div>\n<ul class=\"sectlevel1\">\n<li><a href=\"#_using_vert_x_json_schema\">Using Vert.x Json Schema</a></li>\n<li><a href=\"#_concepts\">Concepts</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_jsonschema\">JsonSchema</a></li>\n<li><a href=\"#_schemarepository\">SchemaRepository</a></li>\n<li><a href=\"#_validator\">Validator</a></li>\n</ul>\n</li>\n<li><a href=\"#_parse_a_schema\">Parse a schema</a></li>\n<li><a href=\"#_validate\">Validate</a></li>\n<li><a href=\"#_custom_formats\">Custom formats</a></li>\n<li><a href=\"#_building_your_schemas_from_code\">Building your schemas from code</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_creating_the_schema\">Creating the schema</a></li>\n<li><a href=\"#_using_the_keywords\">Using the keywords</a></li>\n<li><a href=\"#_defining_the_schema_structure\">Defining the schema structure</a></li>\n<li><a href=\"#_ref_and_aliases\"><code>$ref</code> and aliases</a></li>\n<li><a href=\"#_using_the_schema\">Using the schema</a></li>\n</ul>\n</li>\n</ul>\n</div>","contents":"<h1>Vert.x Json Schema</h1>\n\n<div id=\"preamble\">\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Vert.x Json Schema provides an extendable and asynchronous implementation for <a href=\"https://json-schema.org/\">Json Schema</a> specification.\nYou can use Json Schemas to validate every json structure. This module provides:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Implementation of <a href=\"https://datatracker.ietf.org/doc/html/draft-bhutton-json-schema-validation-00\">draft 2020-12</a></p>\n</li>\n<li>\n<p>Implementation of <a href=\"https://datatracker.ietf.org/doc/html/draft-handrews-json-schema-validation-02\">draft 2019-09</a></p>\n</li>\n<li>\n<p>Implementation of <a href=\"https://datatracker.ietf.org/doc/html/draft-handrews-json-schema-validation-01\">draft 7</a></p>\n</li>\n<li>\n<p>Implementation of <a href=\"https://datatracker.ietf.org/doc/html/draft-fge-json-schema-validation-00\">draft 4</a></p>\n</li>\n<li>\n<p>Dereferencing of <code>$ref</code> resolution and caching</p>\n</li>\n<li>\n<p>DSL to build schemas programmatically</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_using_vert_x_json_schema\"><a class=\"anchor\" href=\"#_using_vert_x_json_schema\"></a>Using Vert.x Json Schema</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>To use Vert.x Json Schema, add the following dependency to the <em>dependencies</em> section of your build descriptor:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Maven (in your <code>pom.xml</code>):</p>\n</li>\n</ul>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-xml\" data-lang=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>io.vertx<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>vertx-json-schema<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>4.3.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span></code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Gradle (in your <code>build.gradle</code> file):</p>\n</li>\n</ul>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-groovy\" data-lang=\"groovy\">dependencies {\n compile <span class=\"hljs-string\">&#x27;io.vertx:vertx-json-schema:4.3.0&#x27;</span>\n}</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_concepts\"><a class=\"anchor\" href=\"#_concepts\"></a>Concepts</h2>\n<div class=\"sectionbody\">\n<div class=\"sect2\">\n<h3 id=\"_jsonschema\"><a class=\"anchor\" href=\"#_jsonschema\"></a>JsonSchema</h3>\n<div class=\"paragraph\">\n<p>Schemas can exist in 2 flavours:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>JSON as in JSON natation</p>\n</li>\n<li>\n<p>Boolean as in <code>true/false</code></p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>The <code><a href=\"../../apidocs/io/vertx/json/schema/JsonSchema.html\">JsonSchema</a></code> interface allows both types to be handled without the constant check of the\nunderlying type.</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_schemarepository\"><a class=\"anchor\" href=\"#_schemarepository\"></a>SchemaRepository</h3>\n<div class=\"paragraph\">\n<p>The <code><a href=\"../../apidocs/io/vertx/json/schema/SchemaRepository.html\">SchemaRepository</a></code> holds <code><a href=\"../../apidocs/io/vertx/json/schema/JsonSchema.html\">JsonSchema</a></code> instances. It performs\ndereferencing of schemas to speed up validation. The repository is a simple key store, this means that it does not allow\nduplicate ids.</p>\n</div>\n<div class=\"paragraph\">\n<p>The repository can then create <code><a href=\"../../apidocs/io/vertx/json/schema/Validator.html\">Validator</a></code> instances aware of all sub schemas in the\nrepository.</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_validator\"><a class=\"anchor\" href=\"#_validator\"></a>Validator</h3>\n<div class=\"paragraph\">\n<p>As the name implies the <code><a href=\"../../apidocs/io/vertx/json/schema/Validator.html\">Validator</a></code> validates an object using a start schema. The output\nformat is dependent of the configuration.</p>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_parse_a_schema\"><a class=\"anchor\" href=\"#_parse_a_schema\"></a>Parse a schema</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>When working with multiple schemas or sub-schemas, it is recommended to use a <code>Repository</code>.</p>\n</div>\n<div class=\"paragraph\">\n<p>To parse a schema you first need a <code>JsonSchema</code> and some initial configuration. Since schemas can contain references it\nis required for the validator and repository to be aware of your application <code>baseUri</code>. This allows you to reference your\nown schemas in other sub-schemas. For the purpose of dereferencing, you don&#8217;t need to configure a draft.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">SchemaRepository</span> <span class=\"hljs-variable\">repository</span> <span class=\"hljs-operator\">=</span>\n  SchemaRepository.create(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">JsonSchemaOptions</span>().setBaseUri(<span class=\"hljs-string\">&quot;https://vertx.io&quot;</span>));</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>You can use <code>JsonSchema</code> instances for different <code>Validator</code> and you can parse different <code>JsonSchema</code> with <code>JsonParser</code>\ndirectly.</p>\n</div>\n<div class=\"paragraph\">\n<p>Now you can parse the schema:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">JsonSchema</span> <span class=\"hljs-variable\">schema</span> <span class=\"hljs-operator\">=</span> JsonSchema.of(object);\n\n<span class=\"hljs-comment\">// Or</span>\n\nrepository.dereference(JsonSchema.of(object));</code></pre>\n</div>\n</div>\n<div class=\"admonitionblock important\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\">Important</div>\n</td>\n<td class=\"content\">\n<div class=\"paragraph\">\n<p>Remember that for security reasons, this module will not attempt to download any referenced sub-schema. All required\nsub-schemas should be provided to a repository object.</p>\n</div>\n</td>\n</tr>\n</table>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_validate\"><a class=\"anchor\" href=\"#_validate\"></a>Validate</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Given the dynamic nature of json-schema and the conditional <code>if-then-else</code> it is not possible to validate in a streaming\nscenario. Validation is for this reason a blocking operation. If you are aware that validation will be a very expensive\nprocess, then it is advisable to run the validation on a dedicated thread pool or using <code>executeBlocking</code>.\nA schema could have two states:</p>\n</div>\n<div class=\"paragraph\">\n<p>To validate a schema:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">OutputUnit</span> <span class=\"hljs-variable\">result</span> <span class=\"hljs-operator\">=</span> Validator.create(\n    schema,\n    <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">JsonSchemaOptions</span>().setDraft(Draft.DRAFT7))\n  .validate(json);\n\n<span class=\"hljs-keyword\">if</span> (result.getValid()) {\n  <span class=\"hljs-comment\">// Successful validation</span>\n}</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_custom_formats\"><a class=\"anchor\" href=\"#_custom_formats\"></a>Custom formats</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Adding custom formats is not allowed. This may sound like a limitation but it arises from the validation spec.\nValidators are expected to assume unknown formats as valid input, delegating to the application business code the role\nof validator for custom values.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_building_your_schemas_from_code\"><a class=\"anchor\" href=\"#_building_your_schemas_from_code\"></a>Building your schemas from code</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>If you want to build schemas from code, you can use the included DSL. Only Draft-7 is supported for this feature.</p>\n</div>\n<div class=\"paragraph\">\n<p>To start, add static imports for <code><a href=\"../../apidocs/io/vertx/json/schema/draft7/dsl/Schemas.html\">Schemas</a></code> and <code><a href=\"../../apidocs/io/vertx/json/schema/draft7/dsl/Keywords.html\">Keywords</a></code></p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_creating_the_schema\"><a class=\"anchor\" href=\"#_creating_the_schema\"></a>Creating the schema</h3>\n<div class=\"paragraph\">\n<p>Inside <code><a href=\"../../apidocs/io/vertx/json/schema/draft7/dsl/Schemas.html\">Schemas</a></code> there are static methods to create the schema:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">SchemaBuilder</span> <span class=\"hljs-variable\">intSchemaBuilder</span> <span class=\"hljs-operator\">=</span> intSchema();\n<span class=\"hljs-type\">SchemaBuilder</span> <span class=\"hljs-variable\">objectSchemaBuilder</span> <span class=\"hljs-operator\">=</span> objectSchema();</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_using_the_keywords\"><a class=\"anchor\" href=\"#_using_the_keywords\"></a>Using the keywords</h3>\n<div class=\"paragraph\">\n<p>For every schema you can add keywords built with <code><a href=\"../../apidocs/io/vertx/json/schema/draft7/dsl/Keywords.html\">Keywords</a></code> methods,\ndepending on the type of the schema:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">stringSchema()\n  .with(format(StringFormat.DATETIME));\narraySchema()\n  .with(maxItems(<span class=\"hljs-number\">10</span>));\nschema() <span class=\"hljs-comment\">// Generic schema that accepts both arrays and integers</span>\n  .with(type(SchemaType.ARRAY, SchemaType.INT));</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_defining_the_schema_structure\"><a class=\"anchor\" href=\"#_defining_the_schema_structure\"></a>Defining the schema structure</h3>\n<div class=\"paragraph\">\n<p>Depending on the schema you create, you can define a structure.</p>\n</div>\n<div class=\"paragraph\">\n<p>To create an object schema with some properties schemas and additional properties schema:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">objectSchema()\n  .requiredProperty(<span class=\"hljs-string\">&quot;name&quot;</span>, stringSchema())\n  .requiredProperty(<span class=\"hljs-string\">&quot;age&quot;</span>, intSchema())\n  .additionalProperties(stringSchema());</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>To create an array schema:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">arraySchema()\n  .items(stringSchema());</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>To create a tuple schema:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">tupleSchema()\n  .item(stringSchema()) <span class=\"hljs-comment\">// First item</span>\n  .item(intSchema()) <span class=\"hljs-comment\">// Second item</span>\n  .item(booleanSchema()); <span class=\"hljs-comment\">// Third item</span></code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_ref_and_aliases\"><a class=\"anchor\" href=\"#_ref_and_aliases\"></a><code>$ref</code> and aliases</h3>\n<div class=\"paragraph\">\n<p>To add a <code>$ref</code> schema you can use the <code><a href=\"../../apidocs/io/vertx/json/schema/common/dsl/Schemas.html#ref-io.vertx.core.json.pointer.JsonPointer-\">Schemas.ref</a></code> method.\nTo assign an <code>$id</code> keyword to a schema, use <code><a href=\"../../apidocs/io/vertx/json/schema/common/dsl/SchemaBuilder.html#id-io.vertx.core.json.pointer.JsonPointer-\">id</a></code></p>\n</div>\n<div class=\"paragraph\">\n<p>You can also refer to schemas defined with this dsl using aliases. You can use <code><a href=\"../../apidocs/io/vertx/json/schema/common/dsl/SchemaBuilder.html#alias-java.lang.String-\">alias</a></code> to assign an alias to\na schema. Then you can refer to a schema with an alias using <code><a href=\"../../apidocs/io/vertx/json/schema/common/dsl/Schemas.html#refToAlias-java.lang.String-\">Schemas.refToAlias</a></code>:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">intSchema()\n  .alias(<span class=\"hljs-string\">&quot;myInt&quot;</span>);\n\nobjectSchema()\n  .requiredProperty(<span class=\"hljs-string\">&quot;anInteger&quot;</span>, refToAlias(<span class=\"hljs-string\">&quot;myInt&quot;</span>));</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_using_the_schema\"><a class=\"anchor\" href=\"#_using_the_schema\"></a>Using the schema</h3>\n<div class=\"paragraph\">\n<p>After you defined the schema, you can call <code><a href=\"../../apidocs/io/vertx/json/schema/common/dsl/SchemaBuilder.html#toJson--\">toJson</a></code> to return the JSON notation of the schema:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\"><span class=\"hljs-type\">JsonObject</span> <span class=\"hljs-variable\">schema</span> <span class=\"hljs-operator\">=</span> objectSchema()\n  .requiredProperty(<span class=\"hljs-string\">&quot;name&quot;</span>, stringSchema())\n  .requiredProperty(<span class=\"hljs-string\">&quot;age&quot;</span>, intSchema())\n  .additionalProperties(stringSchema())\n  .toJson();</code></pre>\n</div>\n</div>\n</div>\n</div>\n</div>","version":"4.3.0"},"__N_SSG":true}
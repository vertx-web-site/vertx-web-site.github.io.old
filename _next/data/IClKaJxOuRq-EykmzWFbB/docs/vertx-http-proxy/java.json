{"pageProps":{"slug":"vertx-http-proxy/java","title":"Vert.x Http Proxy","fallbackGitHubStars":30,"toc":"<div id=\"toc\" class=\"toc\">\n<div id=\"toctitle\">Table of Contents</div>\n<ul class=\"sectlevel1\">\n<li><a href=\"#_using_vert_x_http_proxy\">Using Vert.x Http Proxy</a></li>\n<li><a href=\"#_reverse_proxy_server\">Reverse proxy server</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_websockets\">WebSockets</a></li>\n<li><a href=\"#_proxy_caching\">Proxy caching</a></li>\n<li><a href=\"#_proxy_interception\">Proxy interception</a></li>\n</ul>\n</li>\n</ul>\n</div>","contents":"<h1>Vert.x Http Proxy</h1>\n\n<div id=\"preamble\">\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Vert.x Http Proxy is a reverse proxy based on Vert.x, it aims to implement reusable reverse proxy logic to focus on\nhigher concerns.</p>\n</div>\n<div class=\"admonitionblock warning\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\">Warning</div>\n</td>\n<td class=\"content\">\nThis module has <em>Tech Preview</em> status, this means the API can change between versions.\n</td>\n</tr>\n</table>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_using_vert_x_http_proxy\"><a class=\"anchor\" href=\"#_using_vert_x_http_proxy\"></a>Using Vert.x Http Proxy</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>To use Vert.x Http Proxy, add the following dependency to the <em>dependencies</em> section of your build descriptor:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Maven (in your <code>pom.xml</code>):</p>\n</li>\n</ul>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-xml\" data-lang=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>io.vertx<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>vertx-http-proxy<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>4.2.5<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span></code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Gradle (in your <code>build.gradle</code> file):</p>\n</li>\n</ul>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-groovy\" data-lang=\"groovy\">dependencies {\n compile <span class=\"hljs-string\">&#x27;io.vertx:vertx-http-proxy:4.2.5&#x27;</span>\n}</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_reverse_proxy_server\"><a class=\"anchor\" href=\"#_reverse_proxy_server\"></a>Reverse proxy server</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>In order to accomplish a reverse proxy with Vert.x Http Proxy you need the following:</p>\n</div>\n<div class=\"olist arabic\">\n<ol class=\"arabic\">\n<li>\n<p><strong>Proxy Server</strong> that handles user-agent requests and forward them to the <strong>origin server</strong></p>\n</li>\n<li>\n<p><strong>Origin Server</strong> that handles requests from the <strong>proxy server</strong> and respond accordingly</p>\n</li>\n</ol>\n</div>\n<div class=\"paragraph\">\n<p>You can create a <strong>proxy server</strong> that listens to port <code>8080</code> and implement reverse proxy logic</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">HttpClient proxyClient = vertx.createHttpClient();\n\nHttpProxy proxy = HttpProxy.reverseProxy(proxyClient);\nproxy.origin(<span class=\"hljs-number\">7070</span>, <span class=\"hljs-string\">&quot;origin&quot;</span>);\n\nHttpServer proxyServer = vertx.createHttpServer();\n\nproxyServer.requestHandler(proxy).listen(<span class=\"hljs-number\">8080</span>);</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>All user-agent requests are forwarded to the <strong>origin server</strong> conveniently.</p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_websockets\"><a class=\"anchor\" href=\"#_websockets\"></a>WebSockets</h3>\n<div class=\"paragraph\">\n<p>The proxy supports WebSocket by default.</p>\n</div>\n<div class=\"paragraph\">\n<p>WebSocket handshake requests  are forwarded to the origin server (including the <code>connection</code> header)  and the handshake\nhappens between the user agent and the origin server.</p>\n</div>\n<div class=\"paragraph\">\n<p>You can configure WebSocket support with <code><a href=\"../../apidocs/io/vertx/httpproxy/ProxyOptions.html#setSupportWebSocket-boolean-\">setSupportWebSocket</a></code>.</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_proxy_caching\"><a class=\"anchor\" href=\"#_proxy_caching\"></a>Proxy caching</h3>\n<div class=\"paragraph\">\n<p>By default the proxy does not cache response and ignores most cache directives, you can enable caching by setting the cache options.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">HttpProxy proxy = HttpProxy.reverseProxy(<span class=\"hljs-keyword\">new</span> ProxyOptions().setCacheOptions(<span class=\"hljs-keyword\">new</span> CacheOptions()), proxyClient);</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_proxy_interception\"><a class=\"anchor\" href=\"#_proxy_interception\"></a>Proxy interception</h3>\n<div class=\"paragraph\">\n<p>Interception is a powerful way to extend the proxy withg new features.</p>\n</div>\n<div class=\"paragraph\">\n<p>You can implement <code><a href=\"../../apidocs/io/vertx/httpproxy/ProxyInterceptor.html#handleProxyRequest-io.vertx.httpproxy.ProxyContext-\">handleProxyRequest</a></code> to perform any operation on the proxy request</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">proxy.addInterceptor(<span class=\"hljs-keyword\">new</span> ProxyInterceptor() {\n  <span class=\"hljs-meta\">@Override</span>\n  <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> Future&lt;ProxyResponse&gt; <span class=\"hljs-title\">handleProxyRequest</span><span class=\"hljs-params\">(ProxyContext context)</span> </span>{\n    ProxyRequest proxyRequest = context.request();\n\n    filter(proxyRequest.headers());\n\n    <span class=\"hljs-comment\">// Continue the interception chain</span>\n    <span class=\"hljs-keyword\">return</span> context.sendRequest();\n  }\n});</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Likewise with the proxy response</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">proxy.addInterceptor(<span class=\"hljs-keyword\">new</span> ProxyInterceptor() {\n  <span class=\"hljs-meta\">@Override</span>\n  <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> Future&lt;Void&gt; <span class=\"hljs-title\">handleProxyResponse</span><span class=\"hljs-params\">(ProxyContext context)</span> </span>{\n    ProxyResponse proxyResponse = context.response();\n\n    filter(proxyResponse.headers());\n\n    <span class=\"hljs-comment\">// Continue the interception chain</span>\n    <span class=\"hljs-keyword\">return</span> context.sendResponse();\n  }\n});</code></pre>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"_body_filtering\"><a class=\"anchor\" href=\"#_body_filtering\"></a>Body filtering</h4>\n<div class=\"paragraph\">\n<p>You can filter body by simply replacing the original <code><a href=\"../../apidocs/io/vertx/httpproxy/Body.html\">Body</a></code> with a new one</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">proxy.addInterceptor(<span class=\"hljs-keyword\">new</span> ProxyInterceptor() {\n  <span class=\"hljs-meta\">@Override</span>\n  <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> Future&lt;Void&gt; <span class=\"hljs-title\">handleProxyResponse</span><span class=\"hljs-params\">(ProxyContext context)</span> </span>{\n    ProxyResponse proxyResponse = context.response();\n\n    <span class=\"hljs-comment\">// Create a filtered body</span>\n    Body filteredBody = filter(proxyResponse.getBody());\n\n    <span class=\"hljs-comment\">// And then let the response use it</span>\n    proxyResponse.setBody(filteredBody);\n\n    <span class=\"hljs-comment\">// Continue the interception chain</span>\n    <span class=\"hljs-keyword\">return</span> context.sendResponse();\n  }\n});</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"_interception_control\"><a class=\"anchor\" href=\"#_interception_control\"></a>Interception control</h4>\n<div class=\"paragraph\">\n<p><code><a href=\"../../apidocs/io/vertx/httpproxy/ProxyContext.html#sendRequest--\">sendRequest</a></code> and <code><a href=\"../../apidocs/io/vertx/httpproxy/ProxyContext.html#sendResponse--\">sendResponse</a></code> continue the\ncurrent interception chain and then send the result to the origin server or the user-agent.</p>\n</div>\n<div class=\"paragraph\">\n<p>You can change the control, e.g you can send a response immediately to the user-agent without even requesting the origin server</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-java\" data-lang=\"java\">proxy.addInterceptor(<span class=\"hljs-keyword\">new</span> ProxyInterceptor() {\n  <span class=\"hljs-meta\">@Override</span>\n  <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> Future&lt;ProxyResponse&gt; <span class=\"hljs-title\">handleProxyRequest</span><span class=\"hljs-params\">(ProxyContext context)</span> </span>{\n\n    ProxyRequest proxyRequest = context.request();\n\n    <span class=\"hljs-comment\">// Release the underlying resources</span>\n    proxyRequest.release();\n\n    <span class=\"hljs-comment\">// Create a response and populate it</span>\n    ProxyResponse proxyResponse = proxyRequest.response()\n      .setStatusCode(<span class=\"hljs-number\">200</span>)\n      .putHeader(<span class=\"hljs-string\">&quot;content-type&quot;</span>, <span class=\"hljs-string\">&quot;text/plain&quot;</span>)\n      .setBody(Body.body(Buffer.buffer(<span class=\"hljs-string\">&quot;Hello World&quot;</span>)));\n\n    <span class=\"hljs-keyword\">return</span> Future.succeededFuture(proxyResponse);\n  }\n});</code></pre>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>"},"__N_SSG":true}
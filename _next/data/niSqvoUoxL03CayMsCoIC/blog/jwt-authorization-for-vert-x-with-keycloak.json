{"pageProps":{"categories":["releases","guides","security","news"],"post":{"meta":{"title":"JWT Authorization for Vert.x with Keycloak","category":"guides","authors":[{"name":"Thomas Darimont","github_id":"thomasdarimont"}],"summary":"In this blog post, you'll learn about JWT foundations, protect routes with JWT Authorization, JWT encoded tokens, and RBAC with Keycloak"},"date":"2020-10-01","slug":"jwt-authorization-for-vert-x-with-keycloak","readingTime":{"text":"11 min read","minutes":10.075,"time":604500,"words":2015},"content":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, {})\n  })) : _createMdxContent();\n  function _createMdxContent() {\n    const _components = Object.assign({\n      p: \"p\",\n      strong: \"strong\",\n      ul: \"ul\",\n      li: \"li\",\n      h2: \"h2\",\n      a: \"a\",\n      code: \"code\",\n      pre: \"pre\",\n      span: \"span\",\n      h3: \"h3\"\n    }, props.components), {Link} = _components;\n    if (!Link) _missingMdxReference(\"Link\", true);\n    return _jsxs(_Fragment, {\n      children: [_jsx(_components.p, {\n        children: _jsx(_components.strong, {\n          children: \"TL;DR:\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"In this blog post you’ll learn:\"\n      }), \"\\n\", _jsxs(_components.ul, {\n        children: [\"\\n\", _jsx(_components.li, {\n          children: \"JWT foun­da­tions\"\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"How to pro­tect routes with a JWT Au­tho­riza­tion\"\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"How to ex­tract claims from a JWT en­coded token\"\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"How to apply RBAC with Key­cloak Realm roles\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.h2, {\n        id: \"hello-again\",\n        children: [_jsx(_components.a, {\n          \"aria-hidden\": true,\n          tabIndex: \"-1\",\n          className: \"heading-anchor\",\n          href: \"#hello-again\"\n        }), \"Hello again\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"Hi there! In my last blog post \", _jsx(Link, {\n          href: \"/blog/easy-sso-for-vert-x-with-keycloak/\",\n          passHref: true,\n          children: _jsx(_components.a, {\n            href: \"\",\n            children: \"Easy SSO for Vert.x with Key­cloak\"\n          })\n        }), \", we learned how to con­fig­ure sin­gle sign-​on for a Vert.x web ap­pli­ca­tion with Key­cloak and OpenID con­nect. This time, we’ll see how we can pro­tect an ap­pli­ca­tion with Vert.x’s \", _jsx(Link, {\n          href: \"/docs/vertx-web/java/#_jwt_authorisation\",\n          passHref: true,\n          children: _jsx(_components.a, {\n            href: \"\",\n            children: \"JWT Au­tho­riza­tion\"\n          })\n        }), \" sup­port and Key­cloak.\"]\n      }), \"\\n\", _jsxs(_components.h2, {\n        id: \"keycloak-setup\",\n        children: [_jsx(_components.a, {\n          \"aria-hidden\": true,\n          tabIndex: \"-1\",\n          className: \"heading-anchor\",\n          href: \"#keycloak-setup\"\n        }), \"Keycloak Setup\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"To se­cure our Vert.x app, we need to use a Key­cloak server for ob­tain­ing JWT to­kens. Al­though \", _jsx(_components.a, {\n          href: \"https://www.keycloak.org/docs/latest/getting_started/\",\n          children: \"Key­cloak has a great get­ting started guide\"\n        }), \" I wanted to make it a bit eas­ier to put every­thing to­gether, there­fore I pre­pared a local Key­cloak docker con­tainer \", _jsx(_components.a, {\n          href: \"https://github.com/thomasdarimont/vertx-playground/tree/master/jwt-service-vertx#start-keycloak-with-the-vertx-realm\",\n          children: \"as de­scribed here\"\n        }), \", which comes with all the re­quired con­fig­u­ra­tion in place, that you can start eas­ily.\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"The pre­con­fig­ured Key­cloak realm \", _jsx(_components.code, {\n          children: \"vertx\"\n        }), \" con­tains a \", _jsx(_components.code, {\n          children: \"vertx-service\"\n        }), \" OpenID con­nect client for our Vert.x app and a set\\nof users for test­ing. To ease test­ing, the \", _jsx(_components.code, {\n          children: \"vertx-service\"\n        }), \" is con­fig­ured with \", _jsx(_components.code, {\n          children: \"Direct Access Grant\"\n        }), \" en­abled in Key­cloak, which\\nen­ables sup­port for the OAuth2 re­source owner pass­word cre­den­tials grant (ROPC) flow.\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"To start Key­cloak with the pre­con­fig­ured realm, just start the docker con­tainer with the fol­low­ing com­mand:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-bash\",\n          children: [\"docker run \\\\\\n  -it \\\\\\n  --name vertx-keycloak \\\\\\n  --\", _jsx(_components.span, {\n            className: \"hljs-built_in\",\n            children: \"rm\"\n          }), \" \\\\\\n  -e KEYCLOAK_USER=admin \\\\\\n  -e KEYCLOAK_PASSWORD=admin \\\\\\n  -e KEYCLOAK_IMPORT=/tmp/vertx-realm.json \\\\\\n  -v \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"$PWD\"\n          }), \"/vertx-realm.json:/tmp/vertx-realm.json \\\\\\n  -v \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"$PWD\"\n          }), \"/data:/opt/jboss/keycloak/standalone/data \\\\\\n  -p 8080:8080 \\\\\\n  quay.io/keycloak/keycloak:11.0.2\\n\"]\n        })\n      }), \"\\n\", _jsxs(_components.h2, {\n        id: \"vertx-app\",\n        children: [_jsx(_components.a, {\n          \"aria-hidden\": true,\n          tabIndex: \"-1\",\n          className: \"heading-anchor\",\n          href: \"#vertx-app\"\n        }), \"Vert.x App\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"The ex­am­ple app con­sists of a sin­gle \", _jsx(_components.code, {\n          children: \"Verticle\"\n        }), \", that runs on \", _jsx(_components.code, {\n          children: \"http://localhost:3000\"\n        }), \" and pro­vides a few routes with pro­tected re­sources. \", _jsx(_components.a, {\n          href: \"https://github.com/thomasdarimont/vertx-playground/tree/master/jwt-service-vertx/src/main/java/demo/MainVerticle.java\",\n          children: \"You can find the com­plete ex­am­ple here\"\n        }), \".\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Our web app con­tains the fol­low­ing pro­tected routes with han­dlers:\"\n      }), \"\\n\", _jsxs(_components.ul, {\n        children: [\"\\n\", _jsxs(_components.li, {\n          children: [_jsx(_components.code, {\n            children: \"/api/greet\"\n          }), \" - The greet­ing re­source, which re­turns a greet­ing mes­sage, only au­then­ti­cated users can ac­cess this re­source.\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [_jsx(_components.code, {\n            children: \"/api/user\"\n          }), \" - The user re­source, which re­turns some in­for­ma­tion about the user, only users with role \", _jsx(_components.code, {\n            children: \"user\"\n          }), \" can ac­cess this re­source.\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [_jsx(_components.code, {\n            children: \"/api/admin\"\n          }), \" - The user re­source, which re­turns some in­for­ma­tion about the admin, only users with role \", _jsx(_components.code, {\n            children: \"admin\"\n          }), \" can ac­cess this re­source.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"This ex­am­ple is built with Vert.x ver­sion 3.9.3.\"\n      }), \"\\n\", _jsxs(_components.h3, {\n        id: \"running-the-app-in-the-console\",\n        children: [_jsx(_components.a, {\n          \"aria-hidden\": true,\n          tabIndex: \"-1\",\n          className: \"heading-anchor\",\n          href: \"#running-the-app-in-the-console\"\n        }), \"Running the app in the console\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"To run the app, we need to build it first:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-bash\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-built_in\",\n            children: \"cd\"\n          }), \" jwt-service-vertx\\nmvn clean package\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"This cre­ates a jar, which we can run:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"hljs language-bash\",\n          children: \"java -jar target/*.jar\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Note, that we need to start Key­cloak first, since our app fetches the con­fig­u­ra­tion from Key­cloak on startup.\"\n      }), \"\\n\", _jsxs(_components.h3, {\n        id: \"running-the-app-in-the-ide\",\n        children: [_jsx(_components.a, {\n          \"aria-hidden\": true,\n          tabIndex: \"-1\",\n          className: \"heading-anchor\",\n          href: \"#running-the-app-in-the-ide\"\n        }), \"Running the app in the IDE\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"We can also run the app di­rectly from your favourite IDE like In­tel­liJ Idea or Eclipse.\\nTo run the app from an IDE, we need to cre­ate a launch con­fig­u­ra­tion and use the main class \", _jsx(_components.code, {\n          children: \"io.vertx.core.Launcher\"\n        }), \". Then set the the pro­gram ar­gu­ments to\\n\", _jsx(_components.code, {\n          children: \"run demo.MainVerticle\"\n        }), \" and use the class­path of the \", _jsx(_components.code, {\n          children: \"jwt-service-vertx\"\n        }), \" mod­ule.\\nWith that in place we should be able to run the app.\"]\n      }), \"\\n\", _jsxs(_components.h2, {\n        id: \"jwt-authorization\",\n        children: [_jsx(_components.a, {\n          \"aria-hidden\": true,\n          tabIndex: \"-1\",\n          className: \"heading-anchor\",\n          href: \"#jwt-authorization\"\n        }), \"JWT Authorization\"]\n      }), \"\\n\", _jsxs(_components.h3, {\n        id: \"jwt-foundations\",\n        children: [_jsx(_components.a, {\n          \"aria-hidden\": true,\n          tabIndex: \"-1\",\n          className: \"heading-anchor\",\n          href: \"#jwt-foundations\"\n        }), \"JWT Foundations\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [_jsx(_components.a, {\n          href: \"https://tools.ietf.org/html/rfc7519\",\n          children: \"JSON Web Token (JWT)\"\n        }), \" is an open stan­dard to se­curely ex­change in­for­ma­tion be­tween two par­ties in the form\\nof \", _jsx(_components.a, {\n          href: \"https://base64.guru/standards/base64url\",\n          children: \"Base64URL\"\n        }), \" en­coded JSON ob­jects.\\nA stan­dard JWT is just a string which com­prises three base64url en­coded parts header, pay­load and a sig­na­ture, which are sep­a­rated by a ”\", _jsx(_components.code, {\n          children: \".\"\n        }), \"” char­ac­ter.\\nThere are other vari­ants of JWT that can have more parts.\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"An ex­am­ple JWT can look like this:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"hljs language-text\",\n          children: \"eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJjN00xX2hkWjAtWDNyZTl1dmZLSFRDUWRxYXJQYnBMblVJMHltdkF0U1RzIn0.eyJleHAiOjE2MDEzMTg0MjIsImlhdCI6MTYwMTMxODEyMiwianRpIjoiNzYzNWY1YTEtZjFkNy00NTdkLWI4NjktYWQ0OTIzNTJmNGQyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2F1dGgvcmVhbG1zL3ZlcnR4IiwiYXVkIjoiYWNjb3VudCIsInN1YiI6IjI3YjNmYWMwLTlhZWMtNDQyMS04MWNmLWQ0YjAyNDI4ZjkwMSIsInR5cCI6IkJlYXJlciIsImF6cCI6InZlcnR4LXNlcnZpY2UiLCJzZXNzaW9uX3N0YXRlIjoiNjg3MDgyMTMtNDBiNy00NThhLWFlZTEtMzlkNmY5ZGEwN2FkIiwiYWNyIjoiMSIsInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJvZmZsaW5lX2FjY2VzcyIsInVtYV9hdXRob3JpemF0aW9uIiwidXNlciJdfSwicmVzb3VyY2VfYWNjZXNzIjp7ImFjY291bnQiOnsicm9sZXMiOlsibWFuYWdlLWFjY291bnQiLCJtYW5hZ2UtYWNjb3VudC1saW5rcyIsInZpZXctcHJvZmlsZSJdfX0sInNjb3BlIjoiZW1haWwgcHJvZmlsZSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJuYW1lIjoiVGhlbyBUZXN0ZXIiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJ0ZXN0ZXIiLCJnaXZlbl9uYW1lIjoiVGhlbyIsImZhbWlseV9uYW1lIjoiVGVzdGVyIiwiZW1haWwiOiJ0b20rdGVzdGVyQGxvY2FsaG9zdCJ9.NN1ZGE3f3LHE0u7T6Vfq5yPMKoZ6SmrUxoFopAXZm5wVgMOsJHB8BgHQTDm7u0oTVU0ZHlKH2-o11RKK7Mz0mLqMy2EPdkGY9Bqtj5LZ8oTp8FaVqY1g5Fr5veXYpOMbc2fke-e2hG8sAfSjWz1Mq9BUhJ7HdK7TTIte12pub2nbUs4APYystJWx49cYmUwZ-5c9X295V-NX9UksuMSzFItZ4cACVKi68m9lkR4RuNQKFTuLvWsorz9yRx884e4cnoT_JmfSfYBIl31FfnQzUtCjluUzuD9jVXc_vgC7num_0AreOZiUzpglb8UjKXjswTHF-v_nEIaq7YmM5WKpeg\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"The header and pay­load sec­tions con­tain in­for­ma­tion as a JSON ob­ject, whereas the sig­na­ture is just a plain string. JSON ob­jects con­tain key value pairs which are called \", _jsx(_components.code, {\n          children: \"claims\"\n        }), \".\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"The claims in­for­ma­tion can be ver­i­fied and trusted be­cause it is dig­i­tally signed with the pri­vate key from a pub­lic/pri­vate key-​pair.\\nThe sig­na­ture can later be ver­i­fied with a cor­re­spond­ing pub­lic key. The iden­ti­fier of the pub­lic/pri­vate key-​pair used to sign a JWT can be\\ncon­tained in a spe­cial claim called \", _jsx(_components.code, {\n          children: \"kid\"\n        }), \" (key iden­ti­fier) in the header sec­tion of the JWT.\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"An ex­am­ple for a JWT header that ref­er­ences a pub­lic/pri­vate key-​pair looks like this:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-json\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"{\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"alg\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"RS256\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"typ\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"JWT\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"kid\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"c7M1_hdZ0-X3re9uvfKHTCQdqarPbpLnUI0ymvAtSTs\\\"\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"It is quite com­mon to use JWTs to con­vey in­for­ma­tion about au­then­ti­ca­tion (user iden­tity) and au­tho­riza­tion (scopes, user roles, per­mis­sions and other claims).\\nOpenID providers such as \", _jsx(_components.a, {\n          href: \"https://www.keycloak.org/\",\n          children: \"Key­cloak\"\n        }), \" sup­port is­su­ing OAuth2 ac­cess to­kens after au­then­ti­ca­tion for users to clients in the form of JWTs.\\nAn ac­cess token can then be used to ac­cess other ser­vices or APIs on be­half of the user. The server pro­vid­ing those ser­vices or APIs is often called \", _jsx(_components.code, {\n          children: \"resource server\"\n        }), \".\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"An ex­am­ple JWT pay­load gen­er­ated by Key­cloak looks like this:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-json\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"{\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"exp\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-number\",\n            children: \"1601318422\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"iat\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-number\",\n            children: \"1601318122\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"jti\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"7635f5a1-f1d7-457d-b869-ad492352f4d2\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"iss\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"http://localhost:8080/auth/realms/vertx\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"aud\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"account\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"sub\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"27b3fac0-9aec-4421-81cf-d4b02428f901\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"typ\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"Bearer\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"azp\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"vertx-service\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"session_state\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"68708213-40b7-458a-aee1-39d6f9da07ad\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"acr\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"1\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"realm_access\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"roles\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"[\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"offline_access\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"uma_authorization\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"user\\\"\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"]\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"scope\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"email profile\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"email_verified\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"true\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"name\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"Theo Tester\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"preferred_username\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"tester\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"given_name\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"Theo\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"family_name\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"Tester\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"email\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"tom+tester@localhost\\\"\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"If a \", _jsx(_components.code, {\n          children: \"resource server\"\n        }), \" re­ceives a re­quest with such an ac­cess token, it needs to ver­ify and in­spect the token be­fore it can trust its con­tent.\\nTo ver­ify the token, the \", _jsx(_components.code, {\n          children: \"resource server\"\n        }), \" needs to ob­tain the \", _jsx(_components.code, {\n          children: \"public key\"\n        }), \" to check the token sig­na­ture.\\nThis \", _jsx(_components.code, {\n          children: \"public key\"\n        }), \" can ei­ther be con­fig­ured sta­t­i­cally or fetched dy­nam­i­cally from the OpenID Provider by lever­ag­ing the \", _jsx(_components.code, {\n          children: \"kid\"\n        }), \" in­for­ma­tion from the JWT header sec­tion.\\nNote that most \", _jsx(_components.code, {\n          children: \"OpenID providers\"\n        }), \", such as Key­cloak, pro­vide a ded­i­cated end­point for dy­namic pub­lic key lookups, e.g. \", _jsx(_components.code, {\n          children: \"http://localhost:8080/auth/realms/vertx/protocol/openid-connect/certs\"\n        }), \".\\nA stan­dard for pro­vid­ing pub­lic key in­for­ma­tion is \", _jsx(_components.a, {\n          href: \"https://tools.ietf.org/html/rfc7517\",\n          children: \"JSON Web Key Set (JWKS)\"\n        }), \".\\nThe JWKS in­for­ma­tion is usu­ally cached by the re­source server to avoid the over­head of fetch­ing JWKS for every re­quest.\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"An ex­am­ple re­sponse for Key­cloak’s JWKS end­point looks like this:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-json\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"{\"\n          }), \"\\n   \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"keys\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"[\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"{\"\n          }), \"\\n         \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"kid\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"c7M1_hdZ0-X3re9uvfKHTCQdqarPbpLnUI0ymvAtSTs\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n         \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"kty\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"RSA\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n         \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"alg\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"RS256\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n         \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"use\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"sig\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n         \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"n\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"iFuX2bAXA99Yrv6YEvpV9tjS52krP5UJ7lFL02Zl83PPV6PiLIWKTqF71bfTKnVDxO421xAsBw9f6dlgoyxxY1H_bzJQQryQkry7DA7tI_SnKVsehLgeF-tCcjRF_MF1kM14F1A5Zsu6oYIkMZvgJIRM-ejtz3aUcdnLcTvpPrmfvj7KwRgNsfm6Q-kO0-OAf6m6LaRvaC5VpTIRoVxXNhSIiGKuZ4d05Yk0-HdOR0D0sfOujYzleJmTGBEIAmdWpZqUXiSWbzmpw8mJmacFTP9v8lsTUYZrXc69xm5fHaNJ6PO_E-IKiPKT7OeoM2l3HIK76a4azVL1Ewbv1UtMFw\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n         \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"e\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"AQAB\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n         \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"x5c\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"[\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"MIICmTCCAYECBgFwplKOujANBgkqhkiG9w0BAQsFADAQMQ4wDAYDVQQDDAV2ZXJ0eDAeFw0yMDAzMDQxNjExMzNaFw0zMDAzMDQxNjEzMTNaMBAxDjAMBgNVBAMMBXZlcnR4MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAiFuX2bAXA99Yrv6YEvpV9tjS52krP5UJ7lFL02Zl83PPV6PiLIWKTqF71bfTKnVDxO421xAsBw9f6dlgoyxxY1H/bzJQQryQkry7DA7tI/SnKVsehLgeF+tCcjRF/MF1kM14F1A5Zsu6oYIkMZvgJIRM+ejtz3aUcdnLcTvpPrmfvj7KwRgNsfm6Q+kO0+OAf6m6LaRvaC5VpTIRoVxXNhSIiGKuZ4d05Yk0+HdOR0D0sfOujYzleJmTGBEIAmdWpZqUXiSWbzmpw8mJmacFTP9v8lsTUYZrXc69xm5fHaNJ6PO/E+IKiPKT7OeoM2l3HIK76a4azVL1Ewbv1UtMFwIDAQABMA0GCSqGSIb3DQEBCwUAA4IBAQBxcXiTtGoo4/eMNwhagYH8QpK1n7fxgzn4mkESU3wD+rnPOAh/xFmx5c3aq8X+8W2z7oopO86ZBSQ8HfbzViBP0uwvf7s7E6Q8FOqrUNv0Kj308A7hF1IOqOhCJE2nABIWJduYz5dWZN434Q9El30L1eOYTtjBUmCdP7/CM+1bvxIT+CYrWmjI9zCMJxhuixmLffppsLCjGtNgFBemjQyCrLxpEGCfy8QGb4pTY/XaHuJ7k6ZaQkVeTbeDzaZbHc9zT5qgf6w4Gp7y+uPZdAsasrwiqm3YBtyBfaK42luk09nHpV6PRKpftnyLVPwlQiJAW6ZMckvDwmnDst70msnb\\\"\"\n          }), \"\\n         \", _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n         \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"x5t\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"MVYTXCx5cUQ8lT1ymIDDRYO7_ZI\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), \"\\n         \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"x5t#S256\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"yBDVTlfR0e7cv3HxbbkfvGKVs5W1VQtFs7haE_js3DY\\\"\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"}\"\n          }), \"\\n   \", _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"]\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"The \", _jsx(_components.code, {\n          children: \"keys\"\n        }), \" array con­tains the JWKS struc­ture with the pub­lic key in­for­ma­tion that be­longs to the pub­lic/pri­vate key-​pair which was used\\nto sign the JWT ac­cess token from above. Note the match­ing \", _jsx(_components.code, {\n          children: \"kid\"\n        }), \" claim from our ear­lier JWT header ex­am­ple.\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Now that we have the ap­pro­pri­ate pub­lic key, we can use the in­for­ma­tion from the JWT header to val­i­date the sig­na­ture of the JWT ac­cess token.\\nIf the sig­na­ture is valid, we can go on and check ad­di­tional claims from the pay­load sec­tion of the JWT, such as ex­pi­ra­tion, al­lowed is­suer and au­di­ence etc.\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Now that we have the nec­es­sary build­ing blocks in place, we can fi­nally look at how to con­fig­ure JWT au­tho­riza­tion in Vert.x.\"\n      }), \"\\n\", _jsxs(_components.h3, {\n        id: \"jwt-authorization-in-vertx\",\n        children: [_jsx(_components.a, {\n          \"aria-hidden\": true,\n          tabIndex: \"-1\",\n          className: \"heading-anchor\",\n          href: \"#jwt-authorization-in-vertx\"\n        }), \"JWT Authorization in Vert.x\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"Set­ting up JWT au­tho­riza­tion in Vert.x is quite easy. First we need to add the \", _jsx(_components.code, {\n          children: \"vertx-auth-jwt\"\n        }), \" mod­ule as a de­pen­dency to our project.\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-xml\",\n          children: [_jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"dependency\"\n            }), \">\"]\n          }), \"\\n    \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"groupId\"\n            }), \">\"]\n          }), \"io.vertx\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"groupId\"\n            }), \">\"]\n          }), \"\\n    \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"artifactId\"\n            }), \">\"]\n          }), \"vertx-auth-jwt\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"artifactId\"\n            }), \">\"]\n          }), \"\\n\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"dependency\"\n            }), \">\"]\n          }), \"\\n\"]\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"In our ex­am­ple, the whole JWT au­tho­riza­tion setup hap­pens in the method \", _jsx(_components.code, {\n          children: \"setupJwtAuth\"\n        }), \".\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"We use a \", _jsx(_components.code, {\n          children: \"WebClient\"\n        }), \" to dy­nam­i­cally fetch the pub­lic key in­for­ma­tion from the \", _jsx(_components.code, {\n          children: \"/protocol/openid-connect/certs\"\n        }), \" JWKS end­point rel­a­tive to our Key­cloak is­suer URL.\\nAfter that, we con­fig­ure a \", _jsx(_components.code, {\n          children: \"JWTAuth\"\n        }), \" in­stance and cus­tomize the JWT val­i­da­tion via \", _jsx(_components.code, {\n          children: \"JWTOptions\"\n        }), \" and \", _jsx(_components.code, {\n          children: \"JWTAuthOptions\"\n        }), \".\\nNote that we use Key­cloak’s realm roles for role based au­tho­riza­tion via the \", _jsx(_components.code, {\n          children: \"JWTAuthOptions#setPermissionsClaimKey(..)\"\n        }), \" method.\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-java\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"private\"\n          }), \" Future<Startup> \", _jsx(_components.span, {\n            className: \"hljs-title function_\",\n            children: \"setupJwtAuth\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"(Startup startup)\"\n          }), \" {\\n\\n    \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"var\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"jwtConfig\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" startup.config.getJsonObject(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"jwt\\\"\"\n          }), \");\\n    \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"var\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"issuer\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" jwtConfig.getString(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"issuer\\\"\"\n          }), \");\\n    \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"var\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"issuerUri\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" URI.create(issuer);\\n\\n    \", _jsx(_components.span, {\n            className: \"hljs-comment\",\n            children: \"// derive JWKS uri from Keycloak issuer URI\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"var\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"jwksUri\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" URI.create(jwtConfig.getString(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"jwksUri\\\"\"\n          }), \", String.format(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"%s://%s:%d%s\\\"\"\n          }), \",\\n            issuerUri.getScheme(), issuerUri.getHost(), issuerUri.getPort(), issuerUri.getPath() + \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"/protocol/openid-connect/certs\\\"\"\n          }), \")));\\n\\n    \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"var\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"promise\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" Promise.<JWTAuth>promise();\\n\\n    \", _jsx(_components.span, {\n            className: \"hljs-comment\",\n            children: \"// fetch JWKS from `/certs` endpoint\"\n          }), \"\\n    webClient.get(jwksUri.getPort(), jwksUri.getHost(), jwksUri.getPath())\\n            .as(BodyCodec.jsonObject())\\n            .send(ar -> {\\n\\n                \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"if\"\n          }), \" (!ar.succeeded()) {\\n                    startup.bootstrap.fail(String.format(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"Could not fetch JWKS from URI: %s\\\"\"\n          }), \", jwksUri));\\n                    \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"return\"\n          }), \";\\n                }\\n\\n                \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"var\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"response\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" ar.result();\\n\\n                \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"var\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"jwksResponse\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" response.body();\\n                \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"var\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"keys\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" jwksResponse.getJsonArray(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"keys\\\"\"\n          }), \");\\n\\n                \", _jsx(_components.span, {\n            className: \"hljs-comment\",\n            children: \"// Configure JWT validation options\"\n          }), \"\\n                \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"var\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"jwtOptions\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title class_\",\n            children: \"JWTOptions\"\n          }), \"();\\n                jwtOptions.setIssuer(issuer);\\n\\n                \", _jsx(_components.span, {\n            className: \"hljs-comment\",\n            children: \"// extract JWKS from keys array\"\n          }), \"\\n                \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"var\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"jwks\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" ((List<Object>) keys.getList()).stream()\\n                        .map(o -> \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title class_\",\n            children: \"JsonObject\"\n          }), \"((Map<String, Object>) o))\\n                        .collect(Collectors.toList());\\n\\n                \", _jsx(_components.span, {\n            className: \"hljs-comment\",\n            children: \"// configure JWTAuth\"\n          }), \"\\n                \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"var\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"jwtAuthOptions\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title class_\",\n            children: \"JWTAuthOptions\"\n          }), \"();\\n                jwtAuthOptions.setJwks(jwks);\\n                jwtAuthOptions.setJWTOptions(jwtOptions);\\n                jwtAuthOptions.setPermissionsClaimKey(jwtConfig.getString(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"permissionClaimsKey\\\"\"\n          }), \", \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"realm_access/roles\\\"\"\n          }), \"));\\n\\n                \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"JWTAuth\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"jwtAuth\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" JWTAuth.create(vertx, jwtAuthOptions);\\n                promise.complete(jwtAuth);\\n            });\\n\\n    \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"return\"\n          }), \" promise.future().compose(auth -> {\\n        jwtAuth = auth;\\n        \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"return\"\n          }), \" Future.succeededFuture(startup);\\n    });\\n}\\n\"]\n        })\n      }), \"\\n\", _jsxs(_components.h3, {\n        id: \"protecting-routes-with-jwtauthhandler\",\n        children: [_jsx(_components.a, {\n          \"aria-hidden\": true,\n          tabIndex: \"-1\",\n          className: \"heading-anchor\",\n          href: \"#protecting-routes-with-jwtauthhandler\"\n        }), \"Protecting routes with JWTAuthHandler\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"Now that our \", _jsx(_components.code, {\n          children: \"JWTAuth\"\n        }), \" is con­fig­ured, we can use the \", _jsx(_components.code, {\n          children: \"JWTAuthHandler\"\n        }), \" in the \", _jsx(_components.code, {\n          children: \"setupRouter\"\n        }), \" method to apply\\nJWT au­tho­riza­tion to all routes match­ing the path pat­tern \", _jsx(_components.code, {\n          children: \"/api/*\"\n        }), \". The \", _jsx(_components.code, {\n          children: \"JWTAuthHandler\"\n        }), \" val­i­dates re­ceived JWTs and per­forms\\nad­di­tional checks like ex­pi­ra­tion and al­lowed is­suers. With that in place, we con­fig­ure our ac­tual routes in \", _jsx(_components.code, {\n          children: \"setupRoutes\"\n        }), \".\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-java\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"private\"\n          }), \" Future<Startup> \", _jsx(_components.span, {\n            className: \"hljs-title function_\",\n            children: \"setupRouter\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"(Startup startup)\"\n          }), \" {\\n\\n    router = Router.router(vertx);\\n\\n    router.route(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"/api/*\\\"\"\n          }), \").handler(JWTAuthHandler.create(jwtAuth));\\n\\n    \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"return\"\n          }), \" Future.succeededFuture(startup);\\n}\\n\\n\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"private\"\n          }), \" Future<Startup> \", _jsx(_components.span, {\n            className: \"hljs-title function_\",\n            children: \"setupRoutes\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"(Startup startup)\"\n          }), \" {\\n\\n    router.get(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"/api/greet\\\"\"\n          }), \").handler(\", _jsx(_components.span, {\n            className: \"hljs-built_in\",\n            children: \"this\"\n          }), \"::handleGreet);\\n    router.get(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"/api/user\\\"\"\n          }), \").handler(\", _jsx(_components.span, {\n            className: \"hljs-built_in\",\n            children: \"this\"\n          }), \"::handleUserData);\\n    router.get(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"/api/admin\\\"\"\n          }), \").handler(\", _jsx(_components.span, {\n            className: \"hljs-built_in\",\n            children: \"this\"\n          }), \"::handleAdminData);\\n\\n    \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"return\"\n          }), \" Future.succeededFuture(startup);\\n}\\n\"]\n        })\n      }), \"\\n\", _jsxs(_components.h3, {\n        id: \"extracting-user-information-from-jwtuser\",\n        children: [_jsx(_components.a, {\n          \"aria-hidden\": true,\n          tabIndex: \"-1\",\n          className: \"heading-anchor\",\n          href: \"#extracting-user-information-from-jwtuser\"\n        }), \"Extracting user information from JWTUser\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"To ac­cess user in­for­ma­tion in our \", _jsx(_components.code, {\n          children: \"handleGreet\"\n        }), \" method, we cast the re­sult of the \", _jsx(_components.code, {\n          children: \"io.vertx.ext.web.RoutingContext#user\"\n        }), \" method to \", _jsx(_components.code, {\n          children: \"JWTUser\"\n        }), \"\\nwhich al­lows us to ac­cess token claim in­for­ma­tion via the \", _jsx(_components.code, {\n          children: \"io.vertx.ext.auth.jwt.impl.JWTUser#principal\"\n        }), \" JSON ob­ject.\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"If we’d like to use the JWT ac­cess token for other ser­vice calls, we could ex­tract the token from the \", _jsx(_components.code, {\n          children: \"Authorization\"\n        }), \" header.\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-java\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"private\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"void\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title function_\",\n            children: \"handleGreet\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"(RoutingContext ctx)\"\n          }), \" {\\n\\n    \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"var\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"jwtUser\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" (JWTUser) ctx.user();\\n    \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"var\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"username\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" jwtUser.principal().getString(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"preferred_username\\\"\"\n          }), \");\\n    \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"var\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"userId\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" jwtUser.principal().getString(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"sub\\\"\"\n          }), \");\\n\\n    \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"var\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"accessToken\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" ctx.request().getHeader(HttpHeaders.AUTHORIZATION).substring(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"Bearer \\\"\"\n          }), \".length());\\n    \", _jsx(_components.span, {\n            className: \"hljs-comment\",\n            children: \"// Use accessToken for down-stream calls if needed...\"\n          }), \"\\n\\n    ctx.request().response().end(String.format(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"Hi %s (%s) %s%n\\\"\"\n          }), \", username, userId, Instant.now()));\\n}\\n\"]\n        })\n      }), \"\\n\", _jsxs(_components.h3, {\n        id: \"obtaining-an-access-token-from-keycloak-for-user-tester\",\n        children: [_jsx(_components.a, {\n          \"aria-hidden\": true,\n          tabIndex: \"-1\",\n          className: \"heading-anchor\",\n          href: \"#obtaining-an-access-token-from-keycloak-for-user-tester\"\n        }), \"Obtaining an Access Token from Keycloak for user \", _jsx(_components.code, {\n          children: \"tester\"\n        })]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"To test our ap­pli­ca­tion we can use the fol­low­ing \", _jsx(_components.code, {\n          children: \"curl\"\n        }), \" com­mands in a bash like shell to ob­tain an JWT ac­cess token to call one\\nof our end­points as the user \", _jsx(_components.code, {\n          children: \"tester\"\n        }), \" with the role \", _jsx(_components.code, {\n          children: \"user\"\n        }), \".\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"Note that this ex­am­ple uses the cli tool \", _jsx(_components.a, {\n          href: \"https://stedolan.github.io/jq/\",\n          children: \"jq\"\n        }), \" for JSON pro­cess­ing.\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-bash\",\n          children: [\"KC_USERNAME=tester\\nKC_PASSWORD=\", _jsx(_components.span, {\n            className: \"hljs-built_in\",\n            children: \"test\"\n          }), \"\\nKC_CLIENT=vertx-service\\nKC_CLIENT_SECRET=ecb85cc5-f90d-4a03-8fac-24dcde57f40c\\nKC_REALM=vertx\\nKC_URL=http://localhost:8080/auth\\nKC_RESPONSE=$(curl  -k \\\\\\n        -d \", _jsxs(_components.span, {\n            className: \"hljs-string\",\n            children: [\"\\\"username=\", _jsx(_components.span, {\n              className: \"hljs-variable\",\n              children: \"$KC_USERNAME\"\n            }), \"\\\"\"]\n          }), \" \\\\\\n        -d \", _jsxs(_components.span, {\n            className: \"hljs-string\",\n            children: [\"\\\"password=\", _jsx(_components.span, {\n              className: \"hljs-variable\",\n              children: \"$KC_PASSWORD\"\n            }), \"\\\"\"]\n          }), \" \\\\\\n        -d \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"'grant_type=password'\"\n          }), \" \\\\\\n        -d \", _jsxs(_components.span, {\n            className: \"hljs-string\",\n            children: [\"\\\"client_id=\", _jsx(_components.span, {\n              className: \"hljs-variable\",\n              children: \"$KC_CLIENT\"\n            }), \"\\\"\"]\n          }), \" \\\\\\n        -d \", _jsxs(_components.span, {\n            className: \"hljs-string\",\n            children: [\"\\\"client_secret=\", _jsx(_components.span, {\n              className: \"hljs-variable\",\n              children: \"$KC_CLIENT_SECRET\"\n            }), \"\\\"\"]\n          }), \" \\\\\\n        \", _jsxs(_components.span, {\n            className: \"hljs-string\",\n            children: [\"\\\"\", _jsx(_components.span, {\n              className: \"hljs-variable\",\n              children: \"$KC_URL\"\n            }), \"/realms/\", _jsx(_components.span, {\n              className: \"hljs-variable\",\n              children: \"$KC_REALM\"\n            }), \"/protocol/openid-connect/token\\\"\"]\n          }), \" \\\\\\n    | jq .)\\n\\nKC_ACCESS_TOKEN=$(\", _jsx(_components.span, {\n            className: \"hljs-built_in\",\n            children: \"echo\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"$KC_RESPONSE\"\n          }), \"| jq -r .access_token)\\n\", _jsx(_components.span, {\n            className: \"hljs-built_in\",\n            children: \"echo\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"$KC_ACCESS_TOKEN\"\n          }), \"\\n\"]\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"Here we use the JWT ac­cess token in the \", _jsx(_components.code, {\n          children: \"Authorization\"\n        }), \" header with the \", _jsx(_components.code, {\n          children: \"Bearer\"\n        }), \" pre­fix to call our \", _jsx(_components.code, {\n          children: \"greet\"\n        }), \" route:\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-bash\",\n          children: [\"curl --silent -H \", _jsxs(_components.span, {\n            className: \"hljs-string\",\n            children: [\"\\\"Authorization: Bearer \", _jsx(_components.span, {\n              className: \"hljs-variable\",\n              children: \"$KC_ACCESS_TOKEN\"\n            }), \"\\\"\"]\n          }), \" http://localhost:3000/api/greet\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Ex­am­ple out­put:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"hljs language-bash\",\n          children: \"Hi tester (27b3fac0-9aec-4421-81cf-d4b02428f901) 2020-09-28T21:03:59.254230700Z\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.h3, {\n        id: \"applying-role-based-access-control-with-jwtuser\",\n        children: [_jsx(_components.a, {\n          \"aria-hidden\": true,\n          tabIndex: \"-1\",\n          className: \"heading-anchor\",\n          href: \"#applying-role-based-access-control-with-jwtuser\"\n        }), \"Applying Role-based Access-Control with JWTUser\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"To lever­age sup­port for role based ac­cess con­trol (RBAC) we can use the \", _jsx(_components.code, {\n          children: \"io.vertx.ext.auth.User#isAuthorised\"\n        }), \" method\\nto check whether the cur­rent user has the re­quired role. If the role is present we re­turn some data about the user, oth­er­wise\\nwe send a re­sponse with sta­tus code 403 and a \", _jsx(_components.code, {\n          children: \"forbidden\"\n        }), \" error mes­sage.\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-java\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"private\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"void\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title function_\",\n            children: \"handleUserData\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"(RoutingContext ctx)\"\n          }), \" {\\n\\n    \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"var\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"jwtUser\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" (JWTUser) ctx.user();\\n    \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"var\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"username\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" jwtUser.principal().getString(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"preferred_username\\\"\"\n          }), \");\\n    \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"var\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"userId\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" jwtUser.principal().getString(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"sub\\\"\"\n          }), \");\\n\\n    jwtUser.isAuthorized(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"user\\\"\"\n          }), \", res -> {\\n\\n        \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"if\"\n          }), \" (!res.succeeded() || !res.result()) {\\n            toJsonResponse(ctx).setStatusCode(\", _jsx(_components.span, {\n            className: \"hljs-number\",\n            children: \"403\"\n          }), \").end(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"{\\\\\\\"error\\\\\\\": \\\\\\\"forbidden\\\\\\\"}\\\"\"\n          }), \");\\n            \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"return\"\n          }), \";\\n        }\\n\\n        \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"JsonObject\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"data\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title class_\",\n            children: \"JsonObject\"\n          }), \"()\\n                .put(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"type\\\"\"\n          }), \", \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"user\\\"\"\n          }), \")\\n                .put(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"username\\\"\"\n          }), \", username)\\n                .put(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"userId\\\"\"\n          }), \", userId)\\n                .put(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"timestamp\\\"\"\n          }), \", Instant.now());\\n\\n        toJsonResponse(ctx).end(data.toString());\\n    });\\n}\\n\\n\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"private\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"void\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title function_\",\n            children: \"handleAdminData\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"(RoutingContext ctx)\"\n          }), \" {\\n\\n    \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"var\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"jwtUser\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" (JWTUser) ctx.user();\\n    \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"var\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"username\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" jwtUser.principal().getString(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"preferred_username\\\"\"\n          }), \");\\n    \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"var\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"userId\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" jwtUser.principal().getString(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"sub\\\"\"\n          }), \");\\n\\n    jwtUser.isAuthorized(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"admin\\\"\"\n          }), \", res -> {\\n\\n        \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"if\"\n          }), \" (!res.succeeded() || !res.result()) {\\n            toJsonResponse(ctx).setStatusCode(\", _jsx(_components.span, {\n            className: \"hljs-number\",\n            children: \"403\"\n          }), \").end(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"{\\\\\\\"error\\\\\\\": \\\\\\\"forbidden\\\\\\\"}\\\"\"\n          }), \");\\n            \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"return\"\n          }), \";\\n        }\\n\\n        \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"JsonObject\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"data\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title class_\",\n            children: \"JsonObject\"\n          }), \"()\\n                .put(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"type\\\"\"\n          }), \", \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"admin\\\"\"\n          }), \")\\n                .put(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"username\\\"\"\n          }), \", username)\\n                .put(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"userId\\\"\"\n          }), \", userId)\\n                .put(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"timestamp\\\"\"\n          }), \", Instant.now());\\n\\n        toJsonResponse(ctx).end(data.toString());\\n    });\\n}\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-bash\",\n          children: [\"curl --silent -H \", _jsxs(_components.span, {\n            className: \"hljs-string\",\n            children: [\"\\\"Authorization: Bearer \", _jsx(_components.span, {\n              className: \"hljs-variable\",\n              children: \"$KC_ACCESS_TOKEN\"\n            }), \"\\\"\"]\n          }), \" http://localhost:3000/api/user\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Out­put:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-json\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"{\"\n          }), _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"type\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"user\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"username\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"tester\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"userId\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"27b3fac0-9aec-4421-81cf-d4b02428f901\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"timestamp\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"2020-09-28T21:07:49.340950300Z\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-bash\",\n          children: [\"curl --silent -H \", _jsxs(_components.span, {\n            className: \"hljs-string\",\n            children: [\"\\\"Authorization: Bearer \", _jsx(_components.span, {\n              className: \"hljs-variable\",\n              children: \"$KC_ACCESS_TOKEN\"\n            }), \"\\\"\"]\n          }), \" http://localhost:3000/api/admin\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Out­put:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-json\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"{\"\n          }), _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"error\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"forbidden\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        })\n      }), \"\\n\", _jsxs(_components.h3, {\n        id: \"obtaining-an-access-token-from-keycloak-for-user-vadmin\",\n        children: [_jsx(_components.a, {\n          \"aria-hidden\": true,\n          tabIndex: \"-1\",\n          className: \"heading-anchor\",\n          href: \"#obtaining-an-access-token-from-keycloak-for-user-vadmin\"\n        }), \"Obtaining an Access Token from Keycloak for user \", _jsx(_components.code, {\n          children: \"vadmin\"\n        })]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"To check ac­cess with an \", _jsx(_components.code, {\n          children: \"admin\"\n        }), \" role, we ob­tain a new token for the user \", _jsx(_components.code, {\n          children: \"vadmin\"\n        }), \" which has the roles \", _jsx(_components.code, {\n          children: \"admin\"\n        }), \" and \", _jsx(_components.code, {\n          children: \"user\"\n        }), \".\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-bash\",\n          children: [\"KC_USERNAME=vadmin\\nKC_PASSWORD=\", _jsx(_components.span, {\n            className: \"hljs-built_in\",\n            children: \"test\"\n          }), \"\\nKC_CLIENT=vertx-service\\nKC_CLIENT_SECRET=ecb85cc5-f90d-4a03-8fac-24dcde57f40c\\nKC_REALM=vertx\\nKC_URL=http://localhost:8080/auth\\nKC_RESPONSE=$(curl  -k \\\\\\n        -d \", _jsxs(_components.span, {\n            className: \"hljs-string\",\n            children: [\"\\\"username=\", _jsx(_components.span, {\n              className: \"hljs-variable\",\n              children: \"$KC_USERNAME\"\n            }), \"\\\"\"]\n          }), \" \\\\\\n        -d \", _jsxs(_components.span, {\n            className: \"hljs-string\",\n            children: [\"\\\"password=\", _jsx(_components.span, {\n              className: \"hljs-variable\",\n              children: \"$KC_PASSWORD\"\n            }), \"\\\"\"]\n          }), \" \\\\\\n        -d \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"'grant_type=password'\"\n          }), \" \\\\\\n        -d \", _jsxs(_components.span, {\n            className: \"hljs-string\",\n            children: [\"\\\"client_id=\", _jsx(_components.span, {\n              className: \"hljs-variable\",\n              children: \"$KC_CLIENT\"\n            }), \"\\\"\"]\n          }), \" \\\\\\n        -d \", _jsxs(_components.span, {\n            className: \"hljs-string\",\n            children: [\"\\\"client_secret=\", _jsx(_components.span, {\n              className: \"hljs-variable\",\n              children: \"$KC_CLIENT_SECRET\"\n            }), \"\\\"\"]\n          }), \" \\\\\\n        \", _jsxs(_components.span, {\n            className: \"hljs-string\",\n            children: [\"\\\"\", _jsx(_components.span, {\n              className: \"hljs-variable\",\n              children: \"$KC_URL\"\n            }), \"/realms/\", _jsx(_components.span, {\n              className: \"hljs-variable\",\n              children: \"$KC_REALM\"\n            }), \"/protocol/openid-connect/token\\\"\"]\n          }), \" \\\\\\n    | jq .)\\n\\nKC_ACCESS_TOKEN=$(\", _jsx(_components.span, {\n            className: \"hljs-built_in\",\n            children: \"echo\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"$KC_RESPONSE\"\n          }), \"| jq -r .access_token)\\n\", _jsx(_components.span, {\n            className: \"hljs-built_in\",\n            children: \"echo\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"$KC_ACCESS_TOKEN\"\n          }), \"\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-bash\",\n          children: [\"curl --silent -H \", _jsxs(_components.span, {\n            className: \"hljs-string\",\n            children: [\"\\\"Authorization: Bearer \", _jsx(_components.span, {\n              className: \"hljs-variable\",\n              children: \"$KC_ACCESS_TOKEN\"\n            }), \"\\\"\"]\n          }), \" http://localhost:3000/api/user\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Out­put:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-json\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"{\"\n          }), _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"type\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"user\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"username\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"vadmin\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"userId\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"75090eac-36ff-4cd8-847d-fc2941bc024e\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"timestamp\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"2020-09-28T21:13:05.099393900Z\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-bash\",\n          children: [\"curl --silent -H \", _jsxs(_components.span, {\n            className: \"hljs-string\",\n            children: [\"\\\"Authorization: Bearer \", _jsx(_components.span, {\n              className: \"hljs-variable\",\n              children: \"$KC_ACCESS_TOKEN\"\n            }), \"\\\"\"]\n          }), \" http://localhost:3000/api/admin\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Out­put:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-json\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"{\"\n          }), _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"type\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"admin\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"username\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"vadmin\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"userId\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"75090eac-36ff-4cd8-847d-fc2941bc024e\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \",\"\n          }), _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"\\\"timestamp\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"2020-09-28T21:13:34.945276500Z\\\"\"\n          }), _jsx(_components.span, {\n            className: \"hljs-punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        })\n      }), \"\\n\", _jsxs(_components.h3, {\n        id: \"conclusion\",\n        children: [_jsx(_components.a, {\n          \"aria-hidden\": true,\n          tabIndex: \"-1\",\n          className: \"heading-anchor\",\n          href: \"#conclusion\"\n        }), \"Conclusion\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"We learned how to con­fig­ure a Vert.x ap­pli­ca­tion with JWT au­tho­riza­tion pow­ered by Key­cloak. Al­though the con­fig­u­ra­tion is quite com­plete\\nal­ready, there are still some parts that can be im­proved, like the dy­namic JWKS fetch­ing on public-​key pair ro­ta­tion as well as ex­trac­tion of nested roles.\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Nev­er­the­less this is a good start­ing point for se­cur­ing your own Vert.x ser­vices with JWT and Key­cloak.\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"You can check out the \", _jsx(_components.a, {\n          href: \"https://github.com/thomasdarimont/vertx-playground/tree/master/jwt-service-vertx\",\n          children: \"com­plete ex­am­ple in keycloak-​vertx Ex­am­ples Repo\"\n        }), \".\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"Thank you for your time, stay tuned for more up­dates! If you want to learn more about Key­cloak, feel free to reach out to me. You can find me via \", _jsx(_components.a, {\n          href: \"https://twitter.com/thomasdarimont\",\n          children: \"thomas­da­ri­mont on twit­ter\"\n        }), \".\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Happy Hack­ing!\"\n      })]\n    });\n  }\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n"},"prevPost":{"meta":{"title":"Eclipse Vert.x 3.9.4 released!","category":"releases","authors":[{"name":"Julien Viet","github_id":"vietj"}],"summary":"Eclipse Vert.x version 3.9.4 has just been released. It fixes quite a few bugs that have been reported by the community."},"date":"2020-10-15","slug":"eclipse-vert-x-3-9-4-released"},"nextPost":{"meta":{"title":"Eclipse Vert.x 4 beta 3 released!","category":"releases","authors":[{"name":"Julien Viet","github_id":"vietj"}],"summary":"The third beta version of Eclipse Vert.x 4.0 highlights many features including (but not limited to) HTTP client request creation, HTTP tunnel improvements, and WebSocket upgrade improvements."},"date":"2020-09-25","slug":"eclipse-vert-x-4-beta-3-released"},"relatedPosts":[{"meta":{"title":"Easy SSO for Vert.x with Keycloak","category":"guides","authors":[{"name":"Thomas Darimont","github_id":"thomasdarimont"}],"summary":"In this blog post, you'll learn how to implement Single Sign-on with OpenID Connect and how to use Keycloak together with Eclipse Vert.x."},"date":"2020-03-16","slug":"easy-sso-for-vert-x-with-keycloak"},{"meta":{"title":"Things to keep in mind concerning CSRF attacks","category":"guides","authors":[{"name":"Xhelal Likaj","github_id":"xhlika"}],"summary":"Eclipse Vert.x like most frameworks provides an anti-CSRF defense. However, no framework can prevent all attack vectors that exist in the web. Therefore, developers need to be aware of some dangers and common attack vectors concerning CSRF defenses."},"date":"2021-01-23","slug":"eclipse-vert-x-CSRF-concerns"},{"meta":{"title":"Unit and Integration Tests","category":"guides","authors":[{"name":"Clement Escoffier","github_id":"cescoffier"}],"summary":"Let’s refresh our mind about what we developed so far in the introduction to vert.x series. We forgot an important task. We didn’t test the API."},"date":"2015-08-03","slug":"unit-and-integration-tests"}]},"__N_SSG":true}